# NPLogic 화면별 구현 가이드

## 화면 목록 및 우선순위

### Phase 1: 핵심 화면 (높은 우선순위)

1. **로그인 (Login)**
2. **대시보드 (Dashboard)** - 역할별
3. **물건 목록 (Property List)**
4. **물건 상세 - 기초데이터 탭 (Property Detail - Basic Data)**
5. **물건 상세 - 등기부 탭 (Property Detail - Registry)**
6. **데이터 업로드 (Data Upload)**

### Phase 2: 주요 기능 화면

7. **물건 상세 - 권리분석 탭 (Property Detail - Rights Analysis)**
8. **물건 상세 - 평가 탭 (Property Detail - Evaluation)**
9. **물건 상세 - 지도 탭 (Property Detail - Map)**
10. **선순위 관리 (Senior Rights)**
11. **경매일정 (Auction Schedule)**
12. **공매일정 (Public Sale Schedule)**

### Phase 3: 고급 기능 및 관리

13. **통계 대시보드 (Statistics)**
14. **사용자 관리 (User Management)**
15. **설정 관리 (Settings)**
16. **작업 이력 (Audit Logs)**

---

## 화면 상세 구현 가이드

---

### 1. 로그인 화면 (Login)

**파일**: `Views/LoginView.xaml`

#### 레이아웃
```
┌───────────────────────────────────┐
│                                   │
│           NPLogic 로고             │
│                                   │
│     ┌─────────────────────┐      │
│     │ 이메일 입력          │      │
│     └─────────────────────┘      │
│                                   │
│     ┌─────────────────────┐      │
│     │ 비밀번호 입력        │      │
│     └─────────────────────┘      │
│                                   │
│     ☑ 자동 로그인                │
│                                   │
│     [     로그인 버튼      ]      │
│                                   │
│     회원가입 | 비밀번호 찾기        │
│                                   │
└───────────────────────────────────┘
```

#### UI 요소
- **배경**: Deep Navy 그라데이션
- **로고**: 중앙 상단 배치, 흰색
- **입력 필드**: 
  - 이메일 (TextBox, 아이콘: Email)
  - 비밀번호 (PasswordBox, 아이콘: Lock)
- **체크박스**: "자동 로그인"
- **버튼**: Primary Button (전체 너비)
- **링크**: 회원가입, 비밀번호 찾기

#### 기능
- Supabase Auth 로그인
- 입력 검증 (이메일 형식, 필수 입력)
- 로그인 성공 → 역할별 화면 이동
- 에러 메시지 표시

#### ViewModel
```csharp
public partial class LoginViewModel : ObservableObject
{
    [ObservableProperty]
    private string email;
    
    [ObservableProperty]
    private string password;
    
    [ObservableProperty]
    private bool rememberMe;
    
    [ObservableProperty]
    private string errorMessage;
    
    [RelayCommand]
    private async Task LoginAsync()
    {
        // 로그인 로직
    }
}
```

---

### 2. 대시보드 (Dashboard)

**파일**: `Views/DashboardView.xaml`

> **⚠️ 중요**: 대시보드는 단순 통계 화면이 아닌, **물건 목록 + 진행 상황 관리**의 핵심 화면입니다.

#### 역할별 대시보드

##### PM 대시보드 (프로젝트 매니저)

**기획서**: `PM.md`

```
┌────────────────────────────────────────────────────────────────┐
│  프로그램별 진행사항                                             │
│                                                                │
│  [프로그램 선택: SHB-2025-03 ▼]                               │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 차주  │차주명│Assign│담보 │물건 │약정서│보증서│경개  │경개 │ │
│  │ 번호  │     │      │번호 │종류 │     │     │개시1 │개시2│ │
│  ├──────────────────────────────────────────────────────────┤ │
│  │ 경매  │전입/ │선순위│평가액│경(공)│QA   │권리  │      │     │ │
│  │ 열람  │상가  │검토  │확정  │매일정│미회신│분석  │      │     │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  [+ 차주 추가]  [Excel 내보내기]  [일괄 Assign]                │
│                                                                │
│  통계 카드 (선택적)                                            │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ 총 차주수│ │ 완료     │ │ 진행중   │ │ 대기     │           │
│  │   120   │ │   60    │ │   45    │ │   15    │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
└────────────────────────────────────────────────────────────────┘
```

**그리드 컬럼 상세 (15개)**:
1. **차주번호** - 고유 식별자
2. **차주명** - 채무자 이름
3. **Assign** - 담당 평가자 배정
4. **담보번호** - 물건 번호
5. **물건종류** - 아파트/상가/토지 등
6. **약정서** - 체크박스 (제출 여부)
7. **보증서** - 체크박스 (신용보증서 여부)
8. **경개개시여부 1** - 경매 개시 상태
9. **경개개시여부 2** - 공매 개시 상태
10. **경매열람자료** - 체크박스 (자료 확보 여부)
11. **전입/상가임대차 열람** - 체크박스 (열람 완료 여부)
12. **선순위검토** - 체크박스 (선순위 분석 완료)
13. **평가액확정** - 체크박스 (평가 완료)
14. **경(공)매일정** - 날짜 또는 상태
15. **QA_미회신** - 미답변 QA 개수 (뱃지)
16. **권리분석** - 진행 상태 (대기/진행중/완료)

**체크박스 색상 코드**:
- ✅ 완료: 초록색
- ⏳ 진행중: 주황색
- ⬜ 대기: 회색

##### 평가자 대시보드

**기획서**: `평가자.md`

```
┌────────────────────────────────────────────────────────────────┐
│  내게 할당된 물건 목록                                           │
│                                                                │
│  [전체 보기]  [진행중만]  [완료만]                             │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 차주  │차주명│담보 │물건 │약정서│보증서│경개  │경개 │경매  │ │
│  │ 번호  │     │번호 │종류 │     │     │개시1 │개시2│열람  │ │
│  ├──────────────────────────────────────────────────────────┤ │
│  │ 전입/ │선순위│평가액│경(공)│QA   │권리  │      │     │     │ │
│  │ 상가  │검토  │확정  │매일정│미회신│분석  │      │     │     │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  나의 진행 상황                                                │
│  ■■■■■■■■■□ 85% 완료 (17/20 건)                          │
│                                                                │
│  미완료 작업                                                   │
│  ⚠️ 선순위검토 필요: 3건                                        │
│  ⚠️ 평가액확정 필요: 2건                                        │
└────────────────────────────────────────────────────────────────┘
```

**PM과 동일한 그리드 구조**, 단 차이점:
- **Assign 컬럼 없음** (본인 할당 물건만 표시)
- **필터**: 진행 상태별 필터 추가
- **진행률**: 개인별 작업 완료율 표시
- **알림**: 미완료 작업 요약

##### 관리자 대시보드

**기획서**: `관리자모드.md`

```
┌────────────────────────────────────────────────────────────────┐
│  🔧 시스템 관리                                                 │
│                                                                │
│  [프로그램 관리 탭]  [물건 현황 탭]  [사용자 탭]               │
│   ─────────────                                               │
│                                                                │
│  === 진행중인 프로그램 ===                                     │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 프로그램명 │ 담당팀 │ 담당 회계법인 │ 차주수 │ 물건수      │ │
│  ├──────────────────────────────────────────────────────────┤ │
│  │ cut-off   │ 입찰일 │ 진행률        │ 액션                 │ │
│  │ SHB-2025-03│신한은행│ 삼정회계법인   │  45   │  120       │ │
│  │ 2025-03-15│2025-04-│   75%        │[상세] [편집]         │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  [+ 새 프로그램 등록]                                           │
│                                                                │
│  === 프로그램별 상세 현황 (선택시) ===                          │
│  [PM 대시보드와 동일한 그리드 표시]                             │
│                                                                │
│  === 관리 기능 ===                                            │
│  [👥 사용자 관리] [⚙️ 설정] [📊 통계] [📋 감사로그]           │
└────────────────────────────────────────────────────────────────┘
```

**관리자 전용 기능**:
1. **프로그램 관리**
   - 프로그램 생성/수정/삭제
   - 담당팀, 담당 회계법인 배정
   - cut-off, 입찰일 설정
2. **전체 프로그램 현황**
   - 모든 프로그램의 진행률 한눈에
3. **사용자 관리 빠른 링크**
4. **시스템 설정 접근**

---

#### 📊 데이터 모델

```csharp
// 대시보드 그리드 행 데이터
public class DashboardRowViewModel
{
    // 기본 정보
    public string 차주번호 { get; set; }
    public string 차주명 { get; set; }
    public string Assign { get; set; }  // PM만
    public string 담보번호 { get; set; }
    public string 물건종류 { get; set; }
    
    // 체크박스 상태
    public bool 약정서 { get; set; }
    public bool 보증서 { get; set; }
    public string 경개개시여부1 { get; set; }
    public string 경개개시여부2 { get; set; }
    public bool 경매열람자료 { get; set; }
    public bool 전입_상가임대차열람 { get; set; }
    public bool 선순위검토 { get; set; }
    public bool 평가액확정 { get; set; }
    
    // 일정 및 상태
    public DateTime? 경공매일정 { get; set; }
    public int QA미회신 { get; set; }
    public string 권리분석상태 { get; set; }  // "대기"/"진행중"/"완료"
    
    // 진행률 계산
    public int 진행률 => CalculateProgress();
}
```

#### 🎨 UI 요소

1. **프로그램 선택기**
   - ComboBox (드롭다운)
   - 최근 선택 프로그램 기억
   - 프로그램별 데이터 자동 필터링

2. **데이터 그리드**
   - **헤더**: Blue Gray (#B0C4DE)
   - **행 Hover**: 연한 회색 배경
   - **체크박스**: 
     - 완료: ✅ 초록색
     - 진행중: 🟧 주황색  
     - 미완료: ⬜ 회색
   - **정렬**: 모든 컬럼 클릭으로 정렬
   - **페이지네이션**: 50개씩 표시
   - **컨텍스트 메뉴**: 우클릭 → 상세보기/편집/삭제

3. **통계 카드** (선택적)
   - 흰색 배경, 그림자 효과
   - 큰 숫자 + 아이콘
   - 클릭 시 해당 상태 필터링

4. **필터 패널** (접기/펴기 가능)
   - 물건종류 필터
   - 진행 상태 필터
   - Assign 필터 (PM만)
   - 날짜 범위 필터

5. **프로그레스바** (평가자/관리자)
   - 전체 진행률 시각화
   - 미완료 작업 강조

#### ⚙️ 기능

**공통 기능**:
- ✅ 프로그램 선택 시 데이터 자동 로딩
- ✅ 실시간 체크박스 상태 업데이트 (Supabase)
- ✅ 행 클릭 → 물건 상세 화면 이동
- ✅ 체크박스 클릭 → 즉시 저장
- ✅ QA 뱃지 클릭 → QA 목록 모달
- ✅ Excel 내보내기
- ✅ 검색 (차주명, 담보번호)

**PM 전용**:
- ✅ Assign 드롭다운 (평가자 목록)
- ✅ 일괄 Assign 기능
- ✅ 차주 추가 모달

**평가자 전용**:
- ✅ 진행률 추적
- ✅ 미완료 작업 알림
- ✅ 진행중/완료 필터

**관리자 전용**:
- ✅ 프로그램 관리 (CRUD)
- ✅ 모든 프로그램 조회
- ✅ 통계 대시보드 링크

---

### 3. 물건 목록 (Property List)

**파일**: `Views/PropertyListView.xaml`

#### 레이아웃
```
┌─────────────────────────────────────────────┐
│  물건 목록                                  │
│                                             │
│  [검색] [필터] [정렬]                [+ 추가]│
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ 물건번호 | 주소 | 유형 | 상태 | ...│   │
│  │ P-001 | 서울 강남 | 아파트 | 진행중│   │
│  │ P-002 | 서울 서초 | 상가 | 완료   │   │
│  │ ...                                 │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  [◀ 이전]  1 2 3 4 5  [다음 ▶]             │
└─────────────────────────────────────────────┘
```

#### UI 요소
- **검색바**: 주소, 물건번호 검색
- **필터 패널**: 
  - 물건 유형 (아파트, 상가, 토지 등)
  - 상태 (대기, 진행중, 완료)
  - 지역 (시/도, 시/군/구)
- **정렬**: 컬럼 클릭으로 정렬
- **데이터 그리드**: 
  - 행 클릭 → 상세 화면
  - 행 Hover → 배경색 변경
  - 체크박스 → 다중 선택
- **페이지네이션**: 50개씩 표시

#### 기능
- 실시간 검색 (debounce 300ms)
- 필터 적용 시 자동 조회
- Excel 내보내기 버튼
- 물건 추가 모달

---

### 4. 물건 상세 - 기초데이터 탭

**파일**: `Views/PropertyDetailView.xaml` - Tab 1
**기획서**: `기초테이터.md`, `담보물건(Ⅳ).md`

> **⚠️ 중요**: 기초데이터 탭은 단순 정보 표시가 아닌, **지도/시세 조회/문서 관리**를 통합한 핵심 화면

#### 레이아웃

```
┌──────────────────────────────────────────────────────────────────┐
│  물건 상세: P-001 (아파트)                                        │
│                                                                  │
│  [기초데이터] [등기부] [권리분석] [평가] [지도]                    │
│   ━━━━━━━━                                                       │
│                                                                  │
│  ┌─────────────────┐  ┌─────────────────────────────────────┐  │
│  │                 │  │ 기본 정보                            │  │
│  │   지적도 &       │  │ ┌─────────┬──────────────────┐      │  │
│  │   위치도         │  │ │ 물건번호 │ R-150_1          │      │  │
│  │   (지도 표시)    │  │ │ 담보소재지│ 서울 강남구...    │      │  │
│  │                 │  │ │ 물건유형 │ 아파트           │      │  │
│  │  [로드뷰 보기]   │  │ │ 담보형태 │ 토지+건물        │      │  │
│  │                 │  │ └─────────┴──────────────────┘      │  │
│  └─────────────────┘  │                                      │  │
│                       │ 면적 정보                            │  │
│  ┌─────────────────┐  │ ┌─────────┬──────────────────┐      │  │
│  │ 토지이용계획확인원│  │ │ 대지면적 │ 85.5 ㎡ (25.8평) │      │  │
│  │                 │  │ │ 건물면적 │ 102.3 ㎡(30.9평) │      │  │
│  │  [문서 보기]     │  │ │ 대지권비율│ 100%             │      │  │
│  │                 │  │ │ 건물비율 │ 100%             │      │  │
│  └─────────────────┘  │ └─────────┴──────────────────┘      │  │
│                       └─────────────────────────────────────┘  │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  감정평가 정보                                                    │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 감정평가구분 │ 일반감정      │ 감정평가일자 │ 2024-01-15     │  │
│  │ 감정평가기관 │ OO감정평가법인 │                               │  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │ 토지 감정평가액 │ 98,000,000원 │ 건물 감정평가액 │148,000,000원│  │
│  │ 기계 감정평가액 │     -        │ 제시외         │     -       │  │
│  │ 감정평가액 합계 │ 246,000,000원                 │  DD와 합계검증│  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                  │
│  === 물건 유형별 추가 정보 ===                                    │
│                                                                  │
│  ┌─ 아파트인 경우 ──────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  📊 KB시세 정보                                           │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │ KB시세      │ 450,000,000원  │ 분양면적 │ 84㎡(25평)│  │  │
│  │  │ 전세가      │ 300,000,000원  │ 평당시세 │ 18,000천원│  │  │
│  │  │ 조회일자    │ 2024-11-20     │ [시세 재조회]        │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │                                                           │  │
│  │  💡 KB시세 데이터 자동 조회 (또는 캡처 링크 제공)          │  │
│  │  🔗 [KB시세 직접 조회] ← 국민은행 부동산 시세 링크         │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌─ 근린상가/아파트형공장인 경우 ──────────────────────────────┐  │
│  │                                                           │  │
│  │  분양 정보                                                │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │ 분양면적    │ 120㎡(36평)    │ 분양가   │ 350,000천원│  │  │
│  │  │ 토지        │ 토지분양가      │ 건물     │ 건물분양가  │  │  │
│  │  │ 합계        │ 350,000,000원  │ 부가세   │ 35,000,000원│  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  📋 QA 관리                                                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ QA 입력         │ [질문 작성]                           ✏️ │  │
│  │ QA 알람         │ 🔔 미회신 QA 2건                          │  │
│  │ 실사 Assign 입력│ [담당자: 김평가]         [변경]           │  │
│  │ 추가자료 알람    │ 🔔 추가자료 요청 1건                      │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  📎 첨부 문서 (요약건축물대장 등)                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 파일명               │ 크기    │ 업로드일   │ 액션         │  │
│  │ 건축물대장.pdf       │ 2.5MB   │ 2024-01-15│ [보기][삭제] │  │
│  │ 토지이용계획확인.pdf  │ 1.8MB   │ 2024-01-15│ [보기][삭제] │  │
│  └──────────────────────────────────────────────────────────┘  │
│  [📤 파일 업로드]                                               │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  [💾 저장]  [❌ 취소]  [🔄 DD 데이터와 검증]                    │
└──────────────────────────────────────────────────────────────────┘
```

#### 📊 섹션 구성

**1. 지도 & 문서 영역 (좌측)**
- **지적도 & 위치도**
  - 카카오/네이버 지도 API 연동
  - 물건 위치 마커 표시
  - 주변 시설 정보
- **로드뷰**
  - 거리뷰 이미지 표시
  - 별도 팝업으로 확대 가능
- **토지이용계획확인원**
  - PDF 뷰어로 문서 표시
  - 다운로드 가능

**2. 기본 정보 (우측)**
- 물건번호 (자동 생성)
- 담보소재지 (주소)
- 물건유형 (드롭다운: 아파트/상가/토지 등)
- 담보형태 (토지, 건물, 토지+건물 등)
- 대지면적, 건물면적 (㎡와 평 자동 환산)
- 대지권비율, 건물비율

**3. 감정평가 정보**
- 감정평가구분 (일반감정/재감정)
- 감정평가일자, 감정평가기관
- 토지/건물/기계 감정평가액
- **DD와 합계 검증**: 자동 계산으로 일치 여부 확인

**4. 물건 유형별 추가 정보**

##### 아파트인 경우:
- **KB시세 정보** 
  - 자동 조회 (가능하면 API)
  - 또는 KB시세 사이트 링크 제공 + 캡처 업로드
  - 분양면적, 평당시세
  - 전세가
- **시세 재조회 버튼**: 최신 시세 업데이트

##### 근린상가/아파트형공장:
- 분양면적, 분양가
- 토지/건물 분양가 구분
- 부가세 자동 계산

**5. QA 관리**
- **QA 입력**: 평가자가 PM에게 질문
- **QA 알람**: 미회신 QA 개수 표시 (뱃지)
- **실사 Assign**: 실사 담당자 배정
- **추가자료 알람**: 요청된 추가 자료 알림

**6. 첨부 문서**
- 요약건축물대장
- 토지이용계획확인원
- 기타 참조 문서
- 파일 업로드/다운로드/삭제

#### 🎨 UI 요소

**탭 컨트롤**: 5개 탭 (기초데이터/등기부/권리분석/평가/지도)

**필드 유형**:
- 🔒 **자동 입력 필드**: 읽기 전용, 연한 회색 배경 (#F5F5F5)
  - DD에서 가져온 데이터
  - 자동 계산 값
- ✏️ **수동 입력 필드**: 편집 가능, 흰색 배경
  - 평가자가 직접 입력하는 정보
  - 포커스 시 파란색 테두리

**지도 컴포넌트**:
- WebView2 또는 CefSharp
- 카카오맵/네이버맵 API
- 좌표 정보 자동 표시

**KB시세 조회**:
- 옵션 1: 공공데이터 API 연동 (가능하면)
- 옵션 2: KB국민은행 부동산 시세 링크 제공 + 캡처 업로드 기능
- 조회 결과 캐싱 (당일 재조회 방지)

**QA 시스템**:
- 질문 작성 텍스트박스
- 미회신 QA 뱃지 (빨간색 숫자)
- QA 목록 모달 (클릭 시 팝업)

**파일 첨부**:
- 드래그앤드롭 지원
- 파일 유형 제한 (PDF, JPG, PNG)
- 파일 크기 제한 (10MB)

#### ⚙️ 기능

**데이터 로딩**:
- ✅ property_id 기준 데이터 로드
- ✅ DD 데이터와 자동 매핑
- ✅ 감정평가액 합계 검증
- ✅ ㎡ ↔ 평 자동 환산

**지도 통합**:
- ✅ 주소 → 좌표 변환 (Geocoding)
- ✅ 지적도 레이어 표시
- ✅ 로드뷰 연동
- ✅ 토지이용계획 PDF 뷰어

**시세 조회** (아파트):
- ✅ KB시세 자동 조회 (또는 캡처)
- ✅ 분양면적 자동 계산
- ✅ 평당시세 자동 계산
- ✅ 조회 결과 저장

**물건 유형별 폼 전환**:
- ✅ 물건유형 선택 → 해당 섹션 표시
- ✅ 아파트 → KB시세 섹션
- ✅ 상가/공장 → 분양 정보 섹션
- ✅ 토지 → 간소화된 폼

**QA 관리**:
- ✅ QA 작성/조회
- ✅ 미회신 QA 알림
- ✅ QA 답변 시 알림 발송
- ✅ QA 이력 추적

**첨부 문서**:
- ✅ 파일 업로드 (Supabase Storage)
- ✅ 파일 다운로드
- ✅ 파일 삭제
- ✅ PDF 미리보기

**검증 기능**:
- ✅ DD 데이터와 비교
- ✅ 감정평가액 합계 검증
- ✅ 필수 필드 검증
- ✅ 데이터 일관성 체크

**자동 저장**:
- ✅ 30초마다 자동 저장 (변경 사항 있을 때)
- ✅ 저장 상태 표시 (저장됨/저장중/오류)
- ✅ 변경 이력 기록 (audit_logs)

---

### 5. 물건 상세 - 등기부 탭

**파일**: `Views/PropertyDetailView.xaml` - Tab 2
**기획서**: `등기부(Ⅲ).md`

> **⚠️ 중요**: 등기부 탭은 OCR + **DD 데이터 크로스 체크**가 핵심. 단순 OCR 결과 표시가 아님.

#### 레이아웃

```
┌──────────────────────────────────────────────────────────────────┐
│  [기초데이터] [등기부] [권리분석] [평가] [지도]                    │
│                ━━━━━━                                            │
│                                                                  │
│  📄 등기부등본 PDF 목록                                           │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 지번    │파일명        │유형│OCR 상태│ 업로드일  │액션      │  │
│  │ R-150_1│land.pdf      │토지│ ✅완료 │2024-01-01│[보기][삭제]│  │
│  │ R-150_1│building.pdf  │건물│ ✅완료 │2024-01-01│[보기][삭제]│  │
│  │ R-150_2│registry.pdf  │토지│ 🔄처리중│2024-01-02│[보기][삭제]│  │
│  └──────────────────────────────────────────────────────────┘  │
│  [📤 PDF 업로드] [🔍 일괄 OCR 실행] [📊 OCR 진행상황: 2/3]       │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  === 지번별 등기부 정보 ===                                      │
│  [지번 선택: R-150_1 ▼]                                         │
│                                                                  │
│  ┌─ 물건지 비교 ──────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  등기부등본 주소:  서울 강남구 논현동 123-45                │  │
│  │  DD 주소 (C-1):   서울 강남구 논현동 123-45                │  │
│  │  일치여부: ✅ 일치                                         │  │
│  │                                                           │  │
│  │  담보물형태 (DD): 아파트                                   │  │
│  │  대지면적: 85.5㎡ (25.8평) ← DD/평*대지권비율              │  │
│  │  건물면적: 102.3㎡(30.9평) ← DD/평*건물비율               │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌─ 소유자 정보 (표제부) ─────────────────────────────────────┐  │
│  │                                                           │  │
│  │  🔗 DD 자동 연계: Sheet C-2                               │  │
│  │                                                           │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ 소유자명│등록번호      │최종지분│ 등기일    │등기원인│  │  │
│  │  │ 홍길동  │123456-****** │ 1/2   │2020-01-15│매매    │  │  │
│  │  │ 김철수  │654321-****** │ 1/2   │2020-01-15│매매    │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  │                                                           │  │
│  │  소유자 주소 (최다지분소유자):                             │  │
│  │  서울시 강남구 테헤란로 123, 456호                        │  │
│  │                                                           │  │
│  │  💡 지분 소유일 경우 모두 표시, 최다지분소유자 주소 기재   │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌─ 소유권에 관한 사항 (갑구) ─────────────────────────────────┐  │
│  │                                                           │  │
│  │  소유지분 외 권리 (가압류, 압류 등)                        │  │
│  │                                                           │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │순위│등기목적│접수정보      │권리자/채권자  │청구금액    │  │  │
│  │  │ 1  │가압류  │2024-01-25   │케이비캐피탈   │15,161,923원│  │  │
│  │  │ 2  │압류    │2025-01-25   │국민건강보험공단│ -         │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  │                                                           │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │비고 │임금채권추정│대상소유자│지번번호                   │  │  │
│  │  │     │           │          │R-150_1                    │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌─ (근)저당권 및 전세권 등 (을구) ────────────────────────────┐  │
│  │                                                           │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │순위│등기목적│접수정보   │근저당권자    │채권최고액       │  │  │
│  │  │ 1  │근저당권│2017-06-15│신한은행      │150,000,000원   │  │  │
│  │  │ 2  │근저당권│2019-03-20│국민은행      │80,000,000원    │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  │                                                           │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │채무자       │담보종류  │공장저당│대상소유자│지번번호     │  │  │
│  │  │홍길동       │일반      │ -      │홍길동    │R-150_1     │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌─ 추가 문서 ─────────────────────────────────────────────────┐  │
│  │ [등기부등본] [공장저당] [신탁원부]                          │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ⚠️ 특이사항: 지번별 접수일 차이                                 │
│  - 순위번호 1번 가압류 접수일:                                   │
│    01: 2025-01-03, 02: 2025-01-03, 03: 2025-01-09               │
│  - 순위번호 1번 근저당권 접수일:                                 │
│    01: 2025-01-03, 02: 2025-01-03, 03: 2025-01-09, 04: 2025-01-09│
│                                                                  │
│  [✏️ 수정] [💾 저장] [🔄 DD와 동기화]                            │
└──────────────────────────────────────────────────────────────────┘
```

#### 📊 핵심 기능

**1. PDF 파일 관리**
- **다중 파일 업로드**
  - 지번별로 여러 PDF 가능 (토지/건물 분리)
  - 드래그앤드롭 지원
  - 파일명 자동 매칭 (land.pdf, building.pdf)
- **파일 정보**
  - 지번일련번호 (R-150_1, R-150_2 등)
  - 유형 (토지/건물)
  - OCR 상태 (대기/처리중/완료/실패)
  - 업로드일

**2. OCR 처리**
- **일괄 OCR 실행**
  - 선택한 PDF들 일괄 처리
  - 진행상황 실시간 표시
  - 처리 완료 알림
- **OCR 상태 모니터링**
  - 🟢 완료: 초록색
  - 🔵 처리중: 파란색 + 스피너
  - 🔴 실패: 빨간색 + 오류 메시지
  - ⚪ 대기: 회색

**3. DD 데이터 크로스 체크** ⭐ 핵심

**물건지 비교**:
- 등기부등본 주소 vs DD Sheet C-1 주소
- 일치여부 자동 체크 (✅/❌)
- 불일치 시 경고 표시

**소유자 정보 (DD Sheet C-2 연계)**:
- 소유자 이름, 등록번호
- 최종지분 (1/2, 1/3 등)
- 지분소유일 경우 모든 소유자 표시
- 최다지분소유자 주소 자동 표시

**대지/건물 면적 (DD 연계)**:
- 담보물형태 (DD 정보)
- 대지면적 = DD정보/평 * 대지권비율
- 건물면적 = DD정보/평 * 건물비율
- 자동 계산 및 검증

**4. 지번별 등기부 관리**

- **지번 선택 드롭다운**
  - R-150_1, R-150_2, R-150_3 등
  - 지번 선택 → 해당 지번 등기부 표시
  - 지번별 독립적인 데이터

- **지번별 다른 접수일 처리**
  - 동일 순위번호라도 지번별로 접수일 다를 수 있음
  - 지번별 접수일 개별 표시
  - 특이사항 자동 감지 및 경고

**5. 소유권 정보 (갑구)**

- **가압류/압류 목록**
  - 순위번호, 등기목적
  - 접수정보 (날짜)
  - 권리자/채권자
  - 청구금액
  - 비고
  - 임금채권 추정 (Y/N)
  - 대상소유자
  - 지번번호

- **가압류/압류 외 권리**
  - 기타 소유권 제한사항 표시

**6. 근저당권 정보 (을구)**

- **근저당권 목록**
  - 순위번호, 등기목적
  - 접수정보 (날짜)
  - 근저당권자 (금융기관)
  - 채권최고액
  - 채무자
  - 담보종류 (일반/특정)
  - 공장저당 여부
  - 대상소유자
  - 지번번호

- **전세권**
  - 전세권 정보 (있는 경우)

**7. 추가 문서**

- **등기부등본**: OCR 원본 PDF
- **공장저당**: 공장저당 설정 문서 (해당시)
- **신탁원부**: 신탁 관련 문서 (해당시)

#### 🎨 UI 요소

**PDF 뷰어**:
- PDF.js 또는 WebView2
- 확대/축소/페이지 이동
- 다운로드 기능

**OCR 상태 뱃지**:
- 상태별 색상 코드
- 툴팁으로 상세 정보

**DD 연계 표시**:
- 🔗 "DD 자동 연계: Sheet C-1" 라벨
- DD 데이터 출처 명시
- 자동 계산 필드는 회색 배경

**일치 여부 아이콘**:
- ✅ 일치: 초록색 체크
- ❌ 불일치: 빨간색 X + 경고

**지번 선택기**:
- ComboBox (드롭다운)
- 지번 개수 표시 (총 5개)

**권리 그리드**:
- Blue Gray 헤더
- 순위번호 순 정렬
- 행 클릭 → 상세 정보
- 컨텍스트 메뉴 (편집/삭제)

#### ⚙️ 기능

**PDF 업로드**:
- ✅ Supabase Storage 업로드
- ✅ 파일명 검증 (PDF만)
- ✅ 파일 크기 제한 (50MB)
- ✅ 중복 파일 체크

**OCR 처리** (Python - 현재 제외, 나중에 구현):
- ⏳ Python 스크립트 실행
- ⏳ OCR 진행상황 모니터링
- ⏳ 결과 JSON 파싱
- ⏳ DB 저장

**DD 데이터 동기화**:
- ✅ Sheet C-1, C-2 데이터 로드
- ✅ 주소 비교 (문자열 유사도)
- ✅ 면적 자동 계산
- ✅ 소유자 정보 매핑

**데이터 편집**:
- ✅ OCR 오류 수정
- ✅ 수동 입력 지원
- ✅ 권리 추가/수정/삭제
- ✅ 변경 이력 저장

**지번별 관리**:
- ✅ 지번별 독립 데이터
- ✅ 지번 선택 시 자동 로드
- ✅ 지번별 접수일 개별 관리

**검증 기능**:
- ✅ DD와 일치 여부 체크
- ✅ 필수 필드 검증
- ✅ 접수일 논리적 순서 검증
- ✅ 중복 권리 체크

**자동 알림**:
- ⚠️ DD 불일치 경고
- ⚠️ 지번별 접수일 차이 알림
- ⚠️ 임금채권 추정 알림

---

### 6. 데이터 업로드

**파일**: `Views/DataUploadView.xaml`

#### 레이아웃
```
┌─────────────────────────────────────────────┐
│  데이터 업로드                              │
│                                             │
│  [엑셀 데이터 디스크] [등기부등본 PDF]       │
│   ━━━━━━━━━━━━━━━                         │
│                                             │
│  Step 1: 파일 선택                          │
│  ┌─────────────────────────────────────┐   │
│  │                                     │   │
│  │     [📁]                            │   │
│  │                                     │   │
│  │  파일을 드래그하거나 클릭하세요      │   │
│  │                                     │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  Step 2: 컬럼 매핑 (엑셀만)                 │
│  ┌─────────────────────────────────────┐   │
│  │ 엑셀 컬럼     →  DB 필드            │   │
│  │ 물건번호     →  property_number     │   │
│  │ 주소         →  address_full        │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  [업로드 시작]                              │
└─────────────────────────────────────────────┘
```

#### UI 요소
- **탭**: 엑셀 / PDF 업로드
- **드래그앤드롭 영역**: 점선 테두리
- **컬럼 매핑 그리드**: 
  - 엑셀 컬럼 목록
  - DB 필드 드롭다운
  - 자동 매핑 제안
- **프로그레스바**: 업로드 진행률
- **결과 요약**: 성공/실패 건수

#### 기능
- 다중 파일 업로드 (PDF)
- Excel 파싱 (EPPlus)
- 자동 컬럼 매핑 (이름 유사도)
- 배치 업로드 (비동기)
- 오류 로그

---

### 7. 물건 상세 - 권리분석/선순위 탭

**파일**: `Views/PropertyDetailView.xaml` - Tab 3
**기획서**: `선순위(Ⅴ).md` - **가장 복잡한 화면**

> **⚠️ 중요**: 이 화면은 **40+ 케이스 판단 로직**이 필요한 가장 복잡한 화면입니다.  
> 단순 선순위 목록이 아닌, **경매 상황별 자동 판단 시스템**입니다.

#### 레이아웃

```
┌──────────────────────────────────────────────────────────────────┐
│  [기초데이터] [등기부] [권리분석] [평가] [지도]                    │
│                      ━━━━━━━━                                    │
│                                                                  │
│  📊 경매사건 정보 (자동 로딩)                                     │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 선행경매│후행경매│최초법사가  │최초경매기일│최종경매회차│     │  │
│  │ ☑ 있음 │ □ 없음│150,000,000원│2024-01-15 │ 3회차     │     │  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │ 경매개시여부│관할법원  │경매사건번호  │경매신청기관          │  │
│  │ ✅ 개시    │서울중앙지법│2024타경12345│신한은행             │  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │ 경매개시일자│배당요구종기일│청구금액      │낙찰금액        │  │
│  │ 2023-12-01│2024-01-15   │120,000,000원│175,100,000원  │  │
│  └──────────────────────────────────────────────────────────┘  │
│  🔗 DD Sheet C-1 연계 | [📋 경매사건검색] [📄 당사자내역]       │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  === 전입/임차 현황 ===                                          │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 물건지/소유주 주소지 일치여부: □ 일치 ☑ 불일치               │  │
│  │ 소유주 전입: ☑ Y  □ N                                      │  │
│  │ 전입인(임차인): 김임차 | 전입일: 2022-01-15 | 주택공시가격: 조회│  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │ 경매열람자료: ☑ Y  □ N                                     │  │
│  │  ☑ 전입세대열람 (주택)     | 임차인: ☑ Y  □ N              │  │
│  │  □ 상가임대차열람 (상가)    | 임차인 배당요구신청: ☑ Y  □ N │  │
│  └──────────────────────────────────────────────────────────┘  │
│  🔗 전입세대열람, 상가임대차열람 캡처 첨부                        │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  === 선순위 분석 (자동 판단 + 수동 조정) ===                      │
│                                                                  │
│  ┌─ 선순위 구분별 금액 ──────────────────────────────────────┐  │
│  │                                                           │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │선순위 구분       │DD 금액 │평가자 반영금액│상세추정 근거│  │  │
│  │  ├────────────────────────────────────────────────────┤  │  │
│  │  │선순위근저당권    │120,000천│120,000천     │선순위 근저당│  │  │
│  │  │                │        │              │권 반영함.   │  │  │
│  │  ├────────────────────────────────────────────────────┤  │  │
│  │  │유치권 신고금액   │     -  │       -      │해당사항 없음│  │  │
│  │  ├────────────────────────────────────────────────────┤  │  │
│  │  │선순위소액보증금  │ 15,000천│ 15,000천     │배당요구종기│  │  │
│  │  │                │        │              │일 경과, 현황│  │  │
│  │  │                │        │              │조사서상 임차│  │  │
│  │  │                │        │              │인 확인, 배당│  │  │
│  │  │                │        │              │요구신청 반영│  │  │
│  │  ├────────────────────────────────────────────────────┤  │  │
│  │  │선순위임차보증금  │     -  │       -      │해당사항 없음│  │  │
│  │  ├────────────────────────────────────────────────────┤  │  │
│  │  │선순위 임금채권   │  5,000천│  5,000천     │임금채권 추정│  │  │
│  │  │                │        │              │가압류 확인, │  │  │
│  │  │                │        │              │근로복지공단 │  │  │
│  │  │                │        │              │임금자료 반영│  │  │
│  │  ├────────────────────────────────────────────────────┤  │  │
│  │  │당해세           │  3,000천│  3,000천     │당해세 추정  │  │  │
│  │  │                │        │              │반영함       │  │  │
│  │  ├────────────────────────────────────────────────────┤  │  │
│  │  │선순위 조세채권   │     -  │       -      │해당사항 없음│  │  │
│  │  ├────────────────────────────────────────────────────┤  │  │
│  │  │합계             │143,000천│143,000천     │            │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │                                                           │  │
│  │  [✏️ 수동 조정] [🔄 재계산] [💡 판단 로직 보기]             │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  === 등기부 권리 정보 (참조용) ===                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │접수정보      │근저당권자│채권최고액  │공시지가│건출시가표준액│  │
│  │2017-06-15   │신한은행  │150,000천  │조회    │조회          │  │
│  │2019-03-20   │국민은행  │ 80,000천  │조회    │조회          │  │
│  └──────────────────────────────────────────────────────────┘  │
│  🔗 등기부 탭 데이터 자동 연계                                   │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  === 배당 시뮬레이션 ===                                         │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  낙찰가액 (예상)          175,100,000원                    │  │
│  │  경매수수료 및 제세        -  5,327,000원                   │  │
│  │  ─────────────────────────────────────────────────────    │  │
│  │  낙찰 후 배당가능재원      169,773,000원                    │  │
│  │                                                           │  │
│  │  선순위 합계              -143,000,000원                    │  │
│  │  ─────────────────────────────────────────────────────    │  │
│  │  선순위차감 후 배당가능재원  26,773,000원                   │  │
│  │                                                           │  │
│  │  Loan Cap                  120,000,000원                   │  │
│  │  Cap 반영 배당액            26,773,000원 ✅                 │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                  │
│  === 위험도 평가 ===                                            │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  위험도: 🟡 중간                                           │  │
│  │                                                           │  │
│  │  📝 권장 의견:                                            │  │
│  │  - 선순위 합계가 낙찰가의 81.7%로 높은 편                  │  │
│  │  - 배당 후 회수 예상액 26,773천원 (회수율 22.3%)          │  │
│  │  - 임금채권 추정 포함으로 불확실성 존재                    │  │
│  │  - 추가 현황조사 권장                                      │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                  │
│  [💾 분석 저장] [📄 리포트 출력] [📊 권리분석 완료 체크]          │
└──────────────────────────────────────────────────────────────────┘
```

#### 🧠 핵심 로직: 40+ 케이스 판단 시스템

**선순위 판단은 다음 조건들의 조합으로 결정됩니다:**

**1. 담보물건종류**
- 아파트, 근린주택, 단독주택, 다세대, 다가구
- 토지
- 주택/토지 외: 상가, 공장

**2. 경매 상태**
- 경매개시 여부 (개시 / 미개시)
- 배당요구종기일 경과 여부 (경과 / 미경과)

**3. 자료 제출 여부**
- 현황조사서 제출 (O / X)
- 전입세대열람 제출 (O / X) - 주택
- 상가임대차열람 제출 (O / X) - 상가

**4. 임차인 확인**
- 임차인 확인 (O / X)
- 임차인 배당요구신청 (O / X)
- 임차일 vs 근저당설정일 (이전 / 이후)

**5. 물건지/소유주**
- 물건지 주소지, 소유주 주소지 일치 (일치 / 불일치)
- 소유주 전입 (Y / N)

**6. 채무자 유형 (임금채권 판단)**
- 개인
- 개인사업자 / 법인

#### 📋 선순위 소액보증금/임차보증금 판단 예시 (일부)

**케이스 1**: 아파트 + 경매개시 + 배당요구종기일 경과 + 현황조사서 O + 임차인 O + 배당요구신청 O
→ **결과**: 배당요구신청금액 확인 반영

**케이스 2**: 아파트 + 경매개시 + 배당요구종기일 경과 + 현황조사서 O + 임차인 O + 배당요구신청 X + 임차일 근저당설정일 이후
→ **결과**: 미반영 (후순위)

**케이스 3**: 아파트 + 경매개시 + 배당요구종기일 경과 + 현황조사서 O + 임차인 O + 배당요구신청 X + 임차일 근저당설정일 이전
→ **결과**: 선순위 임차보증금 반영

**케이스 4**: 아파트 + 경매미개시 + 전입세대열람 O + 전입인 O + 임차일 근저당설정일 이전
→ **결과**: 임차보증금 추정 반영

**케이스 5**: 토지 + 경매개시 + 배당요구종기일 미경과 + 현황조사서 X
→ **결과**: 토지이므로 임차인 없을 것으로 추정, 미반영

**케이스 6**: 상가 + 경매미개시 + 상가임대차열람 X + 물건지/소유자 주소 일치
→ **결과**: 상가 특성상 선순위보증금 없을 것으로 예상, 미반영

**... 총 40+ 케이스 ...**

#### 📋 선순위 임금채권 판단 예시

**케이스 1**: 개인 채무자
→ **결과**: 임금채권 발생 여지 없어 미반영

**케이스 2**: 법인 + 경매개시 + 배당요구종기일 경과 + 임금채권 배당요구신청 O
→ **결과**: 배당요구신청 확인 반영

**케이스 3**: 법인 + 경매미개시 + 임금채권 추정가압류 O
→ **결과**: 근로복지공단 임금자료 등 고려하여 추정 반영

**케이스 4**: 법인 + 경매개시 + 배당요구종기일 미경과 + 임금채권 배당요구신청 X + 임금채권 추정가압류 O
→ **결과**: 관련 가압류 확인되는바, 근로복지공단 임금자료 등 고려하여 반영

#### 🎨 UI 요소

**1. 경매사건 정보 카드**
- DD Sheet C-1 자동 연계
- 체크박스 (선행경매, 후행경매)
- 읽기 전용 필드 (자동 로딩)
- [경매사건검색] 버튼 → 외부 시스템 링크

**2. 전입/임차 현황 체크리스트**
- 여러 체크박스 (Y/N 선택)
- 조건별 입력 필드 활성화/비활성화
- 공시가격 조회 버튼

**3. 선순위 분석 그리드**
- DD 금액 (자동 로딩)
- 평가자 반영금액 (수동 조정 가능)
- 상세추정 근거 (자동 생성 텍스트)
- 합계 자동 계산

**4. 판단 로직 표시**
- [💡 판단 로직 보기] 버튼
- 모달로 적용된 케이스 설명 표시
- "배당요구종기일 경과 물건으로 현황조사서상 임차인 확인되며..." 등

**5. 등기부 권리 참조**
- 등기부 탭 데이터 자동 연계
- 읽기 전용 그리드
- 공시지가, 건출시가표준액 조회 버튼

**6. 배당 시뮬레이션 카드**
- 큰 숫자 표시
- 계산 과정 단계별 표시
- Cap 적용 여부 강조

**7. 위험도 평가**
- 색상 인디케이터 (🔴 높음 / 🟡 중간 / 🟢 낮음)
- AI 기반 권장 의견 (선택적)
- 비율 계산 (선순위/낙찰가 등)

#### ⚙️ 기능

**자동 판단 시스템**:
- ✅ 40+ 케이스 룰 엔진
- ✅ 조건별 자동 계산
- ✅ 상세추정 근거 자동 생성
- ✅ 주황색 강조 (평가자 입력 필요시)

**수동 조정**:
- ✅ DD 금액 무시하고 수동 입력
- ✅ 상세추정 근거 수정
- ✅ 케이스 강제 변경

**외부 연계**:
- ✅ 경매사건검색 (법원 시스템)
- ✅ 당사자내역 조회
- ✅ 기일내역검색
- ✅ 문건송달내역

**참조 데이터 조회**:
- ✅ 주택공시가격 조회 (공공데이터)
- ✅ 공시지가 조회
- ✅ 건출시가표준액 조회
- ✅ 근로복지공단 임금자료 (수동)

**배당 계산**:
- ✅ 낙찰가 기준 경매수수료 계산
- ✅ 배당가능재원 자동 계산
- ✅ Loan Cap 적용
- ✅ Mortgage Cap 적용 (해당시)

**위험도 평가**:
- ✅ 선순위/낙찰가 비율 계산
- ✅ 회수율 계산
- ✅ 불확실성 요인 체크
- ✅ 권장 의견 자동 생성

**리포트 생성**:
- ✅ 권리분석 보고서 Excel 출력
- ✅ PDF 출력
- ✅ 판단 근거 포함

#### 💾 데이터 저장

```csharp
public class RightAnalysis
{
    public Guid PropertyId { get; set; }
    
    // 경매사건 정보
    public bool 선행경매 { get; set; }
    public bool 후행경매 { get; set; }
    public decimal 최초법사가 { get; set; }
    public string 경매개시여부 { get; set; }
    public string 관할법원 { get; set; }
    // ...
    
    // 전입/임차 현황
    public bool 물건지소유주주소일치 { get; set; }
    public bool 소유주전입 { get; set; }
    public string 전입인 { get; set; }
    // ...
    
    // 선순위 분석
    public decimal 선순위근저당권_DD금액 { get; set; }
    public decimal 선순위근저당권_반영금액 { get; set; }
    public string 선순위근저당권_상세근거 { get; set; }
    
    public decimal 선순위소액보증금_반영금액 { get; set; }
    public string 선순위소액보증금_판단케이스 { get; set; }
    // ...
    
    // 배당 시뮬레이션
    public decimal 선순위합계 { get; set; }
    public decimal 배당가능재원 { get; set; }
    public decimal Cap반영배당액 { get; set; }
    
    // 위험도
    public string 위험도 { get; set; }  // "high"/"medium"/"low"
    public string 권장의견 { get; set; }
}

---

### 8. 물건 상세 - 평가 탭

**파일**: `Views/PropertyDetailView.xaml` - Tab 4
**기획서**: `평가(Ⅵ)_1. 아파트.md` 및 기타 유형별 평가 시트

> **⚠️ 중요**: 평가 탭은 단순 평가액 입력이 아닌, **사례 지도, 낙찰통계, XNPV 계산**을 통합한 고급 평가 시스템

#### 레이아웃 (아파트 기준)

```
┌──────────────────────────────────────────────────────────────────┐
│  [기초데이터] [등기부] [권리분석] [평가] [지도]                    │
│                            ━━━━                                  │
│                                                                  │
│  === 아파트 평가 ===                                             │
│  🔗 감정평가액 자동 연계: 246,000,000원 (기초데이터 탭)           │
│                                                                  │
│  ┌─ 기본 정보 ─────────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  단지명: 래미안 아파트          │ 평형: 84㎡ (25평)         │  │
│  │  층수: 15/25층                 │ 향: 남향                 │  │
│  │  전용면적: 84.5㎡              │ 공급면적: 112.3㎡        │  │
│  │  준공년도: 2010년              │ 총세대수: 500세대        │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  📊 낙찰가 통계 분석 (법원경매통계)                               │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  해당 단지 최근 낙찰 사례 (5건)                           │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │호수│평형│층│낙찰가│감정가│낙찰률│낙찰일│경매사건번호│  │  │
│  │  │102동│25│12│350백만│400백만│87.5%│2024-01│2024타경..│  │  │
│  │  │103동│25│8 │340백만│400백만│85.0%│2024-02│2024타경..│  │  │
│  │  │105동│25│18│365백만│400백만│91.3%│2024-03│2024타경..│  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │                                                           │  │
│  │  평균 낙찰률: 88.2%                                       │  │
│  │  예상 낙찰가: 217,000,000원 (감정평가액 × 88.2%)          │  │
│  └───────────────────────────────────────────────────────────┘  │
│  [📈 낙찰통계 더보기] ← 최근 1년 / 같은 단지 / 같은 평형          │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  📊 시세 조회 (KB국민은행)                                       │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  KB시세:       450,000,000원   │ 분양면적: 84㎡(25평)     │  │
│  │  전세가:       300,000,000원   │ 평당시세: 18,000천원     │  │
│  │  월세:         1,500,000원     │ 조회일자: 2024-11-20     │  │
│  │  시세 대비 감정평가액 비율: 54.7% (감정평가액 저평가)      │  │
│  └───────────────────────────────────────────────────────────┘  │
│  [🔍 시세 재조회] [📊 시세 추이 그래프]                          │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  🗺️ 사례 지도 (비교표준지 & 거래사례)                            │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │   [지도 영역]                                             │  │
│  │                                                           │  │
│  │   📍 현재 물건 (빨강)                                     │  │
│  │   🔵 비교표준지 1 (2024-01-01: 3,500천원/㎡)              │  │
│  │   🔵 비교표준지 2 (2024-06-01: 3,700천원/㎡)              │  │
│  │   🟢 거래사례 1 (2024-02-15: 350백만원, 실거래가)         │  │
│  │   🟢 거래사례 2 (2024-04-20: 365백만원, 실거래가)         │  │
│  │                                                           │  │
│  └───────────────────────────────────────────────────────────┘  │
│  [📌 사례 추가] [📋 비교 분석표] [📄 사례 보고서]                │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  💰 평가액 산정 (XNPV 기반)                                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                                                           │  │
│  │  === 캐시 플로우 입력 ===                                 │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │ 시점     │현금유입│현금유출│순현금흐름│ 비고         │  │  │
│  │  ├────────────────────────────────────────────────────┤  │  │
│  │  │ T0 (취득)│      0│200,000천│-200,000천│ Loan투입    │  │  │
│  │  │ T+6개월  │      0│  3,000천│  -3,000천│ 관리비등    │  │  │
│  │  │ T+12개월 │217,000│      0천│+217,000천│ 낙찰매각    │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │                                                           │  │
│  │  할인율: 12% (연)                                         │  │
│  │  [🔢 XNPV 계산]                                           │  │
│  │                                                           │  │
│  │  === 결과 ===                                            │  │
│  │  XNPV: 8,235천원                                         │  │
│  │  IRR: 14.5%                                              │  │
│  │  투자회수기간: 12개월                                     │  │
│  │                                                           │  │
│  │  투자 의견: 🟢 권장 (XNPV > 0, IRR > 할인율)              │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                  │
│  📋 평가 결론                                                    │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  최종 평가액: 217,000,000원 (낙찰통계 기준)                │  │
│  │                                                           │  │
│  │  평가 근거:                                               │  │
│  │  ☑ 감정평가액: 246,000천원                                │  │
│  │  ☑ 낙찰통계 평균 낙찰률: 88.2%                            │  │
│  │  ☑ KB시세: 450,000천원 (시세 대비 저평가)                │  │
│  │  ☑ 사례 지도: 주변 거래사례 350~365백만원                │  │
│  │  ☑ XNPV 분석: 8,235천원 (투자 권장)                      │  │
│  │                                                           │  │
│  │  평가자 의견:                                             │  │
│  │  [────────────────────────────────────────────────────]  │  │
│  │  │ 감정평가액 대비 낙찰통계 기반 평가액이 적정함.        │  │  │
│  │  │ 시세 대비 낮은 평가이나, 경매 리스크 고려시 합리적.   │  │  │
│  │  │ XNPV 양수로 투자 권장.                               │  │  │
│  │  └──────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  [💾 평가 저장] [📄 평가서 출력] [✅ 평가 완료 체크]              │
└──────────────────────────────────────────────────────────────────┘
```

#### 평가 유형별 차이

##### 1. 아파트 평가 (상세 설명 위 참조)
- KB시세 연동
- 낙찰통계 분석
- 사례 지도
- XNPV 계산

##### 2. 상가 평가
```
┌──────────────────────────────────────────────────────────────────┐
│  === 상가 평가 ===                                               │
│                                                                  │
│  기본 정보                                                       │
│  - 위치: 강남구 역삼동 상가                                      │
│  - 면적: 120㎡ (36평)                                           │
│  - 층수: 1층 (로드샵)                                           │
│                                                                  │
│  임대차 현황                                                     │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 보증금:   50,000,000원    │ 월세:    3,000,000원          │  │
│  │ 임대면적: 120㎡           │ 평당월세: 83,333원/㎡         │  │
│  │ 임차인:   OO식당          │ 계약종료: 2025-12-31          │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                  │
│  수익환원법 평가                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 연간 임대수익: 36,000,000원 (월세 × 12)                    │  │
│  │ 환원율: 8.0%                                               │  │
│  │ 환원가액: 450,000,000원 (36,000천 / 0.08)                  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                  │
│  낙찰가 통계 (주변 상가)                                         │
│  평균 낙찰률: 75.3% (경험적 통계)                                │
│  예상 낙찰가: 338,850,000원                                      │
│                                                                  │
│  최종 평가액: 338,850,000원                                      │
└──────────────────────────────────────────────────────────────────┘
```

##### 3. 토지 평가
```
┌──────────────────────────────────────────────────────────────────┐
│  === 토지 평가 ===                                               │
│                                                                  │
│  기본 정보                                                       │
│  - 지목: 대지           │ 면적: 500㎡ (150평)                   │
│  - 용도지역: 제2종일반주거지역                                   │
│  - 건폐율: 60%          │ 용적률: 200%                          │
│                                                                  │
│  공시지가 기준 평가                                              │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 공시지가: 3,000,000원/㎡                                   │  │
│  │ 토지면적: 500㎡                                            │  │
│  │ 공시지가 기준가액: 1,500,000천원                            │  │
│  │ 시세반영률: 70%                                            │  │
│  │ 예상 시가: 1,050,000천원                                   │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                  │
│  낙찰가 통계 (주변 토지)                                         │
│  평균 낙찰률: 65.0%                                              │
│  예상 낙찰가: 682,500,000원                                      │
│                                                                  │
│  최종 평가액: 682,500,000원                                      │
└──────────────────────────────────────────────────────────────────┘
```

#### 🎨 UI 요소

**1. 낙찰통계 그리드**
- Blue Gray 헤더
- 호수, 평형, 층, 낙찰가, 감정가, 낙찰률, 낙찰일, 경매사건번호
- 평균 낙찰률 자동 계산
- [낙찰통계 더보기] 버튼 → 모달 팝업

**2. 시세 조회 카드**
- KB시세 자동 연동 (기초데이터 탭과 동일)
- 시세 대비 감정평가액 비율 자동 계산
- 저평가/고평가 강조 표시

**3. 사례 지도**
- 카카오맵/네이버맵 API
- 마커 클릭 → 사례 상세 정보 툴팁
- 비교표준지 (파란색)
- 거래사례 (초록색)
- 현재 물건 (빨간색)

**4. XNPV 계산기**
- 캐시플로우 입력 그리드
- 시점별 현금유입/유출 입력
- 할인율 입력
- XNPV, IRR 자동 계산
- 투자 의견 자동 생성 (XNPV > 0 → 권장)

**5. 평가 결론 카드**
- 최종 평가액 (큰 숫자 표시)
- 평가 근거 체크리스트
- 평가자 의견 텍스트박스 (자유 입력)

**6. 액션 버튼**
- [💾 평가 저장]: DB 저장
- [📄 평가서 출력]: PDF 리포트 생성
- [✅ 평가 완료 체크]: 대시보드 상태 업데이트

#### ⚙️ 기능

**낙찰통계 분석**:
- ✅ 법원경매통계 크롤링 (또는 수동 입력)
- ✅ 같은 단지, 같은 평형 필터링
- ✅ 최근 1년 데이터 우선
- ✅ 평균 낙찰률 자동 계산
- ✅ 예상 낙찰가 자동 산정

**시세 조회**:
- ✅ KB시세 API 연동
- ✅ 전세가, 월세 조회
- ✅ 시세 대비 감정평가액 비율 계산
- ✅ 시세 추이 그래프 (시계열)

**사례 지도**:
- ✅ 비교표준지 마커 표시
- ✅ 거래사례 마커 표시
- ✅ 툴팁으로 상세 정보
- ✅ 사례 추가/수정/삭제
- ✅ 비교 분석표 생성

**XNPV 계산**:
- ✅ 캐시플로우 입력 (엑셀 스타일)
- ✅ 할인율 설정
- ✅ XNPV 자동 계산 (Excel 함수와 동일)
- ✅ IRR 자동 계산
- ✅ 투자회수기간 계산

**평가액 산정**:
- ✅ 다중 방법론 지원
  - 감정평가액 기준
  - 낙찰통계 기준 (권장)
  - KB시세 기준
  - 사례 비교법
  - XNPV 기준
- ✅ 최종 평가액 자동 제안
- ✅ 평가자 수동 조정 가능

**리포트 생성**:
- ✅ 평가서 PDF 출력
- ✅ 낙찰통계 그래프 포함
- ✅ 사례 지도 이미지 포함
- ✅ XNPV 분석표 포함

**평가 완료 처리**:
- ✅ 대시보드 "평가액확정" 체크박스 자동 업데이트
- ✅ 평가 이력 저장
- ✅ 알림 발송 (PM에게)

---

### 9. 물건 상세 - 지도 탭

**파일**: `Views/PropertyDetailView.xaml` - Tab 5

#### 레이아웃
```
┌─────────────────────────────────────────────┐
│  [기초데이터] [등기부] [권리분석] [평가] [지도]│
│                                    ━━━━      │
│                                             │
│  레이어 선택                                │
│  ☑ 지적도  ☐ 위성  ☐ 로드뷰  ☐ 토지이용계획│
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │                                     │   │
│  │          [지도 표시 영역]            │   │
│  │                                     │   │
│  │            📍 물건 위치              │   │
│  │                                     │   │
│  │                                     │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  물건 정보                                  │
│  주소: 서울시 강남구...                     │
│  매매가: 450,000,000원                      │
└─────────────────────────────────────────────┘
```

#### UI 요소
- **레이어 체크박스**: 다중 선택
- **지도 영역**: WebView2 또는 CefSharp
- **마커**: 물건 위치 표시
- **정보 패널**: 우측 고정

#### 기능
- HTML 지도 코드 임베딩
- C# ↔ JavaScript 통신
- 레이어 토글
- 마커 클릭 → 정보 표시

---

### 10. 선순위 관리

**파일**: `Views/SeniorRightsView.xaml`

#### 레이아웃
```
┌─────────────────────────────────────────────┐
│  선순위 관리                                │
│                                             │
│  물건: P-001 (서울 강남구...)               │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ 순위 | 유형 | 권리자 | 채권액 | 일자│   │
│  │ 1    | 근저당| 은행A | 100M  | ...  │   │
│  │ 2    | 가압류| 채권자B| 50M  | ...  │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  [+ 추가] [수정] [삭제]                     │
│                                             │
│  선순위 합계: 150,000,000원                  │
└─────────────────────────────────────────────┘
```

#### 기능
- 권리 추가/수정/삭제
- 순위 자동 정렬
- 합계 자동 계산
- 유형별 필터링

---

### 11-12. 경매/공매 일정

**파일**: `Views/AuctionScheduleView.xaml`, `PublicSaleScheduleView.xaml`

#### 레이아웃 (공통)
```
┌─────────────────────────────────────────────┐
│  경매 일정                                  │
│                                             │
│  [달력 보기] [리스트 보기]                   │
│   ━━━━━━━                                  │
│                                             │
│  2024년 1월                                 │
│  ┌─────────────────────────────────────┐   │
│  │ 월  화  수  목  금  토  일          │   │
│  │ 1   2   3   4   5   6   7          │   │
│  │ 8   9  10  11 [12] 13  14          │   │
│  │     📍P-001  📍P-003                │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  선택된 날짜의 일정                          │
│  - P-001: 서울 강남 아파트 (최저가 300M)    │
│  - P-003: 서울 서초 상가 (최저가 150M)      │
└─────────────────────────────────────────────┘
```

#### UI 요소
- **탭**: 달력 / 리스트
- **달력**: 일정 표시
- **일정 리스트**: 선택 날짜
- **필터**: 법원, 지역

---

### 13. 통계 대시보드

**파일**: `Views/StatisticsView.xaml`

#### 레이아웃
```
┌─────────────────────────────────────────────┐
│  통계 분석                                  │
│                                             │
│  필터: [기간] [지역] [유형]                  │
│                                             │
│  주요 지표                                  │
│  ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ │
│  │ 총물건│ │ 평균가│ │ 회수율│ │ 낙찰율│ │
│  │ 120개 │ │ 350M │ │  68% │ │  82% │ │
│  └───────┘ └───────┘ └───────┘ └───────┘ │
│                                             │
│  월별 추이                                  │
│  ┌─────────────────────────────────────┐   │
│  │         📊 차트 (LiveCharts)        │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  [Excel 출력]                               │
└─────────────────────────────────────────────┘
```

#### 기능
- 필터링 (기간, 지역, 유형)
- 차트 시각화 (막대, 선, 파이)
- Excel 출력
- 통계 데이터 조회 (Supabase)

---

### 14. 사용자 관리

**파일**: `Views/UserManagementView.xaml`

#### 레이아웃
```
┌─────────────────────────────────────────────┐
│  사용자 관리                                │
│                                             │
│  [+ 사용자 추가]                            │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ 이름 | 이메일 | 역할 | 상태 | 동작 │   │
│  │ 홍길동| hong@..| PM | 활성 | [수정]│   │
│  │ 김철수| kim@.. | 평가자| 활성|[수정]│   │
│  └─────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
```

#### 기능
- 사용자 추가/수정/삭제
- 역할 할당
- 상태 변경 (활성/비활성)
- Supabase Auth 연동

---

### 15. 설정 관리

**파일**: `Views/SettingsView.xaml`

#### 카테고리

##### 계산 수식
```
┌─────────────────────────────────────────────┐
│  계산 수식 설정                             │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ 수식명 | 표현식 | 적용대상 | [수정]│   │
│  │ 회수율| 시세*0.7| 아파트 | [수정] │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  [+ 수식 추가]                              │
└─────────────────────────────────────────────┘
```

##### 데이터 매핑
```
┌─────────────────────────────────────────────┐
│  데이터 매핑 설정                            │
│                                             │
│  엑셀 컬럼 → DB 필드 매핑 규칙               │
│  ┌─────────────────────────────────────┐   │
│  │ 물건번호 → property_number          │   │
│  │ 주소 → address_full                 │   │
│  └─────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
```

##### 시스템 환경
```
┌─────────────────────────────────────────────┐
│  시스템 환경 설정                            │
│                                             │
│  OCR 배치 크기: [50]                        │
│  최대 파일 크기: [50] MB                    │
│  자동 저장 간격: [5] 분                     │
└─────────────────────────────────────────────┘
```

---

### 16. 작업 이력

**파일**: `Views/AuditLogsView.xaml`

#### 레이아웃
```
┌─────────────────────────────────────────────┐
│  작업 이력                                  │
│                                             │
│  필터: [사용자] [날짜] [액션]                │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ 날짜 | 사용자| 액션 | 대상 | 상세 │   │
│  │ 01-01| 홍길동| 수정 | P-001|[보기]│   │
│  │ 01-01| 김철수| 추가 | P-002|[보기]│   │
│  └─────────────────────────────────────┘   │
│                                             │
│  [Excel 출력]                               │
└─────────────────────────────────────────────┘
```

#### 기능
- 모든 데이터 변경 추적
- 변경 전/후 비교
- 되돌리기 (선택적)
- 필터링 및 검색

---

## 공통 UI 패턴

### 모달/다이얼로그
- 확인 모달: Yes/No 버튼
- 입력 모달: Form + Save/Cancel
- 알림 모달: 메시지 + OK

### 데이터 그리드
- Blue Gray 헤더
- 행 Hover 효과
- 정렬 (컬럼 클릭)
- 페이지네이션
- 체크박스 (다중 선택)

### 폼 입력
- 라벨 + 입력 필드
- 필수 표시 (*)
- 에러 메시지 (빨간색)
- 도움말 (물음표 아이콘)

### 버튼 그룹
- Primary: 주요 액션
- Secondary: 취소, 닫기
- Danger: 삭제

---

## 화면 간 데이터 흐름

```
Login → Dashboard → Property List → Property Detail
                       ↓                    ↓
                  Data Upload          (탭 전환)
                       ↓
                  OCR Process
                       ↓
                Registry Data → Rights Analysis → Evaluation
```

---

## 구현 우선순위 요약

1. **Week 1-2**: Login, Dashboard, Property List
2. **Week 3-4**: Property Detail (기초데이터, 등기부)
3. **Week 4-5**: Data Upload, OCR Integration
4. **Week 5-6**: Rights Analysis, Evaluation
5. **Week 6-7**: Map, Statistics, Admin Features

---

## 다음 단계

1. 각 화면별 XAML 작성
2. ViewModel 구현
3. Supabase 서비스 연동
4. 화면 간 네비게이션 구현
5. 사용자 테스트 및 피드백

