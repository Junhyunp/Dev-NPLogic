# NPLogic ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¬¸ì„œ

> **ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-01-21  
> **ëŒ€ìƒ**: ì£¼ë‹ˆì–´ ê°œë°œì / ì‹ ê·œ ì¸ìˆ˜ì¸ê³„ íŒ€  
> **í•µì‹¬ íŒŒì¼**: `RightAnalysisRuleEngine.cs`, `XnpvCalculator.cs`

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ê¶Œë¦¬ë¶„ì„ ë£° ì—”ì§„](#1-ê¶Œë¦¬ë¶„ì„-ë£°-ì—”ì§„)
3. [ì„ ìˆœìœ„ ê³„ì‚° ë¡œì§](#2-ì„ ìˆœìœ„-ê³„ì‚°-ë¡œì§)
4. [XNPV ê³„ì‚°](#3-xnpv-ê³„ì‚°)
5. [ê²½ë§¤/ê³µë§¤ ì‹œë‚˜ë¦¬ì˜¤](#4-ê²½ë§¤ê³µë§¤-ì‹œë‚˜ë¦¬ì˜¤)
6. [ë°°ë‹¹ ì‹œë®¬ë ˆì´ì…˜](#5-ë°°ë‹¹-ì‹œë®¬ë ˆì´ì…˜)
7. [ì—‘ì…€ ìˆ˜ì‹ ë§¤í•‘](#6-ì—‘ì…€-ìˆ˜ì‹-ë§¤í•‘)
8. [ìš©ì–´ ì‚¬ì „](#7-ìš©ì–´-ì‚¬ì „)

---

## ê°œìš”

### NPLogicì´ í•´ê²°í•˜ëŠ” ë¬¸ì œ

NPLogicì€ **NPL(Non-Performing Loan, ë¶€ì‹¤ì±„ê¶Œ)** í‰ê°€ë¥¼ ìë™í™”í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë°ì´í„°ë””ìŠ¤í¬    â”‚  â† ì€í–‰ì—ì„œ ì œê³µí•˜ëŠ” ì—‘ì…€ íŒŒì¼
â”‚  (Excel)        â”‚     (ì°¨ì£¼ ì •ë³´, ëŒ€ì¶œ ì •ë³´, ë‹´ë³´ ì •ë³´)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ê¶Œë¦¬ë¶„ì„       â”‚  â† ì„ ìˆœìœ„ íŒë‹¨, ë°°ë‹¹ ì‹œë®¬ë ˆì´ì…˜
â”‚   (RuleEngine)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   í‰ê°€/íšŒìˆ˜ìœ¨    â”‚  â† ì‹œë‚˜ë¦¬ì˜¤ë³„ ë‚™ì°°ê°€ ì˜ˆì¸¡
â”‚   ê³„ì‚°           â”‚     XNPV, IRR ê³„ì‚°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ê²°ê³¼ ë³´ê³ ì„œ    â”‚  â† ë¹„í•µì‹¬ ì „ì²´ ì–‘ì‹ ì¶œë ¥
â”‚   (Excel)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

| ì˜ì—­ | í´ë˜ìŠ¤ | ì—­í•  |
|------|--------|------|
| **ê¶Œë¦¬ë¶„ì„** | `RightAnalysisRuleEngine` | 40+ ì¼€ì´ìŠ¤ ë£° ê¸°ë°˜ ì„ ìˆœìœ„ íŒë‹¨ |
| **XNPV ê³„ì‚°** | `XnpvCalculator` | í˜„ê¸ˆíë¦„ ìˆœí˜„ì¬ê°€ì¹˜ ê³„ì‚° |
| **ë°°ë‹¹ ê³„ì‚°** | ViewModel ë‚´ ë¡œì§ | ê²½ë§¤/ê³µë§¤ ë°°ë‹¹ ì‹œë®¬ë ˆì´ì…˜ |

---

## 1. ê¶Œë¦¬ë¶„ì„ ë£° ì—”ì§„

### 1.1 ê°œìš”

`RightAnalysisRuleEngine`ì€ ë¬¼ê±´ì˜ ê¶Œë¦¬ ìƒíƒœë¥¼ ë¶„ì„í•˜ì—¬ **ì„ ìˆœìœ„ ì±„ê¶Œ**ì„ íŒë‹¨í•©ë‹ˆë‹¤.

```
ğŸ“ ìœ„ì¹˜: src/NPLogic.Core/Services/RightAnalysisRuleEngine.cs
```

### 1.2 íŒë‹¨ ìˆœì„œ

```csharp
public void ApplyRules(RightAnalysis analysis, Property? property)
{
    // 1. ë¬¼ê±´ ìœ í˜• ê²°ì • (ì£¼íƒ/í† ì§€/ìƒê°€)
    var propertyType = DeterminePropertyType(property);

    // 2. ì„ ìˆœìœ„ ê·¼ì €ë‹¹ê¶Œ íŒë‹¨
    ApplySeniorMortgageRules(analysis);

    // 3. ìœ ì¹˜ê¶Œ íŒë‹¨
    ApplyLienRules(analysis);

    // 4. ì„ ìˆœìœ„ ì†Œì•¡ë³´ì¦ê¸ˆ/ì„ì°¨ë³´ì¦ê¸ˆ íŒë‹¨ (40+ ì¼€ì´ìŠ¤)
    ApplyDepositRules(analysis, propertyType);

    // 5. ì„ ìˆœìœ„ ì„ê¸ˆì±„ê¶Œ íŒë‹¨
    ApplyWageClaimRules(analysis);

    // 6. ë‹¹í•´ì„¸ ë° ì„ ìˆœìœ„ ì¡°ì„¸ì±„ê¶Œ íŒë‹¨
    ApplyTaxRules(analysis);
}
```

### 1.3 ë¬¼ê±´ ìœ í˜• ë¶„ë¥˜

| ìœ í˜• | ì½”ë“œ | í¬í•¨ ë¬¼ê±´ |
|------|------|----------|
| **ì£¼íƒ** | `Residential` | ì•„íŒŒíŠ¸, ë¹Œë¼, ë‹¤ì„¸ëŒ€, ë‹¤ê°€êµ¬, ë‹¨ë…ì£¼íƒ |
| **í† ì§€** | `Land` | ëŒ€ì§€, ì„ì•¼, ë†ì§€ ë“± |
| **ìƒê°€/ê³µì¥** | `Commercial` | ìƒê°€, ê³µì¥, ì‚¬ë¬´ì‹¤, ì°½ê³  |

```csharp
private PropertyCategory DeterminePropertyType(Property? property)
{
    var type = property?.PropertyType?.ToLower() ?? "";

    if (type.Contains("í† ì§€") || type.Contains("land"))
        return PropertyCategory.Land;

    if (type.Contains("ìƒê°€") || type.Contains("ê³µì¥"))
        return PropertyCategory.Commercial;

    return PropertyCategory.Residential;  // ê¸°ë³¸ê°’: ì£¼íƒ
}
```

### 1.4 ì¼€ì´ìŠ¤ íŒë‹¨ íë¦„ë„

#### ì£¼íƒ ë¬¼ê±´ ì¼€ì´ìŠ¤ (CASE_R1 ~ CASE_R18)

```mermaid
flowchart TD
    A[ì£¼íƒ ë¬¼ê±´] --> B{ê²½ë§¤ ìƒíƒœ?}
    
    B -->|ê°œì‹œ + ì¢…ê¸°ì¼ ê²½ê³¼| C{í˜„í™©ì¡°ì‚¬ì„œ?}
    B -->|ê°œì‹œ + ì¢…ê¸°ì¼ ë¯¸ê²½ê³¼| D{í˜„í™©ì¡°ì‚¬ì„œ?}
    B -->|ë¯¸ê°œì‹œ| E{ì „ì…ì„¸ëŒ€ì—´ëŒ?}
    
    C -->|ìˆìŒ| C1{ì„ì°¨ì¸?}
    C1 -->|ìˆìŒ + ë°°ë‹¹ìš”êµ¬| CASE_R1[CASE_R1: ë°°ë‹¹ìš”êµ¬ê¸ˆì•¡ ë°˜ì˜]
    C1 -->|ìˆìŒ + ë¯¸ìš”êµ¬ + í›„ìˆœìœ„| CASE_R2[CASE_R2: ë¯¸ë°˜ì˜]
    C1 -->|ìˆìŒ + ë¯¸ìš”êµ¬ + ì„ ìˆœìœ„| CASE_R3[CASE_R3: ì„ì°¨ë³´ì¦ê¸ˆ ë°˜ì˜]
    C1 -->|ì—†ìŒ| CASE_R4[CASE_R4: ë¯¸ë°˜ì˜]
    
    D -->|ìˆìŒ| D1{ì„ì°¨ì¸?}
    D1 -->|ìˆìŒ + ë°°ë‹¹ìš”êµ¬| CASE_R5[CASE_R5: ë°˜ì˜]
    D1 -->|ìˆìŒ + í›„ìˆœìœ„| CASE_R6[CASE_R6: ì†Œì•¡ë³´ì¦ê¸ˆ ë°˜ì˜]
    D1 -->|ìˆìŒ + ì„ ìˆœìœ„| CASE_R7[CASE_R7: ì„ ìˆœìœ„ë³´ì¦ê¸ˆ ë°˜ì˜]
    D1 -->|ì—†ìŒ| CASE_R8[CASE_R8: ë¯¸ë°˜ì˜]
    
    D -->|ì—†ìŒ| D2{ì „ì…ì„¸ëŒ€ì—´ëŒ?}
    D2 -->|ìˆìŒ + ì„ì°¨ì¸ í›„ìˆœìœ„| CASE_R9[CASE_R9: ì†Œì•¡ë³´ì¦ê¸ˆ ì¶”ì •]
    D2 -->|ìˆìŒ + ì„ì°¨ì¸ ì„ ìˆœìœ„| CASE_R10[CASE_R10: ì„ ìˆœìœ„ë³´ì¦ê¸ˆ ì¶”ì •]
    D2 -->|ìˆìŒ + ì„ì°¨ì¸ ì—†ìŒ| CASE_R11[CASE_R11: ë¯¸ë°˜ì˜]
    D2 -->|ì—†ìŒ + ì£¼ì†Œë¶ˆì¼ì¹˜| CASE_R12[CASE_R12: ë³´ìˆ˜ì  ì¶”ì •]
    D2 -->|ì—†ìŒ + ì£¼ì†Œì¼ì¹˜| CASE_R13[CASE_R13: ë¯¸ë°˜ì˜]
    
    E -->|ìˆìŒ + í›„ìˆœìœ„| CASE_R14[CASE_R14: ì†Œì•¡ë³´ì¦ê¸ˆ ì¶”ì •]
    E -->|ìˆìŒ + ì„ ìˆœìœ„| CASE_R15[CASE_R15: ì„ì°¨ë³´ì¦ê¸ˆ ì¶”ì •]
    E -->|ìˆìŒ + ì—†ìŒ| CASE_R16[CASE_R16: ë¯¸ë°˜ì˜]
    E -->|ì—†ìŒ + ì£¼ì†Œë¶ˆì¼ì¹˜| CASE_R17[CASE_R17: ë³´ìˆ˜ì  ì¶”ì •]
    E -->|ì—†ìŒ + ì£¼ì†Œì¼ì¹˜| CASE_R18[CASE_R18: ë¯¸ë°˜ì˜]
```

### 1.5 ì¼€ì´ìŠ¤ë³„ ìƒì„¸

#### ê²½ë§¤ê°œì‹œ + ë°°ë‹¹ìš”êµ¬ì¢…ê¸°ì¼ ê²½ê³¼ (CASE_R1 ~ R4)

| ì¼€ì´ìŠ¤ | ì¡°ê±´ | ê²°ê³¼ | ê·¼ê±° ë¬¸êµ¬ |
|--------|------|------|----------|
| **R1** | í˜„í™©ì¡°ì‚¬ì„œO + ì„ì°¨ì¸O + ë°°ë‹¹ìš”êµ¬O | DDê¸ˆì•¡ ë°˜ì˜ | "ë°°ë‹¹ìš”êµ¬ì¢…ê¸°ì¼ ê²½ê³¼ ë¬¼ê±´ìœ¼ë¡œ í˜„í™©ì¡°ì‚¬ì„œìƒ ì„ì°¨ì¸ í™•ì¸ë˜ë©° ê²½ë§¤ì—´ëŒìë£Œìƒ ì„ì°¨ì¸ ë°°ë‹¹ìš”êµ¬ì‹ ì²­ê¸ˆì•¡ í™•ì¸ë°˜ì˜í•¨." |
| **R2** | í˜„í™©ì¡°ì‚¬ì„œO + ì„ì°¨ì¸O + ë°°ë‹¹ìš”êµ¬X + í›„ìˆœìœ„ | ë¯¸ë°˜ì˜ | "ë°°ë‹¹ìš”êµ¬ì¢…ê¸°ì¼ ê²½ê³¼ ë¬¼ê±´ìœ¼ë¡œ í˜„í™©ì¡°ì‚¬ì„œìƒ ì„ì°¨ì¸ í™•ì¸ë˜ë©° ì„ì°¨ì¸ ë°°ë‹¹ìš”êµ¬ì‹ ì²­ ì—†ì–´ ë¯¸ë°˜ì˜í•¨." |
| **R3** | í˜„í™©ì¡°ì‚¬ì„œO + ì„ì°¨ì¸O + ë°°ë‹¹ìš”êµ¬X + ì„ ìˆœìœ„ | ì„ì°¨ë³´ì¦ê¸ˆ ë°˜ì˜ | "ì„ì°¨ì¼ ê³ ë ¤í•˜ì—¬ ì„ ìˆœìœ„ ì„ì°¨ë³´ì¦ê¸ˆ ë°˜ì˜í•¨." |
| **R4** | í˜„í™©ì¡°ì‚¬ì„œO + ì„ì°¨ì¸X | ë¯¸ë°˜ì˜ | "ë°°ë‹¹ìš”êµ¬ì¢…ê¸°ì¼ ê²½ê³¼ ë¬¼ê±´ìœ¼ë¡œ ì œì‹œëœ ê²½ë§¤ì—´ëŒìë£Œ í˜„í™©ì¡°ì‚¬ì„œìƒ ì„ì°¨ì¸ ì—†ì–´ ë¯¸ë°˜ì˜í•¨." |

#### í† ì§€ ë¬¼ê±´ ì¼€ì´ìŠ¤ (CASE_L1 ~ L4)

| ì¼€ì´ìŠ¤ | ì¡°ê±´ | ê²°ê³¼ |
|--------|------|------|
| **L1** | ê°œì‹œ + ì¢…ê¸°ì¼ê²½ê³¼ + í˜„í™©ì¡°ì‚¬ì„œO | ë¯¸ë°˜ì˜ (í† ì§€ì´ë¯€ë¡œ ì„ì°¨ì¸ ì—†ìŒ) |
| **L2** | ê°œì‹œ + ì¢…ê¸°ì¼ë¯¸ê²½ê³¼ + í˜„í™©ì¡°ì‚¬ì„œO | ë¯¸ë°˜ì˜ |
| **L3** | ê°œì‹œ + ì¢…ê¸°ì¼ë¯¸ê²½ê³¼ + í˜„í™©ì¡°ì‚¬ì„œX | ë¯¸ë°˜ì˜ |
| **L4** | ë¯¸ê°œì‹œ | ë¯¸ë°˜ì˜ |

#### ìƒê°€/ê³µì¥ ì¼€ì´ìŠ¤ (CASE_C1 ~ C15)

ì£¼íƒê³¼ ìœ ì‚¬í•˜ë‚˜ **ìƒê°€ì„ëŒ€ì°¨ì—´ëŒì„œ**ë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•©ë‹ˆë‹¤.

### 1.6 ì†Œì•¡ë³´ì¦ê¸ˆ ì¶”ì • ë¡œì§

ê²½ë§¤ê°œì‹œ ë¯¸ê°œì‹œ ë˜ëŠ” ì „ì…ì„¸ëŒ€ì—´ëŒ ì—†ì„ ë•Œ ë³´ìˆ˜ì  ì¶”ì •:

```csharp
private decimal EstimateSmallDeposit(decimal? housingOfficialPrice)
{
    // 2024ë…„ ê¸°ì¤€ ì†Œì•¡ì„ì°¨ì¸ ìµœìš°ì„ ë³€ì œê¸ˆ
    if (housingOfficialPrice.HasValue)
    {
        if (housingOfficialPrice.Value > 900000000)  // 9ì–µ ì´ˆê³¼
            return 55000000;  // 5,500ë§Œì› (ì„œìš¸)
        else if (housingOfficialPrice.Value > 600000000)  // 6ì–µ ì´ˆê³¼
            return 37000000;  // 3,700ë§Œì›
        else
            return 25000000;  // 2,500ë§Œì›
    }
    return 55000000;  // ê¸°ë³¸ê°’
}
```

---

## 2. ì„ ìˆœìœ„ ê³„ì‚° ë¡œì§

### 2.1 ì„ ìˆœìœ„ í•­ëª©

NPLogicì—ì„œ ê´€ë¦¬í•˜ëŠ” ì„ ìˆœìœ„ í•­ëª©:

| í•­ëª© | DB í•„ë“œ (DD) | DB í•„ë“œ (ë°˜ì˜) | ì„¤ëª… |
|------|-------------|---------------|------|
| **ì„ ìˆœìœ„ ê·¼ì €ë‹¹** | `senior_mortgage_dd` | `senior_mortgage_reflected` | íƒ€ ê¸ˆìœµê¸°ê´€ ê·¼ì €ë‹¹ |
| **ìœ ì¹˜ê¶Œ** | `lien_dd` | `lien_reflected` | ê³µì‚¬ëŒ€ê¸ˆ ìœ ì¹˜ê¶Œ ë“± |
| **ì†Œì•¡ë³´ì¦ê¸ˆ** | `small_deposit_dd` | `small_deposit_reflected` | ìµœìš°ì„ ë³€ì œê¶Œ |
| **ì„ì°¨ë³´ì¦ê¸ˆ** | `lease_deposit_dd` | `lease_deposit_reflected` | ëŒ€í•­ë ¥ ìˆëŠ” ì„ì°¨ê¶Œ |
| **ì„ê¸ˆì±„ê¶Œ** | `wage_claim_dd` | `wage_claim_reflected` | ê·¼ë¡œì ì„ê¸ˆì±„ê¶Œ |
| **ë‹¹í•´ì„¸** | `current_tax_dd` | `current_tax_reflected` | ì¬ì‚°ì„¸, ì¢…ë¶€ì„¸ ë“± |
| **ì„ ìˆœìœ„ ì¡°ì„¸** | `senior_tax_dd` | `senior_tax_reflected` | ë²•ì •ê¸°ì¼ ì•ì„  ì¡°ì„¸ |
| **ê¸°íƒ€** | `etc_dd` | `etc_reflected` | ê¸°íƒ€ ì„ ìˆœìœ„ |

### 2.2 DD vs ë°˜ì˜

- **DD (Due Diligence)**: ì‹¤ì‚¬ ê³¼ì •ì—ì„œ íŒŒì•…í•œ ê¸ˆì•¡
- **ë°˜ì˜ (Reflected)**: ë£° ì—”ì§„ ì ìš© í›„ ìµœì¢… ë°˜ì˜ ê¸ˆì•¡

```csharp
// ë£° ì—”ì§„ì—ì„œ DD ê¸ˆì•¡ì„ ë°˜ì˜ ê¸ˆì•¡ìœ¼ë¡œ ë³µì‚¬
analysis.SmallDepositReflected = analysis.SmallDepositDd;
```

### 2.3 ì„ ìˆœìœ„ í•©ê³„

```csharp
// ì„ ìˆœìœ„ í•©ê³„ ê³„ì‚°
decimal seniorTotal = 
    analysis.SeniorMortgageReflected +
    analysis.LienReflected +
    analysis.SmallDepositReflected +
    analysis.LeaseDepositReflected +
    analysis.WageClaimReflected +
    analysis.CurrentTaxReflected +
    analysis.SeniorTaxReflected +
    analysis.EtcReflected;
```

---

## 3. XNPV ê³„ì‚°

### 3.1 XNPVë€?

**XNPV (Extended Net Present Value)**ëŠ” ë¶ˆê·œì¹™í•œ ë‚ ì§œì˜ í˜„ê¸ˆíë¦„ì— ëŒ€í•œ ìˆœí˜„ì¬ê°€ì¹˜ì…ë‹ˆë‹¤.

```
ğŸ“ ìœ„ì¹˜: src/NPLogic.Core/Services/XnpvCalculator.cs
```

### 3.2 XNPV ê³µì‹

$$
XNPV = \sum_{i=1}^{n} \frac{CF_i}{(1 + r)^{\frac{d_i - d_1}{365}}}
$$

- $CF_i$: ië²ˆì§¸ í˜„ê¸ˆíë¦„ ê¸ˆì•¡
- $r$: ì—°ê°„ í• ì¸ìœ¨ (IRR)
- $d_i$: ië²ˆì§¸ í˜„ê¸ˆíë¦„ ë‚ ì§œ
- $d_1$: ê¸°ì¤€ì¼ (ì²« ë²ˆì§¸ í˜„ê¸ˆíë¦„ ë‚ ì§œ)

### 3.3 êµ¬í˜„ ì½”ë“œ

```csharp
public static decimal CalculateXnpv(
    decimal discountRate, 
    List<(DateTime Date, decimal Amount)> cashFlows)
{
    if (cashFlows == null || cashFlows.Count == 0)
        return 0;

    var baseDate = cashFlows.Min(cf => cf.Date);
    decimal xnpv = 0;

    foreach (var cf in cashFlows)
    {
        var daysDiff = (cf.Date - baseDate).TotalDays;
        var yearFraction = daysDiff / 365.0;
        var discountFactor = Math.Pow(1.0 + (double)discountRate, -yearFraction);
        xnpv += cf.Amount * (decimal)discountFactor;
    }

    return Math.Round(xnpv, 2);
}
```

### 3.4 ì‚¬ìš© ì˜ˆì‹œ

```csharp
// í˜„ê¸ˆíë¦„ ì •ì˜
var cashFlows = new List<(DateTime Date, decimal Amount)>
{
    (new DateTime(2026, 1, 1), -1000000000m),  // ì´ˆê¸° íˆ¬ì (ìŒìˆ˜)
    (new DateTime(2026, 6, 1), 200000000m),   // íšŒìˆ˜ 1
    (new DateTime(2026, 12, 1), 300000000m),  // íšŒìˆ˜ 2
    (new DateTime(2027, 6, 1), 600000000m),   // íšŒìˆ˜ 3
};

// IRR 15%ë¡œ XNPV ê³„ì‚°
decimal xnpv = XnpvCalculator.CalculateXnpv(0.15m, cashFlows);
// ê²°ê³¼: ì–‘ìˆ˜ë©´ íˆ¬ì ê°€ì¹˜ ìˆìŒ, ìŒìˆ˜ë©´ ì†ì‹¤ ì˜ˆìƒ
```

### 3.5 XIRR (ë‚´ë¶€ìˆ˜ìµë¥ )

XNPV = 0ì´ ë˜ëŠ” í• ì¸ìœ¨ì„ ì°¾ìŠµë‹ˆë‹¤ (Newton-Raphson ë°©ë²•):

```csharp
public static decimal CalculateXirr(
    List<(DateTime Date, decimal Amount)> cashFlows,
    decimal guess = 0.1m,      // ì´ˆê¸° ì¶”ì¸¡ê°’ 10%
    decimal tolerance = 0.0001m,
    int maxIterations = 100)
{
    decimal rate = guess;
    
    for (int i = 0; i < maxIterations; i++)
    {
        var xnpv = CalculateXnpv(rate, cashFlows);
        var derivative = CalculateXnpvDerivative(rate, cashFlows);

        if (Math.Abs(derivative) < 0.000001m)
            break;

        var newRate = rate - xnpv / derivative;
        
        if (Math.Abs(newRate - rate) < tolerance)
            return Math.Round(newRate, 6);

        rate = newRate;
    }

    return Math.Round(rate, 6);
}
```

---

## 4. ê²½ë§¤/ê³µë§¤ ì‹œë‚˜ë¦¬ì˜¤

### 4.1 ì‹œë‚˜ë¦¬ì˜¤ ê°œë…

NPLogicì€ **2ê°œ ì‹œë‚˜ë¦¬ì˜¤**ë¡œ ë¶„ì„í•©ë‹ˆë‹¤:

| ì‹œë‚˜ë¦¬ì˜¤ | ê°€ì • | ìš©ë„ |
|----------|------|------|
| **ì‹œë‚˜ë¦¬ì˜¤ 1** | ë³´ìˆ˜ì  (ë‚®ì€ ë‚™ì°°ê°€) | ìµœì•…ì˜ ê²½ìš° ì˜ˆìƒ |
| **ì‹œë‚˜ë¦¬ì˜¤ 2** | ë‚™ê´€ì  (ë†’ì€ ë‚™ì°°ê°€) | ìµœì„ ì˜ ê²½ìš° ì˜ˆìƒ |

### 4.2 ë‚™ì°°ê°€ ì˜ˆì¸¡

```csharp
// ì‹œë‚˜ë¦¬ì˜¤ë³„ ì˜ˆìƒ ë‚™ì°°ê°€
decimal scenario1WinningBid = appraisalValue * 0.70m;  // ê°ì •ê°€ì˜ 70%
decimal scenario2WinningBid = appraisalValue * 0.85m;  // ê°ì •ê°€ì˜ 85%
```

### 4.3 ê²½ë§¤ íšŒì°¨ë³„ ì €ê°

ë²•ì›ë§ˆë‹¤ ì €ê°ìœ¨ì´ ë‹¤ë¦…ë‹ˆë‹¤:

| íšŒì°¨ | ì„œìš¸ì¤‘ì•™ì§€ë²• | ê¸°íƒ€ |
|------|------------|------|
| 1íšŒì°¨ | 100% | 100% |
| 2íšŒì°¨ | 80% | 80% |
| 3íšŒì°¨ | 64% | 64% |
| 4íšŒì°¨ | 51.2% | 51.2% |

```csharp
// íšŒì°¨ë³„ ìµœì €ì…ì°°ê°€ ê³„ì‚°
decimal GetMinimumBid(decimal appraisalValue, int round, decimal discountRate = 0.20m)
{
    return appraisalValue * (decimal)Math.Pow(1 - (double)discountRate, round - 1);
}
```

### 4.4 ê²½ë§¤ë¹„ìš© ê³„ì‚°

| í•­ëª© | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|--------|------|
| ì‹ ë¬¸ê³µê³ ë¹„ | 220,000ì› | ê²½ë§¤ê³µê³  ë¹„ìš© |
| ì¡°ì‚¬ë¹„ | 70,000ì› | í˜„í™©ì¡°ì‚¬ë¹„ |
| ê°ì •ë£Œ | ë³€ë™ | ê°ì •ê°€ì•¡ ê¸°ì¤€ |
| ì†¡ë‹¬ë£Œ | ë³€ë™ | ì±„ê¶Œì ìˆ˜ ê¸°ì¤€ |
| ê¸°íƒ€ | 5,000ì› | ê¸°íƒ€ ë¹„ìš© |

```csharp
// ê²½ë§¤ë¹„ìš© í•©ê³„
decimal auctionFees = 
    newspaperAdFee +      // ì‹ ë¬¸ê³µê³ ë¹„
    surveyFee +           // ì¡°ì‚¬ë¹„
    appraisalFee +        // ê°ì •ë£Œ
    deliveryFee +         // ì†¡ë‹¬ë£Œ
    registrationFee +     // ë“±ë¡ë©´í—ˆì„¸
    otherCost;            // ê¸°íƒ€
```

---

## 5. ë°°ë‹¹ ì‹œë®¬ë ˆì´ì…˜

### 5.1 ë°°ë‹¹ ìˆœì„œ

ê²½ë§¤ ë‚™ì°° í›„ ë°°ë‹¹ ìˆœì„œ:

```
1. ê²½ë§¤ë¹„ìš© (ìµœìš°ì„  ê³µì œ)
2. ë‹¹í•´ì„¸
3. ì„ ìˆœìœ„ ì¡°ì„¸
4. ì„ê¸ˆì±„ê¶Œ
5. ì†Œì•¡ì„ì°¨ì¸
6. ê·¼ì €ë‹¹ê¶Œì (ìˆœìœ„ë³„)
7. ì¼ë°˜ ì„ì°¨ì¸
8. ì¼ë°˜ ì±„ê¶Œì
9. ì†Œìœ ì (ì”ì—¬ê¸ˆ)
```

### 5.2 ë°°ë‹¹ ê³„ì‚° íë¦„

```csharp
// 1. ë°°ë¶„ ê°€ëŠ¥ ê¸ˆì•¡
decimal distributableAmount = winningBid - auctionFees;

// 2. ë‹¹í•´ì„¸ ê³µì œ
distributableAmount -= currentTaxReflected;

// 3. ì„ ìˆœìœ„ ì¡°ì„¸ ê³µì œ
distributableAmount -= seniorTaxReflected;

// 4. ì„ê¸ˆì±„ê¶Œ ê³µì œ
distributableAmount -= wageClaimReflected;

// 5. ì†Œì•¡ë³´ì¦ê¸ˆ ê³µì œ
distributableAmount -= smallDepositReflected;

// 6. ì„ ìˆœìœ„ ê·¼ì €ë‹¹ ê³µì œ
distributableAmount -= seniorMortgageReflected;

// 7. ìœ ì¹˜ê¶Œ ê³µì œ
distributableAmount -= lienReflected;

// 8. ì„ ìˆœìœ„ ì„ì°¨ë³´ì¦ê¸ˆ ê³µì œ
distributableAmount -= leaseDepositReflected;

// 9. ë‚¨ì€ ê¸ˆì•¡ = ìš°ë¦¬ ì€í–‰ ë°°ë‹¹ ê°€ëŠ¥ì•¡
decimal amountAfterSenior = distributableAmount;
```

### 5.3 ëŒ€ì¶œí•œë„ ì ìš©

```csharp
// ëŒ€ì¶œí•œë„ (ì±„ê¶Œìµœê³ ì•¡) í™•ì¸
decimal loanCap = mortgage_max_amount;  // ê·¼ì €ë‹¹ ì„¤ì • ìµœê³ ì•¡

// í•œë„ ì ìš© ë°°ë‹¹ì•¡
decimal capAppliedDividend = Math.Min(amountAfterSenior, loanCap);

// íšŒìˆ˜ìœ¨ ê³„ì‚°
decimal opb = loan_principal_balance;  // ëŒ€ì¶œì”ì•¡ (OPB)
decimal recoveryRate = capAppliedDividend / opb * 100;  // íšŒìˆ˜ìœ¨ %
```

### 5.4 íšŒìˆ˜ ê¸ˆì•¡ ê³„ì‚°

```csharp
// ìµœì¢… íšŒìˆ˜ ì˜ˆìƒì•¡
decimal recoveryAmount = Math.Min(capAppliedDividend, opb);

// íšŒìˆ˜ìœ¨
decimal recoveryRate = (recoveryAmount / opb) * 100;

// ìœ„í—˜ë„ íŒì •
string riskLevel = recoveryRate switch
{
    >= 80 => "low",     // ì•ˆì „
    >= 50 => "medium",  // ì£¼ì˜
    _ => "high"         // ìœ„í—˜
};
```

---

## 6. ì—‘ì…€ ìˆ˜ì‹ ë§¤í•‘

### 6.1 ì—‘ì…€ â†’ NPLogic ì»¬ëŸ¼ ë§¤í•‘

NPLogicì€ ì€í–‰ë³„ë¡œ ë‹¤ë¥¸ ì—‘ì…€ ì–‘ì‹ì„ **ìë™ ë§¤í•‘**í•©ë‹ˆë‹¤.

#### ì£¼ìš” ë§¤í•‘ ì˜ˆì‹œ

| ì—‘ì…€ ì»¬ëŸ¼ (ì˜ˆì‹œ) | DB ì»¬ëŸ¼ | ì„¤ëª… |
|-----------------|---------|------|
| ì°¨ì£¼ë²ˆí˜¸ | `borrower_number` | ì°¨ì£¼ ì‹ë³„ |
| ëŒ€ì¶œì”ì•¡ | `opb` | Outstanding Principal Balance |
| ë‹´ë³´ì†Œì¬ì§€ | `address_full` | ë¬¼ê±´ ì£¼ì†Œ |
| ê°ì •ê°€ | `appraisal_value` | ê°ì •í‰ê°€ì•¡ |
| ê²½ë§¤ì—¬ë¶€ | `auction_status` | opened/not_opened |

### 6.2 ì—‘ì…€ ìˆ˜ì‹ â†’ ì½”ë“œ ë³€í™˜

#### ì˜ˆì‹œ 1: XNPV ê³„ì‚°

**ì—‘ì…€ ìˆ˜ì‹**:
```excel
=XNPV(IRR, í˜„ê¸ˆíë¦„ë²”ìœ„, ë‚ ì§œë²”ìœ„)
```

**C# ì½”ë“œ**:
```csharp
decimal xnpv = XnpvCalculator.CalculateXnpv(irr, cashFlows);
```

#### ì˜ˆì‹œ 2: íšŒì°¨ë³„ ìµœì €ê°€

**ì—‘ì…€ ìˆ˜ì‹**:
```excel
=ê°ì •ê°€ * POWER(1-ì €ê°ìœ¨, íšŒì°¨-1)
```

**C# ì½”ë“œ**:
```csharp
decimal minBid = appraisalValue * (decimal)Math.Pow(1 - discountRate, round - 1);
```

#### ì˜ˆì‹œ 3: ë°°ë‹¹ì•¡ ê³„ì‚°

**ì—‘ì…€ ìˆ˜ì‹**:
```excel
=MIN(ì„ ìˆœìœ„ê³µì œí›„ê¸ˆì•¡, ëŒ€ì¶œí•œë„, ëŒ€ì¶œì”ì•¡)
```

**C# ì½”ë“œ**:
```csharp
decimal dividend = Math.Min(Math.Min(amountAfterSenior, loanCap), opb);
```

---

## 7. ìš©ì–´ ì‚¬ì „

### ë¶€ë™ì‚°/ê²½ë§¤ ìš©ì–´

| ìš©ì–´ | ì˜ë¬¸ | ì„¤ëª… |
|------|------|------|
| **NPL** | Non-Performing Loan | ë¶€ì‹¤ì±„ê¶Œ, ì—°ì²´ ëŒ€ì¶œ |
| **ë‹´ë³´ë¬¼ê±´** | Collateral | ëŒ€ì¶œ ë‹´ë³´ë¡œ ì¡íŒ ë¶€ë™ì‚° |
| **ì°¨ì£¼** | Borrower | ëŒ€ì¶œì„ ë°›ì€ ì‚¬ëŒ/íšŒì‚¬ |
| **OPB** | Outstanding Principal Balance | ëŒ€ì¶œ ì›ê¸ˆ ì”ì•¡ |
| **ê°ì •ê°€** | Appraisal Value | ê°ì •í‰ê°€ì•¡ |
| **ë‚™ì°°ê°€** | Winning Bid | ê²½ë§¤ ë‚™ì°° ê¸ˆì•¡ |
| **ë°°ë‹¹** | Distribution | ë‚™ì°°ê¸ˆ ë¶„ë°° |
| **ì„ ìˆœìœ„** | Senior/Prior | ë¨¼ì € ë°°ë‹¹ë°›ì„ ê¶Œë¦¬ |
| **í›„ìˆœìœ„** | Junior/Subordinate | ë‚˜ì¤‘ì— ë°°ë‹¹ë°›ì„ ê¶Œë¦¬ |

### ì„ ìˆœìœ„ ìš©ì–´

| ìš©ì–´ | ì„¤ëª… |
|------|------|
| **ê·¼ì €ë‹¹** | ì¥ë˜ ì±„ê¶Œì„ ë‹´ë³´í•˜ê¸° ìœ„í•œ ì €ë‹¹ê¶Œ |
| **ê°€ì••ë¥˜** | ì±„ê¶Œ í™•ë³´ë¥¼ ìœ„í•œ ì„ì‹œ ì²˜ë¶„ |
| **ìœ ì¹˜ê¶Œ** | ë¬¼ê±´ ì ìœ ìê°€ ì±„ê¶Œ ë³€ì œ ì „ê¹Œì§€ ì ìœ í•  ê¶Œë¦¬ |
| **ì „ì„¸ê¶Œ** | ì „ì„¸ê¸ˆ ì§€ê¸‰ í›„ ì‚¬ìš©í•  ê¶Œë¦¬ |
| **ì†Œì•¡ì„ì°¨ì¸** | ë²•ì  ë³´í˜¸ë¥¼ ë°›ëŠ” ì†Œì•¡ ì„ì°¨ì¸ |
| **ë‹¹í•´ì„¸** | í•´ë‹¹ ë¶€ë™ì‚°ì— ë¶€ê³¼ëœ ì„¸ê¸ˆ (ì¬ì‚°ì„¸ ë“±) |
| **ì„ê¸ˆì±„ê¶Œ** | ê·¼ë¡œì ì„ê¸ˆ/í‡´ì§ê¸ˆ ì±„ê¶Œ |

### ê³„ì‚° ìš©ì–´

| ìš©ì–´ | ì˜ë¬¸ | ì„¤ëª… |
|------|------|------|
| **XNPV** | Extended NPV | ë¶ˆê·œì¹™ í˜„ê¸ˆíë¦„ ìˆœí˜„ì¬ê°€ì¹˜ |
| **IRR** | Internal Rate of Return | ë‚´ë¶€ìˆ˜ìµë¥  |
| **XIRR** | Extended IRR | ë¶ˆê·œì¹™ í˜„ê¸ˆíë¦„ ë‚´ë¶€ìˆ˜ìµë¥  |
| **DCF** | Discounted Cash Flow | í• ì¸ëœ í˜„ê¸ˆíë¦„ |
| **í• ì¸ìœ¨** | Discount Rate | ë¯¸ë˜ ê°€ì¹˜ë¥¼ í˜„ì¬ ê°€ì¹˜ë¡œ í™˜ì‚°í•˜ëŠ” ë¹„ìœ¨ |
| **íšŒìˆ˜ìœ¨** | Recovery Rate | ëŒ€ì¶œì”ì•¡ ëŒ€ë¹„ íšŒìˆ˜ ì˜ˆìƒ ë¹„ìœ¨ |

### ê²½ë§¤ ì ˆì°¨ ìš©ì–´

| ìš©ì–´ | ì„¤ëª… |
|------|------|
| **ê²½ë§¤ê°œì‹œê²°ì •** | ë²•ì›ì´ ê²½ë§¤ ì‹œì‘ì„ ê²°ì • |
| **ë°°ë‹¹ìš”êµ¬ì¢…ê¸°** | ë°°ë‹¹ ìš”êµ¬ ì‹ ì²­ ë§ˆê°ì¼ |
| **í˜„í™©ì¡°ì‚¬ì„œ** | ë²•ì› ì§‘í–‰ê´€ì´ ì‘ì„±í•œ ë¬¼ê±´ í˜„í™© ë³´ê³ ì„œ |
| **ê°ì •í‰ê°€ì„œ** | ê°ì •í‰ê°€ì‚¬ê°€ ì‘ì„±í•œ ê°€ì¹˜ í‰ê°€ |
| **ë§¤ê°ê¸°ì¼** | ì‹¤ì œ ê²½ë§¤ ì§„í–‰ì¼ |
| **ë§¤ê°í—ˆê°€ê²°ì •** | ë‚™ì°°ì í™•ì • ê²°ì • |
| **ë°°ë‹¹ê¸°ì¼** | ë‚™ì°°ê¸ˆ ë¶„ë°°ì¼ |

---

## ğŸ“ ê´€ë ¨ ì†ŒìŠ¤ íŒŒì¼

| íŒŒì¼ | ê²½ë¡œ | ì„¤ëª… |
|------|------|------|
| `RightAnalysisRuleEngine.cs` | `src/NPLogic.Core/Services/` | ê¶Œë¦¬ë¶„ì„ 40+ ì¼€ì´ìŠ¤ ë£° |
| `XnpvCalculator.cs` | `src/NPLogic.Core/Services/` | XNPV/XIRR ê³„ì‚° |
| `RightAnalysis.cs` | `src/NPLogic.Core/Models/` | ê¶Œë¦¬ë¶„ì„ ëª¨ë¸ |
| `AuctionSchedule.cs` | `src/NPLogic.Core/Models/` | ê²½ë§¤ì¼ì • ëª¨ë¸ |
| `PublicSaleSchedule.cs` | `src/NPLogic.Core/Models/` | ê³µë§¤ì¼ì • ëª¨ë¸ |
| `CashFlow.cs` | `src/NPLogic.Core/Models/` | í˜„ê¸ˆíë¦„ ëª¨ë¸ |

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [ERD.md](../database/ERD.md) - `right_analysis`, `auction_schedules` í…Œì´ë¸” êµ¬ì¡°
- [SERVICE_GUIDE.md](../api/SERVICE_GUIDE.md) - ì„œë¹„ìŠ¤ ì‚¬ìš©ë²•
- [SCREEN_GUIDE.md](../screens/SCREEN_GUIDE.md) - ê´€ë ¨ í™”ë©´ ê°€ì´ë“œ

---

**ë¬¸ì„œ ì‘ì„±ì¼**: 2026-01-21  
**ì‘ì„±ì**: NPLogic ê°œë°œíŒ€
