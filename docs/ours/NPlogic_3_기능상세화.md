# NPlogic - 기능 상세화

## 사용자 인증 및 권한 관리 상세

### 로그인/회원가입

**화면/작업 구성**:
- 로그인 화면: 이메일/비밀번호 입력, 로그인 버튼, 자동 로그인 체크박스
- 회원가입 화면: 이메일, 비밀번호, 이름, 역할 선택 폼
- Supabase Auth 연동 처리
- 역할 기반 초기 화면 리다이렉트

**주요 처리**:
- Supabase Auth API 연동
- 세션 토큰 관리
- 역할별 권한 확인
- 자동 로그인 처리

---

### 역할 관리

**화면/작업 구성**:
- 역할 할당 화면: 사용자 목록, 역할 드롭다운 (PM/평가자/관리자)
- 권한 설정 화면: 역할별 기능 접근 권한 체크리스트

**주요 처리**:
- 역할 정보 DB 저장
- Row Level Security (RLS) 정책 적용
- 화면별 접근 권한 검증

---

## 데이터 업로드 및 관리 상세

### 엑셀 데이터 디스크 업로드

**화면/작업 구성**:
- 파일 선택 화면: 파일 드래그앤드롭 또는 찾아보기 버튼
- 컬럼 매핑 화면: 엑셀 컬럼 → DB 필드 자동/수동 매핑
- 매핑 미리보기: 매핑 결과 표시, 확인 버튼
- 업로드 진행 화면: 프로그레스바, 처리 건수 표시

**주요 처리**:
- EPPlus/ClosedXML로 엑셀 파싱
- 컬럼명 기반 자동 매핑 로직
- 데이터 검증 (필수 항목, 형식)
- Supabase DB 일괄 INSERT
- 오류 데이터 로그

---

### 등기부등본 PDF 대량 업로드

**화면/작업 구성**:
- 파일 선택 화면: 다중 파일 선택 (500~3,000개)
- 업로드 진행 화면: 전체 진행률, 개별 파일 상태, 성공/실패 건수
- 업로드 완료 화면: 결과 요약, 오류 파일 목록

**주요 처리**:
- Supabase Storage 버킷에 파일 업로드
- 멀티스레드 업로드 (병렬 처리)
- 파일 메타데이터 DB 저장
- 업로드 실패 시 재시도 로직
- 진행상황 실시간 업데이트

---

### 파일 관리

**화면/작업 구성**:
- 파일 목록 화면: 업로드된 PDF 목록, 검색, 필터 (날짜, 상태)
- 파일 상세 보기: PDF 미리보기 (WebView 또는 PDF 뷰어)
- 삭제/재업로드 버튼

**주요 처리**:
- Supabase Storage 파일 목록 조회
- 파일 삭제 (Storage + DB)
- 파일 다운로드
- 재업로드 처리

---

## OCR 시스템 연동 상세

### Python OCR 코드 통합

**화면/작업 구성**:
- OCR 처리 시작 화면: 처리 대상 파일 선택, 시작 버튼
- OCR 진행 화면: 전체 진행률, 현재 처리 중인 파일, 성공/실패 건수
- OCR 완료 화면: 결과 요약, 오류 파일 목록, 재처리 버튼

**주요 처리**:
- Python 런타임 실행 (IronPython 또는 프로세스 통신)
- 클라이언트 제공 OCR 코드 호출
- 배치 처리 (50~100개씩)
- 멀티프로세싱 최적화
- OCR 결과 JSON 파싱 및 DB 저장

---

### OCR 오류 처리

**화면/작업 구성**:
- 오류 파일 목록: 실패한 파일 리스트, 오류 원인
- 재처리 선택 화면: 재처리할 파일 체크박스 선택
- 재처리 진행 화면: 재처리 진행률

**주요 처리**:
- 오류 로그 저장
- 재처리 대상 필터링
- 재처리 실행
- 재처리 결과 업데이트

---

## 데이터 표시 및 편집 상세

### 기초 데이터 화면

**화면/작업 구성**:
- 기초 데이터 표시 화면: 자동 입력 필드 (읽기 전용) + 평가자 입력 필드 (편집 가능)
- 데이터 그리드: 물건 리스트, 선택 시 상세 정보 표시
- 수정 모드: 인라인 편집 또는 편집 폼 모달

**주요 처리**:
- 데이터 디스크 데이터 조회
- 필드별 편집 권한 확인
- 실시간 데이터 수정 (DB UPDATE)
- 변경 이력 저장

---

### 등기부 정보 화면

**화면/작업 구성**:
- 등기부 정보 표시: OCR 추출 데이터 구조화 표시 (소유자, 권리관계, 토지정보 등)
- 데이터 그리드: 등기부 항목 리스트
- 수정 기능: 잘못 추출된 데이터 수정
- 병합 기능: 여러 등기부 데이터 병합

**주요 처리**:
- OCR 추출 데이터 조회
- 데이터 구조화 (JSON → UI 표시)
- 데이터 수정 및 저장
- 병합 로직 처리

---

### 권리 분석 정보 화면

**화면/작업 구성**:
- 권리 분석 표시: 근저당, 가압류, 가등기 등 권리관계 분석 결과
- 분석 그래프: 권리관계 시각화
- 수정 기능: 분석 결과 수정

**주요 처리**:
- 권리 분석 데이터 조회
- 권리관계 계산 로직
- 분석 결과 저장

---

### 데이터 편집 기능

**화면/작업 구성**:
- 수정 모달: 필드별 편집 폼
- 병합 화면: 병합 대상 선택, 병합 규칙 설정
- 삭제 확인 모달: 삭제 확인, 삭제 사유 입력
- 리스트 관리 화면: 항목 추가/수정/삭제

**주요 처리**:
- 실시간 데이터 수정 (Supabase UPDATE)
- 데이터 병합 로직 (중복 제거, 필드 병합)
- 데이터 삭제 (소프트 딜리트)
- 변경 이력 저장

---

## 데이터 처리 및 계산 상세

### 자동 데이터 매칭

**화면/작업 구성**:
- 매칭 시작 화면: 매칭 대상 선택, 매칭 규칙 설정
- 매칭 진행 화면: 진행률, 매칭 성공/실패 건수
- 매칭 결과 화면: 매칭 결과 요약, 미매칭 항목 표시

**주요 처리**:
- 데이터 디스크 ↔ 등기부등본 매칭 알고리즘 (주소, 물건번호 등)
- 유사도 기반 매칭
- 매칭 결과 DB 저장
- 미매칭 항목 로그

---

### 계산 수식 자동 적용

**화면/작업 구성**:
- 수식 설정 화면: 계산 수식 목록, 수식 편집
- 계산 실행 화면: 계산 대상 선택, 실행 버튼
- 계산 결과 화면: 계산 결과 표시, 오류 항목

**주요 처리**:
- 복잡한 계산 수식 파싱 및 실행
- 필드 간 의존성 계산
- 계산 결과 DB 저장
- 오류 처리 (나누기 0, 필드 누락 등)

---

### 데이터 검증

**화면/작업 구성**:
- 검증 실행 화면: 검증 규칙 선택, 실행 버튼
- 검증 결과 화면: 오류 항목 리스트, 오류 유형별 필터
- 오류 수정 화면: 오류 항목 인라인 수정

**주요 처리**:
- 필수 항목 체크
- 데이터 형식 검증 (날짜, 숫자 등)
- 비즈니스 규칙 검증
- 오류 데이터 플래그 표시

---

## Excel 출력 시스템 상세

### 여러 시트 데이터 통합

**화면/작업 구성**:
- 출력 설정 화면: 출력 대상 선택 (전체/선택/필터), 시트 구성 선택
- 시트 미리보기: 생성될 시트 구조 미리보기
- 출력 실행 화면: 진행률, 완료 후 파일 저장 위치 선택

**주요 처리**:
- 여러 시트 데이터 쿼리 및 통합
- "비핵심 전체" 형태 데이터 구조화
- EPPlus/ClosedXML로 Excel 생성

---

### Excel 파일 생성

**화면/작업 구성**:
- 파일 생성 진행 화면: 진행률, 현재 처리 중인 시트
- 완료 화면: 생성된 파일 경로, 파일 열기 버튼

**주요 처리**:
- 다중 시트 생성
- 수식 자동 적용 (SUM, AVERAGE 등)
- 스타일 및 포맷 적용 (헤더, 셀 색상, 테두리)
- 파일 저장

---

## 지도 연동 (디스코 맵) 상세

### HTML 지도 코드 통합

**화면/작업 구성**:
- 지도 탭 화면: WebView 컨트롤에 HTML 지도 표시
- 지도 레이어 선택: 지적도, 위성지도, 로드뷰, 토지이용계획, 건축물 대장
- 물건 정보 패널: 마커 클릭 시 물건 정보 표시 (매매가, 토지/건물 정보)

**주요 처리**:
- 클라이언트 제공 HTML 지도 코드 WebView 통합
- C# ↔ JavaScript 통신 (물건 데이터 전달)
- 마커 표시 (위도, 경도)
- 레이어 토글

---

### 지도 표시

**화면/작업 구성**:
- 지도 뷰: 선택한 레이어 표시
- 컨트롤 패널: 확대/축소, 레이어 선택, 검색
- 물건 마커: 물건 위치 표시, 클릭 시 정보 팝업

**주요 처리**:
- 지도 API 호출 (지적도, 위성지도 등)
- 마커 생성 및 표시
- 마커 클릭 이벤트 처리
- 물건 정보 팝업 표시

---

## 유사 물건 추천 상세

### 추천 알고리즘 통합

**화면/작업 구성**:
- 추천 실행 화면: 기준 물건 선택, 추천 실행 버튼
- 추천 결과 리스트: 유사 물건 리스트, 유사도 점수 표시
- 추천 물건 상세: 물건 정보, 비교 정보

**주요 처리**:
- 클라이언트 제공 추천 알고리즘 C# 통합
- Supabase 과거 경매 데이터 조회
- 유사도 계산 (위치, 면적, 가격 등)
- 추천 결과 정렬 (유사도 높은 순)

---

### 사례 지도 기능

**화면/작업 구성**:
- 사례 지도 화면: 추천 물건들을 지도에 마커로 표시
- 마커 클릭: 해당 물건 정보 팝업

**주요 처리**:
- 추천 물건 위치 정보 조회
- 지도에 마커 표시
- 마커 클릭 이벤트 처리

---

## 통계 분석 상세

### 통계 처리

**화면/작업 구성**:
- 통계 대시보드: 주요 통계 카드 (전체 물건 수, 평균 가격 등)
- 차트 표시: 타입별/기간별/지역별 차트
- 필터 패널: 기간, 지역, 타입 선택

**주요 처리**:
- Supabase 쿼리 기반 통계 데이터 조회
- 집계 쿼리 (GROUP BY, COUNT, AVG 등)
- 차트 데이터 가공

---

### 차트 시각화

**화면/작업 구성**:
- 차트 뷰: LiveCharts 또는 OxyPlot 차트 표시
- 차트 타입 선택: 막대, 선, 파이 차트
- 데이터 툴팁: 차트 호버 시 상세 데이터 표시

**주요 처리**:
- LiveCharts/OxyPlot 라이브러리 활용
- 차트 데이터 바인딩
- 인터랙티브 차트 이벤트

---

### 통계 Excel 출력

**화면/작업 구성**:
- 통계 출력 설정: 출력할 통계 선택
- Excel 파일 생성: 통계 데이터 시트 생성

**주요 처리**:
- 통계 데이터 Excel 변환
- 차트를 이미지로 변환하여 Excel 삽입
- 파일 저장

---

## 물건 관리 상세

### 물건 목록 화면

**화면/작업 구성**:
- 물건 그리드: 물건 리스트 표시
- 검색 바: 키워드 검색 (주소, 물건번호 등)
- 필터 패널: 타입, 지역, 가격 범위 필터
- 정렬: 컬럼별 정렬 (가격, 날짜 등)
- 페이지네이션: 페이지 당 50~100개 표시

**주요 처리**:
- Supabase 쿼리 (검색, 필터, 정렬, 페이지네이션)
- 데이터 그리드 바인딩
- 페이지 이동 처리

---

### 물건 상세 화면 (탭 구조)

**화면/작업 구성**:
- 탭 컨트롤: 기초 데이터, 등기부 정보, 권리 분석, 평가 시트, 지도
- 각 탭: 해당 데이터 표시 및 편집 기능
- 저장 버튼: 전체 탭 데이터 한 번에 저장

**주요 처리**:
- 탭별 데이터 조회
- 탭 간 데이터 공유
- 탭별 편집 상태 관리
- 전체 저장 처리

---

### 대시보드

**화면/작업 구성**:
- 통계 카드: 주요 KPI (전체 물건 수, 평균 가격, 완료율 등)
- 차트: 최근 추이 차트
- 빠른 작업: 자주 사용하는 기능 버튼 (새 물건 추가, 데이터 업로드 등)
- 최근 작업 목록: 최근 수정한 물건 리스트

**주요 처리**:
- 통계 데이터 조회
- 차트 데이터 바인딩
- 빠른 작업 버튼 이벤트

---

## 관리자 기능 상세

### 사용자 관리

**화면/작업 구성**:
- 사용자 목록: 전체 사용자 리스트, 역할, 상태
- 사용자 추가 모달: 이메일, 이름, 역할 선택
- 사용자 수정 모달: 역할 변경, 상태 변경 (활성/비활성)
- 사용자 삭제: 삭제 확인 모달

**주요 처리**:
- Supabase Auth 사용자 생성/수정/삭제
- 역할 할당 (DB 업데이트)
- 사용자 상태 관리

---

### 작업 이력 관리

**화면/작업 구성**:
- 이력 목록: 전체 수정 이력, 사용자, 날짜, 변경 내용
- 이력 상세: 변경 전/후 데이터 비교
- 되돌리기 버튼: 이전 상태로 복구

**주요 처리**:
- 변경 이력 로그 조회
- 변경 전/후 데이터 비교
- 되돌리기 처리 (DB ROLLBACK)

---

### 설정 관리

**화면/작업 구성**:
- 계산 수식 설정: 수식 목록, 수식 편집/추가/삭제
- 데이터 매핑 설정: 엑셀 컬럼 ↔ DB 필드 매핑 규칙
- 시스템 환경 설정: 업로드 제한, OCR 설정 등

**주요 처리**:
- 설정 데이터 조회 및 저장
- 수식 파싱 및 검증
- 매핑 규칙 저장

---

### 시스템 로그

**화면/작업 구성**:
- 로그 목록: 전체 시스템 로그, 날짜, 레벨 (INFO, ERROR)
- 로그 필터: 날짜, 레벨, 사용자
- 로그 상세: 로그 메시지, 스택 트레이스

**주요 처리**:
- 로그 데이터 조회
- 로그 필터링
- 로그 Export (CSV)

---

## UI/UX 디자인 및 구현 상세

### 디자인 시스템 구축

**화면/작업 구성**:
- 공통 컴포넌트: 버튼, 입력 필드, 그리드, 모달 등
- 색상 팔레트:
  - 베이스 색상: 딥네이비 (#1a2332)
  - 표 색상: 밝은 블루그레이 (#b0c4de)
  - 강조 색상, 경고 색상
- 타이포그래피: 폰트, 크기, 굵기 (엑셀 스타일)
- 레이아웃: 헤더, 사이드바, 메인 컨텐츠

**주요 처리**:
- 차분하고 딱딱한 엑셀 같은 느낌의 UI 구현
- 클라이언트 레퍼런스 기반 커스터마이징 (`비핵심 프로그램화_v6-1.xlsx`)
- 일관된 스타일 적용

---

### 역할별 최적화 화면

**화면/작업 구성**:
- PM 화면: 전체 프로젝트 관리 중심 (대시보드, 물건 목록)
- 평가자 화면: 데이터 입력 및 편집 중심 (물건 상세, 평가 시트)
- 관리자 화면: 사용자 및 시스템 관리 중심 (사용자 관리, 설정)

**주요 처리**:
- 역할별 메뉴 구성
- 역할별 기능 접근 제어
- 역할별 UI 최적화

---

## 데이터베이스 설계 및 구축 상세

### Supabase PostgreSQL 스키마 설계

**주요 테이블**:
- users: 사용자 정보 (이름, 이메일, 역할)
- properties: 물건 기본 정보 (주소, 타입, 가격 등)
- data_disks: 엑셀 데이터 디스크 업로드 정보
- registry_documents: 등기부등본 정보 (OCR 추출 데이터)
- calculations: 계산 결과
- statistics: 통계 데이터
- audit_logs: 작업 이력
- settings: 시스템 설정

**주요 처리**:
- 테이블 관계 설정 (Foreign Key)
- 인덱싱 (검색 성능 최적화)
- Row Level Security (RLS) 정책 설정

---

### Row Level Security (RLS) 설정

**주요 정책**:
- PM: 전체 데이터 읽기/쓰기
- 평가자: 자신이 담당한 물건 데이터만 읽기/쓰기
- 관리자: 전체 데이터 읽기/쓰기 + 사용자 관리

**주요 처리**:
- 정책 생성 및 적용
- 역할 기반 접근 제어

---

### Storage 버킷 구성

**버킷 구성**:
- registry-pdfs: 등기부등본 PDF 파일
- excel-files: 엑셀 파일 (데이터 디스크, 출력 파일)

**주요 처리**:
- 버킷 생성 및 권한 설정
- 파일 업로드/다운로드 처리

---

## 시스템 통합 및 배포 상세

### C# Windows 애플리케이션 패키징

**작업 구성**:
- 빌드 설정: Release 모드 빌드
- 종속성 포함: .NET Framework/Core, 라이브러리 DLL
- 리소스 포함: 이미지, 설정 파일

**주요 처리**:
- Visual Studio 빌드
- 실행 파일 생성 (.exe)
- 종속성 자동 포함

---

### 설치 프로그램 생성

**작업 구성**:
- ClickOnce 또는 Inno Setup 스크립트 작성
- 설치 경로 설정
- 바로가기 생성
- 레지스트리 설정

**주요 처리**:
- 설치 프로그램 빌드
- 설치/제거 테스트

---

### 자동 업데이트 시스템

**작업 구성**:
- Auto-Updater.NET 라이브러리 통합
- 업데이트 서버 설정 (버전 정보 XML)
- 업데이트 확인 로직 (앱 시작 시)

**주요 처리**:
- 버전 비교
- 업데이트 다운로드
- 자동 설치 및 재시작

---

### 설치 매뉴얼 및 사용자 교육 자료

**작업 구성**:
- 설치 매뉴얼: 설치 과정, 초기 설정
- 사용자 가이드: 주요 기능 사용법, 스크린샷
- 트러블슈팅: 자주 발생하는 문제 및 해결 방법

**주요 처리**:
- 문서 작성 (PDF 또는 Word)
- 스크린샷 캡처
- 동영상 튜토리얼 (선택사항)

