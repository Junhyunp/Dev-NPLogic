<UserControl x:Class="NPLogic.Views.Loan.Sections.ProrationSection"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="250" d:DesignWidth="600">
    
    <UserControl.Resources>
        <SolidColorBrush x:Key="TableBorderBrush" Color="#D0D0D0"/>
        <SolidColorBrush x:Key="HeaderBg" Color="#E7E7E7"/>
        <SolidColorBrush x:Key="BlueBg" Color="#BDD7EE"/>
        <SolidColorBrush x:Key="TealBg" Color="#B2DFDB"/>
        <SolidColorBrush x:Key="GreenBg" Color="#92D050"/>
        <SolidColorBrush x:Key="LightGreenBg" Color="#C6EFCE"/>
        
        <Style x:Key="HeaderCellStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{StaticResource HeaderBg}"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="4,4"/>
            <Setter Property="BorderBrush" Value="{StaticResource TableBorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>
        
        <Style x:Key="CellStyle" TargetType="DataGridCell">
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="BorderBrush" Value="{StaticResource TableBorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
        </Style>
    </UserControl.Resources>
    
    <Border BorderBrush="{StaticResource TableBorderBrush}" BorderThickness="1">
        <StackPanel>
            <!-- 섹션 헤더 -->
            <Border Background="{StaticResource TealBg}" Padding="8,4">
                <TextBlock x:Name="SectionHeader" Text="안분비율 / 보증기관 안분액" FontWeight="Bold" FontSize="12"/>
            </Border>
            
            <!-- DataGrid -->
            <DataGrid ItemsSource="{Binding ProrationItems}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      RowHeaderWidth="0"
                      GridLinesVisibility="All"
                      HorizontalGridLinesBrush="{StaticResource TableBorderBrush}"
                      VerticalGridLinesBrush="{StaticResource TableBorderBrush}"
                      Background="White"
                      BorderThickness="0"
                      MaxHeight="150"
                      ColumnHeaderStyle="{StaticResource HeaderCellStyle}"
                      CellStyle="{StaticResource CellStyle}">
                <DataGrid.Columns>
                    <!-- 보증기관 -->
                    <DataGridTextColumn Header="보증기관&#x0a;(AW)" 
                                        Binding="{Binding GuaranteeOrganization}" 
                                        Width="80"
                                        IsReadOnly="True"/>
                    
                    <!-- 대위변제원금 -->
                    <DataGridTextColumn Header="대위변제원금&#x0a;(AX)" 
                                        Binding="{Binding SubrogationPrincipal, StringFormat=N0}" 
                                        Width="100"
                                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="Padding" Value="4,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <!-- 안분비율 (AR) -->
                    <DataGridTextColumn Header="안분비율&#x0a;(AR)" 
                                        Binding="{Binding ProrationRatio, StringFormat=P2}" 
                                        Width="80"
                                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="Background" Value="{StaticResource BlueBg}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <!-- 1안 안분액 (XD1) -->
                    <DataGridTextColumn Header="1안 안분액&#x0a;(XD1)" 
                                        Binding="{Binding AllocationAmount1, StringFormat=N0}" 
                                        Width="100"
                                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="Padding" Value="4,0"/>
                                <Setter Property="Background" Value="{StaticResource GreenBg}"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <!-- 2안 안분액 (XD2) -->
                    <DataGridTextColumn Header="2안 안분액&#x0a;(XD2)" 
                                        Binding="{Binding AllocationAmount2, StringFormat=N0}" 
                                        Width="100"
                                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="Padding" Value="4,0"/>
                                <Setter Property="Background" Value="{StaticResource GreenBg}"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
            
            <!-- 합계 행 -->
            <Border Background="{StaticResource LightGreenBg}" BorderBrush="{StaticResource TableBorderBrush}" BorderThickness="0,1,0,0" Padding="8,4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="합계" FontWeight="Bold" FontSize="10"/>
                </Grid>
            </Border>
            
            <!-- 설명 -->
            <Border Background="#E0F2F1" Padding="8,4">
                <TextBlock FontSize="9" Foreground="#666666" TextWrapping="Wrap">
                    <Run Text="• 안분비율(AR) = 대위변제원금 / Σ대위변제원금"/>
                    <LineBreak/>
                    <Run Text="• 안분액(XD) = 안분대상금액 × 안분비율"/>
                </TextBlock>
            </Border>
        </StackPanel>
    </Border>
</UserControl>
