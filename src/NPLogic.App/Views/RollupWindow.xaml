<Window x:Class="NPLogic.Views.RollupWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="롤업 - 비핵심 전체 현황" 
        Height="700" Width="1200"
        MinHeight="500" MinWidth="900"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        Topmost="True"
        ShowInTaskbar="True"
        Closing="RollupWindow_Closing">
    
    <Window.Resources>
        <!-- 롤업 그리드 헤더 스타일 -->
        <Style x:Key="RollupHeaderCell" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource HeaderNavyBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryDarkBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="Padding" Value="8,6"/>
        </Style>
        
        <Style x:Key="RollupHeaderText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <Style x:Key="RollupDataCell" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="Padding" Value="6,4"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- 헤더 -->
            <RowDefinition Height="Auto"/>  <!-- 요약 정보 -->
            <RowDefinition Height="*"/>     <!-- 데이터 그리드 -->
            <RowDefinition Height="Auto"/>  <!-- 상태바 -->
        </Grid.RowDefinitions>
        
        <!-- 헤더 -->
        <Border Grid.Row="0" 
                Background="{StaticResource HeaderNavyBrush}"
                Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="TableLarge" 
                                             Width="24" Height="24" 
                                             Foreground="White"
                                             VerticalAlignment="Center"/>
                    <TextBlock Text="비핵심 전체 현황 (롤업)" 
                               Foreground="White"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Margin="12,0,0,0"
                               VerticalAlignment="Center"/>
                    <TextBlock x:Name="ProgramNameText"
                               Text=""
                               Foreground="#A0C4E8"
                               FontSize="14"
                               Margin="16,0,0,0"
                               VerticalAlignment="Center"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="새로고침" 
                            Style="{StaticResource SecondaryButton}"
                            Click="RefreshButton_Click"
                            Margin="0,0,8,0"/>
                    <Button Content="Excel 내보내기" 
                            Style="{StaticResource SecondaryButton}"
                            Click="ExportExcelButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- 요약 정보 -->
        <Border Grid.Row="1" 
                Background="{StaticResource BlueGray50Brush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="16,10">
            <StackPanel Orientation="Horizontal">
                <!-- 총 물건 수 -->
                <Border Background="White" 
                        CornerRadius="4" 
                        Padding="12,6" 
                        Margin="0,0,12,0"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="총 물건:" 
                                   FontSize="12" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"/>
                        <TextBlock x:Name="TotalCountText" 
                                   Text="0" 
                                   FontSize="14" 
                                   FontWeight="Bold"
                                   Foreground="{StaticResource PrimaryBrush}"
                                   Margin="6,0,0,0"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="건" 
                                   FontSize="12" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="2,0,0,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
                
                <!-- 완료 -->
                <Border Background="{StaticResource SuccessBgBrush}" 
                        CornerRadius="4" 
                        Padding="12,6" 
                        Margin="0,0,12,0"
                        BorderBrush="{StaticResource SuccessBrush}"
                        BorderThickness="1">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="완료:" 
                                   FontSize="12" 
                                   Foreground="{StaticResource SuccessTextBrush}"
                                   VerticalAlignment="Center"/>
                        <TextBlock x:Name="CompletedCountText" 
                                   Text="0" 
                                   FontSize="14" 
                                   FontWeight="Bold"
                                   Foreground="{StaticResource SuccessTextBrush}"
                                   Margin="6,0,0,0"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="건" 
                                   FontSize="12" 
                                   Foreground="{StaticResource SuccessTextBrush}"
                                   Margin="2,0,0,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
                
                <!-- 진행 중 -->
                <Border Background="{StaticResource WarningBgBrush}" 
                        CornerRadius="4" 
                        Padding="12,6" 
                        Margin="0,0,12,0"
                        BorderBrush="{StaticResource WarningBrush}"
                        BorderThickness="1">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="진행 중:" 
                                   FontSize="12" 
                                   Foreground="{StaticResource WarningTextBrush}"
                                   VerticalAlignment="Center"/>
                        <TextBlock x:Name="ProcessingCountText" 
                                   Text="0" 
                                   FontSize="14" 
                                   FontWeight="Bold"
                                   Foreground="{StaticResource WarningTextBrush}"
                                   Margin="6,0,0,0"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="건" 
                                   FontSize="12" 
                                   Foreground="{StaticResource WarningTextBrush}"
                                   Margin="2,0,0,0"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
                
                <!-- 마지막 업데이트 -->
                <TextBlock x:Name="LastUpdateText"
                           Text="마지막 업데이트: -"
                           FontSize="11"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center"
                           Margin="16,0,0,0"/>
            </StackPanel>
        </Border>
        
        <!-- 데이터 그리드 -->
        <DataGrid Grid.Row="2"
                  x:Name="RollupDataGrid"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  GridLinesVisibility="All"
                  HorizontalGridLinesBrush="{StaticResource TableBorderBrush}"
                  VerticalGridLinesBrush="{StaticResource TableBorderBrush}"
                  HeadersVisibility="Column"
                  Background="White"
                  BorderThickness="0"
                  HorizontalScrollBarVisibility="Auto"
                  VerticalScrollBarVisibility="Auto"
                  Margin="8">
            
            <DataGrid.Columns>
                <!-- 차주번호 -->
                <DataGridTextColumn Header="차주번호" 
                                    Binding="{Binding PropertyNumber}" 
                                    Width="90"
                                    IsReadOnly="True"/>
                
                <!-- 차주명 -->
                <DataGridTextColumn Header="차주명" 
                                    Binding="{Binding DebtorName}" 
                                    Width="80"
                                    IsReadOnly="True"/>
                
                <!-- 담보번호 -->
                <DataGridTextColumn Header="담보번호" 
                                    Binding="{Binding CollateralNumber}" 
                                    Width="80"
                                    IsReadOnly="True"/>
                
                <!-- 물건종류 -->
                <DataGridTextColumn Header="물건종류" 
                                    Binding="{Binding PropertyType}" 
                                    Width="70"
                                    IsReadOnly="True"/>
                
                <!-- 약정서 -->
                <DataGridTemplateColumn Header="약정서" Width="50">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding AgreementDoc, Converter={StaticResource BoolToCheckConverter}}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- 보증서 -->
                <DataGridTemplateColumn Header="보증서" Width="50">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding GuaranteeDoc, Converter={StaticResource BoolToCheckConverter}}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- 경개1 -->
                <DataGridTextColumn Header="경개1" 
                                    Binding="{Binding AuctionStart1}" 
                                    Width="50"
                                    IsReadOnly="True"/>
                
                <!-- 경개2 -->
                <DataGridTextColumn Header="경개2" 
                                    Binding="{Binding AuctionStart2}" 
                                    Width="50"
                                    IsReadOnly="True"/>
                
                <!-- 경매열람 -->
                <DataGridTemplateColumn Header="경매열람" Width="55">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding AuctionDocs, Converter={StaticResource BoolToCheckConverter}}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- 전입열람 -->
                <DataGridTemplateColumn Header="전입열람" Width="55">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding TenantDocs, Converter={StaticResource BoolToCheckConverter}}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- 선순위 -->
                <DataGridTemplateColumn Header="선순위" Width="50">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding SeniorRightsReview, Converter={StaticResource BoolToCheckConverter}}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- 평가확정 -->
                <DataGridTemplateColumn Header="평가확정" Width="55">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding AppraisalConfirmed, Converter={StaticResource BoolToCheckConverter}}"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- 경매일정 -->
                <DataGridTextColumn Header="경매일정" 
                                    Binding="{Binding AuctionScheduleDate, StringFormat=yyyy-MM-dd}" 
                                    Width="80"
                                    IsReadOnly="True"/>
                
                <!-- QA -->
                <DataGridTextColumn Header="QA" 
                                    Binding="{Binding QaUnansweredCount}" 
                                    Width="40"
                                    IsReadOnly="True"/>
                
                <!-- 권리분석 -->
                <DataGridTextColumn Header="권리분석" 
                                    Binding="{Binding RightsAnalysisStatus}" 
                                    Width="60"
                                    IsReadOnly="True"/>
                
                <!-- 상태 -->
                <DataGridTemplateColumn Header="상태" Width="60">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border CornerRadius="4" Padding="4,2" HorizontalAlignment="Center">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="{StaticResource BlueGray100Brush}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Status}" Value="completed">
                                                <Setter Property="Background" Value="{StaticResource SuccessBrush}"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Status}" Value="processing">
                                                <Setter Property="Background" Value="{StaticResource WarningBrush}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <TextBlock FontSize="10" HorizontalAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="대기"/>
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Status}" Value="completed">
                                                    <Setter Property="Text" Value="완료"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="processing">
                                                    <Setter Property="Text" Value="진행"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
            
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="Background" Value="Transparent"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="{StaticResource BlueGray50Brush}"/>
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="{StaticResource BlueGray100Brush}"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
            
            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="{StaticResource HeaderNavyBrush}"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                    <Setter Property="FontSize" Value="11"/>
                    <Setter Property="Padding" Value="6,8"/>
                    <Setter Property="BorderThickness" Value="0,0,1,1"/>
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryDarkBrush}"/>
                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>
            
            <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Padding" Value="4"/>
                    <Setter Property="FontSize" Value="11"/>
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.CellStyle>
        </DataGrid>
        
        <!-- 상태바 -->
        <Border Grid.Row="3" 
                Background="{StaticResource BlueGray50Brush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="12,6">
            <Grid>
                <TextBlock Text="이 창은 수정 작업 중에도 열어둘 수 있습니다. 데이터는 실시간으로 반영됩니다."
                           FontSize="11"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock Text="자동 새로고침:"
                               FontSize="11"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center"
                               Margin="0,0,6,0"/>
                    <ToggleButton x:Name="AutoRefreshToggle"
                                  IsChecked="True"
                                  Click="AutoRefreshToggle_Click"
                                  Width="40" Height="20"/>
                    <TextBlock x:Name="AutoRefreshIntervalText"
                               Text="5초"
                               FontSize="11"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center"
                               Margin="6,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>

