<UserControl x:Class="NPLogic.Views.Evaluation.EvaluationMultiFamilyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1400">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="16"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ì¢Œì¸¡: ì‚¬ë¡€ì§€ë„ + ì‹¤ê±°ëž˜ê°€ + ì‚¬ë¡€í‰ê°€ -->
        <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- ì‚¬ë¡€ì§€ë„ ì˜ì—­ -->
                <Border Style="{StaticResource CardBorder}" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <Grid Margin="0,0,0,12">
                            <TextBlock Text="ðŸ—ºï¸ ì‚¬ë¡€ì§€ë„" Style="{StaticResource SectionHeader}" Margin="0"/>
                            <Button Content="ê°€ì ¸ì˜¤ê¸°" 
                                    Command="{Binding LoadCaseMapCommand}"
                                    Style="{StaticResource SecondaryButton}"
                                    Padding="12,4"
                                    HorizontalAlignment="Right"/>
                        </Grid>
                        
                        <Border Background="{StaticResource BlueGray50Brush}" 
                                CornerRadius="4"
                                Height="200"
                                Cursor="Hand">
                            <Grid>
                                <TextBlock Text="ì—°ë¦½/ë‹¤ì„¸ëŒ€ ê±°ëž˜ ì‚¬ë¡€ í‘œì‹œ"
                                           Style="{StaticResource BodyTextStyle}"
                                           Opacity="0.6"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- ì‹¤ê±°ëž˜ê°€ ì˜ì—­ -->
                <Border Style="{StaticResource CardBorder}" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <Grid Margin="0,0,0,12">
                            <TextBlock Text="ðŸ’° ì‹¤ê±°ëž˜ê°€ (ì—°ë¦½/ë‹¤ì„¸ëŒ€)" Style="{StaticResource SectionHeader}" Margin="0"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Content="ì¡°íšŒ" 
                                        Command="{Binding FetchRealTransactionCommand}"
                                        Style="{StaticResource SecondaryButton}"
                                        Padding="12,4"
                                        Margin="0,0,8,0"/>
                                <Button Content="ðŸ”— rt.molit.go.kr" 
                                        Command="{Binding OpenRealTransactionSiteCommand}"
                                        Style="{StaticResource SecondaryButton}"
                                        Padding="12,4"/>
                            </StackPanel>
                        </Grid>
                        
                        <DataGrid ItemsSource="{Binding RealTransactions}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="All"
                                  BorderThickness="1"
                                  BorderBrush="{StaticResource BlueGray200Brush}"
                                  MaxHeight="150"
                                  FontSize="{StaticResource FontSizeBody}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ê±°ëž˜ë©´ì " Binding="{Binding Area, StringFormat=N2}" Width="80"/>
                                <DataGridTextColumn Header="ê±°ëž˜ì¼ìž" Binding="{Binding TransactionDate, StringFormat=yyyy-MM-dd}" Width="90"/>
                                <DataGridTextColumn Header="ê±°ëž˜ê¸ˆì•¡" Binding="{Binding Amount, StringFormat=N0}" Width="100"/>
                                <DataGridTextColumn Header="ì¸µìˆ˜" Binding="{Binding Floor}" Width="50"/>
                                <DataGridTextColumn Header="ê±´ì¶•ë…„ë„" Binding="{Binding BuildYear}" Width="70"/>
                                <DataGridCheckBoxColumn Header="ì ìš©" Binding="{Binding IsApplied}" Width="50"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <Border Background="{StaticResource BlueGray50Brush}" 
                                CornerRadius="4"
                                Height="120"
                                Margin="0,12,0,0">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock Text="ðŸ“ˆ ê±°ëž˜ê°€ê²© ì¶”ì´" 
                                           Style="{StaticResource BodyTextStyle}"
                                           Opacity="0.6"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- ìœ ì‚¬ë¬¼ê±´ ì¶”ì²œ -->
                <Border Style="{StaticResource CardBorder}" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="ðŸŽ¯ ìœ ì‚¬ë¬¼ê±´ ì¶”ì²œ" Style="{StaticResource SectionHeader}" Margin="0,0,0,12"/>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Text="ê·œì¹™:" Style="{StaticResource LabelText}" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <ComboBox SelectedIndex="{Binding SelectedRuleIndex, Mode=TwoWay}"
                                      Width="70" FontSize="{StaticResource FontSizeBody}" Padding="4,2" Margin="0,0,16,0">
                                <ComboBoxItem Content="1ìˆœìœ„"/>
                                <ComboBoxItem Content="2ìˆœìœ„"/>
                                <ComboBoxItem Content="3ìˆœìœ„"/>
                                <ComboBoxItem Content="ì „ì²´"/>
                            </ComboBox>
                            <Button Content="ì¶”ì²œ ê²€ìƒ‰" 
                                    Command="{Binding RecommendSimilarCasesCommand}"
                                    Style="{StaticResource PrimaryButton}"
                                    Padding="12,4"
                                    Margin="0,0,8,0"/>
                            <Button Content="ì‚¬ë¡€ ì ìš©" 
                                    Command="{Binding ApplyRecommendedCaseCommand}"
                                    Style="{StaticResource SecondaryButton}"
                                    Padding="12,4"/>
                        </StackPanel>
                        
                        <DataGrid ItemsSource="{Binding RecommendedCases}"
                                  SelectedItem="{Binding SelectedRecommendCase, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="All"
                                  BorderThickness="1"
                                  BorderBrush="{StaticResource BlueGray200Brush}"
                                  MaxHeight="200"
                                  FontSize="{StaticResource FontSizeSmall}"
                                  SelectionMode="Single">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ì‚¬ê±´ë²ˆí˜¸" Binding="{Binding CaseNo}" Width="100" IsReadOnly="True"/>
                                <DataGridTextColumn Header="ë‚™ì°°ì¼" Binding="{Binding AuctionDate, StringFormat=yyyy-MM-dd}" Width="80" IsReadOnly="True"/>
                                <DataGridTextColumn Header="ìš©ë„" Binding="{Binding Usage}" Width="60" IsReadOnly="True"/>
                                <DataGridTextColumn Header="ê°ì •ê°€" Binding="{Binding AppraisalPrice, StringFormat=N0}" Width="90" IsReadOnly="True"/>
                                <DataGridTextColumn Header="ë‚™ì°°ê°€" Binding="{Binding WinningPrice, StringFormat=N0}" Width="90" IsReadOnly="True"/>
                                <DataGridTextColumn Header="ë‚™ì°°ìœ¨" Binding="{Binding WinningRateDisplay}" Width="55" IsReadOnly="True"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <!-- ì‚¬ë¡€í‰ê°€ -->
                <Border Style="{StaticResource CardBorder}" Padding="16">
                    <StackPanel>
                        <Grid Margin="0,0,0,12">
                            <TextBlock Text="ðŸ“‹ ì‚¬ë¡€í‰ê°€" Style="{StaticResource SectionHeader}" Margin="0"/>
                            <Button Content="ê²½ë§¤ì‚¬ê±´ê²€ìƒ‰" 
                                    Command="{Binding SearchAuctionCaseCommand}"
                                    Style="{StaticResource SecondaryButton}"
                                    Padding="12,4"
                                    HorizontalAlignment="Right"/>
                        </Grid>
                        
                        <DataGrid ItemsSource="{Binding CaseItems}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="All"
                                  BorderThickness="1"
                                  BorderBrush="{StaticResource BlueGray200Brush}"
                                  MaxHeight="400"
                                  FontSize="{StaticResource FontSizeBody}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="êµ¬ë¶„" Binding="{Binding Label}" Width="100" IsReadOnly="True"/>
                                <DataGridTextColumn Header="ë³¸ê±´ ê°ì •ê°€" Binding="{Binding BaseValue, Mode=TwoWay}" Width="100"/>
                                <DataGridTextColumn Header="ì‚¬ë¡€1" Binding="{Binding Case1Value, Mode=TwoWay}" Width="100"/>
                                <DataGridTextColumn Header="ì‚¬ë¡€2" Binding="{Binding Case2Value, Mode=TwoWay}" Width="100"/>
                                <DataGridTextColumn Header="ì‚¬ë¡€3" Binding="{Binding Case3Value, Mode=TwoWay}" Width="100"/>
                                <DataGridTextColumn Header="ì‚¬ë¡€4" Binding="{Binding Case4Value, Mode=TwoWay}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- ìš°ì¸¡: ì‚¬ë¡€ ë¡œë“œë·° + ë‚™ì°°í†µê³„ -->
        <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- ì‚¬ë¡€ ë¡œë“œë·° ì˜ì—­ -->
                <Border Style="{StaticResource CardBorder}" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="ðŸ  ì‚¬ë¡€ ë¡œë“œë·°" Style="{StaticResource SectionHeader}" Margin="0,0,0,12"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="8"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Grid.Column="0" Background="{StaticResource BlueGray100Brush}" CornerRadius="4" Height="100">
                                <TextBlock Text="ì‚¬ë¡€1" Style="{StaticResource LabelText}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="0" Grid.Column="2" Background="{StaticResource BlueGray100Brush}" CornerRadius="4" Height="100">
                                <TextBlock Text="ì‚¬ë¡€2" Style="{StaticResource LabelText}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="2" Grid.Column="0" Background="{StaticResource BlueGray100Brush}" CornerRadius="4" Height="100">
                                <TextBlock Text="ì‚¬ë¡€3" Style="{StaticResource LabelText}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="2" Grid.Column="2" Background="{StaticResource BlueGray100Brush}" CornerRadius="4" Height="100">
                                <TextBlock Text="ì‚¬ë¡€4" Style="{StaticResource LabelText}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- ë‚™ì°°í†µê³„ ì˜ì—­ -->
                <Border Style="{StaticResource CardBorder}" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <Grid Margin="0,0,0,12">
                            <TextBlock Text="ðŸ“ˆ ë‚™ì°°í†µê³„" Style="{StaticResource SectionHeader}" Margin="0"/>
                            <TextBlock Text="ì ìš©ë‚™ì°°ê°€ìœ¨" 
                                       HorizontalAlignment="Right"
                                       FontSize="{StaticResource FontSizeH4}"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource PrimaryBrush}"/>
                        </Grid>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Grid.Column="0" Background="{StaticResource BlueGray100Brush}" Padding="8,6" Margin="0,0,1,1">
                                <TextBlock Text="ì§€ì—­í†µê³„" Style="{StaticResource LabelText}" FontWeight="SemiBold"/>
                            </Border>
                            <Border Grid.Row="0" Grid.Column="1" Background="{StaticResource BlueGray100Brush}" Padding="8,6" Margin="0,0,1,1">
                                <TextBlock Text="{Binding RegionName1}" Style="{StaticResource ValueText}" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="0" Grid.Column="2" Background="{StaticResource BlueGray100Brush}" Padding="8,6" Margin="0,0,1,1">
                                <TextBlock Text="{Binding RegionName2}" Style="{StaticResource ValueText}" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="0" Grid.Column="3" Background="{StaticResource BlueGray100Brush}" Padding="8,6" Margin="0,0,0,1">
                                <TextBlock Text="{Binding RegionName3}" Style="{StaticResource ValueText}" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                            </Border>

                            <Border Grid.Row="1" Grid.Column="0" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="1,0,1,1" Padding="8,6">
                                <TextBlock Text="1ë…„ í‰ê· " Style="{StaticResource LabelText}"/>
                            </Border>
                            <Border Grid.Row="1" Grid.Column="1" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,0,1,1" Padding="8,6">
                                <TextBlock Text="{Binding Stats1Year_Display1}" Style="{StaticResource ValueText}" HorizontalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="1" Grid.Column="2" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,0,1,1" Padding="8,6">
                                <TextBlock Text="{Binding Stats1Year_Display2}" Style="{StaticResource ValueText}" HorizontalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="1" Grid.Column="3" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,0,1,1" Padding="8,6">
                                <TextBlock Text="{Binding Stats1Year_Display3}" Style="{StaticResource ValueText}" HorizontalAlignment="Center"/>
                            </Border>

                            <Border Grid.Row="2" Grid.Column="0" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="1,0,1,1" Padding="8,6">
                                <TextBlock Text="6ê°œì›” í‰ê· " Style="{StaticResource LabelText}"/>
                            </Border>
                            <Border Grid.Row="2" Grid.Column="1" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,0,1,1" Padding="8,6">
                                <TextBlock Text="{Binding Stats6Month_Display1}" Style="{StaticResource ValueText}" HorizontalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="2" Grid.Column="2" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,0,1,1" Padding="8,6">
                                <TextBlock Text="{Binding Stats6Month_Display2}" Style="{StaticResource ValueText}" HorizontalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="2" Grid.Column="3" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,0,1,1" Padding="8,6">
                                <TextBlock Text="{Binding Stats6Month_Display3}" Style="{StaticResource ValueText}" HorizontalAlignment="Center"/>
                            </Border>

                            <Border Grid.Row="3" Grid.Column="0" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="1,0,1,1" Padding="8,6">
                                <TextBlock Text="3ê°œì›” í‰ê· " Style="{StaticResource LabelText}"/>
                            </Border>
                            <Border Grid.Row="3" Grid.Column="1" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,0,1,1" Padding="8,6">
                                <TextBlock Text="{Binding Stats3Month_Display1}" Style="{StaticResource ValueText}" HorizontalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="3" Grid.Column="2" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,0,1,1" Padding="8,6">
                                <TextBlock Text="{Binding Stats3Month_Display2}" Style="{StaticResource ValueText}" HorizontalAlignment="Center"/>
                            </Border>
                            <Border Grid.Row="3" Grid.Column="3" BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,0,1,1" Padding="8,6">
                                <TextBlock Text="{Binding Stats3Month_Display3}" Style="{StaticResource ValueText}" HorizontalAlignment="Center"/>
                            </Border>

                            <Border Grid.Row="0" Grid.RowSpan="4" Grid.Column="4"
                                    Background="{StaticResource PrimaryBrush}"
                                    CornerRadius="8"
                                    Padding="20,12"
                                    Margin="12,0,0,0"
                                    VerticalAlignment="Center">
                                <StackPanel>
                                    <TextBlock Text="{Binding AppliedBidRate, StringFormat={}{0:P1}}" 
                                               FontSize="{StaticResource FontSizeLarge}"
                                               FontWeight="Bold"
                                               Foreground="White"
                                               HorizontalAlignment="Center"/>
                                    <TextBlock Text="{Binding AppliedBidRateDescription}" 
                                               FontSize="{StaticResource FontSizeSmall}"
                                               Foreground="White"
                                               Opacity="0.9"
                                               HorizontalAlignment="Center"
                                               TextWrapping="Wrap"
                                               MaxWidth="100"
                                               TextAlignment="Center"
                                               Margin="0,6,0,0"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- ë¶€ë™ì‚° íƒë¬¸ë‚´ì—­ -->
                <Border Style="{StaticResource CardBorder}" Padding="16">
                    <StackPanel>
                        <TextBlock Text="ðŸ“ž ë¶€ë™ì‚° íƒë¬¸ë‚´ì—­" Style="{StaticResource SectionHeader}" Margin="0,0,0,12"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="ë¶€ë™ì‚°ëª…" Style="{StaticResource LabelText}" Margin="0,0,0,8"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding InquiryRealEstateName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,8"/>
                            
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="ì—°ë½ì²˜" Style="{StaticResource LabelText}"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding InquiryPhone, UpdateSourceTrigger=PropertyChanged}"/>
                        </Grid>
                        <TextBox Text="{Binding InquiryContent, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="0,8,0,0"
                                 Height="60"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
