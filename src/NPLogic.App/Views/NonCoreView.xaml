<UserControl x:Class="NPLogic.Views.NonCoreView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:NPLogic.Views"
             xmlns:vm="clr-namespace:NPLogic.ViewModels"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1400"
             d:DataContext="{d:DesignInstance Type=vm:NonCoreViewModel}"
             Loaded="NonCoreView_Loaded"
             Focusable="True"
             PreviewKeyDown="NonCoreView_PreviewKeyDown">
    
    <Grid>
        <Grid.RowDefinitions>
            <!-- ë¬¼ê±´ ë²ˆí˜¸ íƒ­ ë°” (ì „ì²´ ë„ˆë¹„) -->
            <RowDefinition Height="Auto"/>
            <!-- í•˜ë‹¨ ë©”ì¸ ì˜ì—­ -->
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- ë¬¼ê±´ ë²ˆí˜¸ íƒ­ ë°” (PDF ìŠ¤íƒ€ì¼) - ì „ì²´ ë„ˆë¹„ë¡œ ë§¨ ìœ„ì— ë°°ì¹˜ -->
        <Border Grid.Row="0" 
                Background="{StaticResource BlueGray50Brush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- ë¬¼ê±´ íƒ­ ìŠ¤í¬ë¡¤ ì˜ì—­ -->
                <ScrollViewer Grid.Column="0" 
                              HorizontalScrollBarVisibility="Auto" 
                              VerticalScrollBarVisibility="Disabled">
                    <ItemsControl ItemsSource="{Binding PropertyTabs}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border x:Name="TabBorder"
                                        Background="White"
                                        BorderBrush="{StaticResource BorderBrush}"
                                        BorderThickness="1,1,1,0"
                                        CornerRadius="4,4,0,0"
                                        Margin="2,4,2,0"
                                        Padding="8,6"
                                        Cursor="Hand"
                                        MouseLeftButtonDown="PropertyTab_Click">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- ë¬¼ê±´ ì•„ì´ì½˜ -->
                                        <materialDesign:PackIcon Grid.Column="0" 
                                                                  Kind="FileDocument" 
                                                                  Width="14" Height="14"
                                                                  VerticalAlignment="Center"
                                                                  Foreground="{StaticResource TextSecondaryBrush}"
                                                                  Margin="0,0,6,0"/>
                                        
                                        <!-- ë¬¼ê±´ ë²ˆí˜¸ -->
                                        <TextBlock Grid.Column="1" 
                                                   Text="{Binding PropertyNumber}" 
                                                   FontSize="{StaticResource FontSizeBody}"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"/>
                                        
                                        <!-- ë‹«ê¸° ë²„íŠ¼ -->
                                        <Button Grid.Column="2"
                                                Style="{StaticResource IconButton}"
                                                Width="16" Height="16"
                                                Padding="0"
                                                Click="ClosePropertyTab_Click"
                                                Tag="{Binding PropertyId}">
                                            <materialDesign:PackIcon Kind="Close" 
                                                                      Width="12" Height="12"
                                                                      Foreground="{StaticResource TextSecondaryBrush}"/>
                                        </Button>
                                    </Grid>
                                </Border>
                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter TargetName="TabBorder" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                        <Setter TargetName="TabBorder" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                
                <!-- ë²„íŠ¼ ì˜ì—­: ì €ìž¥, ë˜ëŒë¦¬ê¸°, ì¸ì‡„, Excel, View(ë¡¤ì—…), ê¸°ëŠ¥ë³„ ì¼ê´„ìž‘ì—… -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="16,0,0,0">
                    <!-- ì €ìž¥ ë²„íŠ¼ -->
                    <Button Style="{StaticResource PrimaryButton}"
                            Padding="10,6"
                            FontSize="{StaticResource FontSizeBody}"
                            Margin="0,0,4,0"
                            ToolTip="ë³€ê²½ì‚¬í•­ ì €ìž¥ (Ctrl+S)"
                            Command="{Binding SaveCommand}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="ContentSave" 
                                                     Width="14" Height="14" 
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,4,0"/>
                            <TextBlock Text="ì €ìž¥" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- ë˜ëŒë¦¬ê¸° ë²„íŠ¼ (í”¼ë“œë°± ë°˜ì˜: ìžë™ì €ìž¥ + ë˜ëŒë¦¬ê¸°) -->
                    <Button Style="{StaticResource SecondaryButton}"
                            Padding="10,6"
                            FontSize="{StaticResource FontSizeBody}"
                            Margin="0,0,8,0"
                            ToolTip="ì´ì „ ìƒíƒœë¡œ ë˜ëŒë¦¬ê¸° (ìµœëŒ€ 3ë‹¨ê³„)"
                            Command="{Binding UndoCommand}"
                            IsEnabled="{Binding CanUndo}">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Undo" 
                                                     Width="14" Height="14" 
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,4,0"/>
                            <TextBlock Text="ë˜ëŒë¦¬ê¸°" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding UndoCount, StringFormat=({0})}" 
                                       VerticalAlignment="Center" 
                                       FontSize="{StaticResource FontSizeTiny}" 
                                       Margin="4,0,0,0"
                                       Opacity="0.7"/>
                        </StackPanel>
                    </Button>
                    
                    <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="0,4,8,4"/>
                    
                    <!-- ì¸ì‡„ ë²„íŠ¼ -->
                    <Button Style="{StaticResource SecondaryButton}"
                            Padding="10,6"
                            FontSize="{StaticResource FontSizeBody}"
                            Margin="0,0,4,0"
                            ToolTip="ì¸ì‡„ (ì „ì²´/ì°¨ì£¼ë³„)"
                            Click="PrintButton_Click">
                        <Button.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="ðŸ“„ ì „ì²´ ì¸ì‡„" Click="PrintAll_Click"/>
                                <MenuItem Header="ðŸ‘¤ ì°¨ì£¼ë³„ ì¸ì‡„" Click="PrintByBorrower_Click"/>
                            </ContextMenu>
                        </Button.ContextMenu>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Printer" 
                                                     Width="14" Height="14" 
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,4,0"/>
                            <TextBlock Text="ì¸ì‡„" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Excel ë²„íŠ¼ -->
                    <Button Style="{StaticResource SecondaryButton}"
                            Padding="10,6"
                            FontSize="{StaticResource FontSizeBody}"
                            Margin="0,0,4,0"
                            ToolTip="Excel ë‚´ë ¤ë°›ê¸° (ì „ì²´/ì°¨ì£¼ë³„)"
                            Click="ExcelButton_Click">
                        <Button.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="ðŸ“Š ì „ì²´ Excel" Click="ExcelAll_Click"/>
                                <MenuItem Header="ðŸ‘¤ ì°¨ì£¼ë³„ Excel (ì‹œíŠ¸ ë¶„ë¦¬)" Click="ExcelByBorrower_Click"/>
                            </ContextMenu>
                        </Button.ContextMenu>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="MicrosoftExcel" 
                                                     Width="14" Height="14" 
                                                     VerticalAlignment="Center"
                                                     Foreground="#217346"
                                                     Margin="0,0,4,0"/>
                            <TextBlock Text="Excel" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- View(ë¡¤ì—…) ë²„íŠ¼ -->
                    <Button Style="{StaticResource PrimaryButton}"
                            Padding="10,6"
                            FontSize="{StaticResource FontSizeBody}"
                            Margin="0,0,8,0"
                            Click="RollupButton_Click"
                            ToolTip="ì „ì²´ í˜„í™© ì°½ ì—´ê¸° (View)">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Eye" 
                                                     Width="14" Height="14" 
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,4,0"/>
                            <TextBlock Text="View" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- ê¸°ëŠ¥ë³„ ì¼ê´„ìž‘ì—… ë²„íŠ¼ -->
                    <Button Content="ê¸°ëŠ¥ë³„ ì¼ê´„ìž‘ì—…"
                            Style="{StaticResource SecondaryButton}"
                            Padding="12,6"
                            FontSize="{StaticResource FontSizeBody}"
                            Click="BatchWorkButton_Click">
                        <Button.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="ì„ ìˆœìœ„ë§Œ ì¼ê´„ìž‘ì—…" Click="BatchSeniorRights_Click"/>
                                <MenuItem Header="í‰ê°€ë§Œ ì¼ê´„ìž‘ì—…" Click="BatchEvaluation_Click"/>
                                <MenuItem Header="ê²½ê³µë§¤ë§Œ ì¼ê´„ìž‘ì—…" Click="BatchAuction_Click"/>
                                <Separator/>
                                <MenuItem Header="ì „ì²´ ë¬¼ê±´ ì¼ê´„ìž‘ì—…" Click="BatchAll_Click"/>
                            </ContextMenu>
                        </Button.ContextMenu>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- í•˜ë‹¨ ë©”ì¸ ì˜ì—­ (ê²€ìƒ‰íŒ¨ë„, ê¸°ëŠ¥íƒ­, ì»¨í…ì¸ , íˆ´ë°•ìŠ¤) -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <!-- í•„í„° íŒ¨ë„ (ì¢Œì¸¡) -->
                <ColumnDefinition Width="Auto"/>
                <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
                <ColumnDefinition Width="*"/>
                <!-- íˆ´ë°•ìŠ¤ ì‚¬ì´ë“œ íŒ¨ë„ -->
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
        
        <!-- ì¢Œì¸¡ í•„í„°/ê²€ìƒ‰ íŒ¨ë„ -->
        <Border Grid.Column="0"
                x:Name="FilterPanel"
                Width="180"
                Background="{StaticResource SurfaceColor}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,1,0"
                Visibility="{Binding IsFilterPanelVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- í•„í„° í—¤ë” -->
                <Border Grid.Row="0" 
                        Background="{StaticResource HeaderNavyBrush}"
                        Padding="12,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="FilterVariant" 
                                                     Width="18" Height="18" 
                                                     Foreground="White"
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,8,0"/>
                            <TextBlock Text="ê²€ìƒ‰" 
                                       Foreground="White"
                                       FontWeight="SemiBold"
                                       FontSize="14"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                        
                        <Button Grid.Column="1"
                                Style="{StaticResource IconButton}"
                                Width="24" Height="24"
                                Click="CloseFilterPanel_Click"
                                ToolTip="í•„í„° íŒ¨ë„ ë‹«ê¸°">
                            <materialDesign:PackIcon Kind="ChevronLeft" 
                                                     Width="18" Height="18"
                                                     Foreground="White"/>
                        </Button>
                    </Grid>
                </Border>
                
                <!-- í•„í„° ì¡°ê±´ ëª©ë¡ -->
                <ScrollViewer Grid.Row="1" 
                              VerticalScrollBarVisibility="Auto"
                              Padding="8,12">
                    <StackPanel>
                        <!-- ì¡°ê±´ë³„ ê²€ìƒ‰ ì•ˆë‚´ -->
                        <TextBlock Text="ì¡°ê±´ë³„ë¡œ ê²€ìƒ‰"
                                   FontSize="{StaticResource FontSizeSmall}"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="4,0,0,8"/>
                        
                        <!-- íšŒìƒì°¨ì£¼ -->
                        <CheckBox Content="íšŒìƒì°¨ì£¼"
                                  IsChecked="{Binding FilterRestructuring}"
                                  FontSize="{StaticResource FontSizeBody}"
                                  Margin="0,0,0,6"
                                  Checked="Filter_Changed"
                                  Unchecked="Filter_Changed"/>
                        
                        <!-- ê°œì¸íšŒìƒ -->
                        <CheckBox Content="ê°œì¸íšŒìƒ"
                                  IsChecked="{Binding FilterPersonalRestructuring}"
                                  FontSize="{StaticResource FontSizeBody}"
                                  Margin="0,0,0,6"
                                  Checked="Filter_Changed"
                                  Unchecked="Filter_Changed"/>
                        
                        <!-- ì°¨ì£¼ê±°ì£¼ -->
                        <CheckBox Content="ì°¨ì£¼ê±°ì£¼"
                                  IsChecked="{Binding FilterBorrowerResidence}"
                                  FontSize="{StaticResource FontSizeBody}"
                                  Margin="0,0,0,6"
                                  Checked="Filter_Changed"
                                  Unchecked="Filter_Changed"/>
                        
                        <!-- ê²½ë§¤ì§„í–‰ -->
                        <CheckBox Content="ê²½ë§¤ì§„í–‰"
                                  IsChecked="{Binding FilterAuctionInProgress}"
                                  FontSize="{StaticResource FontSizeBody}"
                                  Margin="0,0,0,6"
                                  Checked="Filter_Changed"
                                  Unchecked="Filter_Changed"/>
                        
                        <Separator Margin="0,8"/>
                        
                        <!-- ë¬¼ê±´ìœ í˜• ì„¹ì…˜ -->
                        <TextBlock Text="ë¬¼ê±´ìœ í˜•"
                                   FontSize="{StaticResource FontSizeSmall}"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="4,4,0,8"/>
                        
                        <!-- ìƒê°€ -->
                        <CheckBox Content="ìƒê°€"
                                  IsChecked="{Binding FilterCommercial}"
                                  FontSize="{StaticResource FontSizeBody}"
                                  Margin="0,0,0,6"
                                  Checked="Filter_Changed"
                                  Unchecked="Filter_Changed"/>
                        
                        <!-- ì£¼íƒ -->
                        <CheckBox Content="ì£¼íƒ"
                                  IsChecked="{Binding FilterResidential}"
                                  FontSize="{StaticResource FontSizeBody}"
                                  Margin="0,0,0,6"
                                  Checked="Filter_Changed"
                                  Unchecked="Filter_Changed"/>
                        
                        <Separator Margin="0,8"/>
                        
                        <!-- í•„í„° ê²°ê³¼ í‘œì‹œ -->
                        <Border Background="{StaticResource BlueGray50Brush}"
                                CornerRadius="4"
                                Padding="8"
                                Margin="0,4,0,0">
                            <StackPanel>
                                <TextBlock FontSize="{StaticResource FontSizeSmall}" Foreground="{StaticResource TextSecondaryBrush}">
                                    <Run Text="ê²€ìƒ‰ê²°ê³¼: "/>
                                    <Run Text="{Binding FilteredCount, Mode=OneWay}" FontWeight="Bold"/>
                                    <Run Text=" / "/>
                                    <Run Text="{Binding TotalCount, Mode=OneWay}"/>
                                    <Run Text="ê±´"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
                
                <!-- í•„í„° ë²„íŠ¼ ì˜ì—­ -->
                <Border Grid.Row="2" 
                        Background="{StaticResource BlueGray50Brush}"
                        Padding="8">
                    <Button Content="í•„í„° ì´ˆê¸°í™”"
                            Style="{StaticResource SecondaryButton}"
                            FontSize="{StaticResource FontSizeSmall}"
                            Padding="8,6"
                            HorizontalAlignment="Stretch"
                            Click="ClearFilters_Click"/>
                </Border>
            </Grid>
        </Border>
        
        <!-- í•„í„° íŒ¨ë„ ì—´ê¸° ë²„íŠ¼ (ìˆ¨ê²¨ì ¸ ìžˆì„ ë•Œ) -->
        <Button Grid.Column="0"
                Style="{StaticResource IconButton}"
                VerticalAlignment="Top"
                HorizontalAlignment="Left"
                Margin="4,8"
                Click="OpenFilterPanel_Click"
                ToolTip="ê²€ìƒ‰ í•„í„° ì—´ê¸°"
                Visibility="{Binding IsFilterPanelVisible, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
            <materialDesign:PackIcon Kind="FilterVariant" Width="20" Height="20"/>
        </Button>
        
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- ê¸°ëŠ¥ íƒ­ ë°” -->
                <RowDefinition Height="*"/>     <!-- ì»¨í…ì¸  ì˜ì—­ -->
            </Grid.RowDefinitions>
            
            <!-- Ctrl+F ê²€ìƒ‰ íŒ¨ë„ (í”Œë¡œíŒ…) -->
            <Border Grid.Row="0" 
                    x:Name="SearchPanel"
                    Background="White"
                    BorderBrush="{StaticResource PrimaryBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="8"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,44,320,0"
                    Visibility="{Binding IsSearchPanelVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Effect="{StaticResource CardShadow}"
                    Panel.ZIndex="100">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBox Grid.Column="0"
                             x:Name="SearchTextBox"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             Width="200"
                             Padding="8,6"
                             FontSize="{StaticResource FontSizeBody}"
                             VerticalContentAlignment="Center"
                             materialDesign:HintAssist.Hint="ì°¨ì£¼/ë¬¼ê±´ë²ˆí˜¸ ê²€ìƒ‰ (Enter)"
                             KeyDown="SearchTextBox_KeyDown"/>
                    
                    <Button Grid.Column="1"
                            Style="{StaticResource IconButton}"
                            Width="28" Height="28"
                            Margin="4,0,0,0"
                            Click="FindPrevious_Click"
                            ToolTip="ì´ì „ ì°¾ê¸° (Shift+Enter)">
                        <materialDesign:PackIcon Kind="ChevronUp" Width="16" Height="16"/>
                    </Button>
                    
                    <Button Grid.Column="2"
                            Style="{StaticResource IconButton}"
                            Width="28" Height="28"
                            Click="FindNext_Click"
                            ToolTip="ë‹¤ìŒ ì°¾ê¸° (Enter)">
                        <materialDesign:PackIcon Kind="ChevronDown" Width="16" Height="16"/>
                    </Button>
                    
                    <Button Grid.Column="3"
                            Style="{StaticResource IconButton}"
                            Width="28" Height="28"
                            Margin="4,0,0,0"
                            Click="CloseSearchPanel_Click"
                            ToolTip="ë‹«ê¸° (Esc)">
                        <materialDesign:PackIcon Kind="Close" Width="16" Height="16"/>
                    </Button>
                </Grid>
            </Border>

            <!-- ê¸°ëŠ¥ íƒ­ ë°” (10ê°œ íƒ­) - í”¼ë“œë°± ë°˜ì˜: ì „ì²´, ì°¨ì£¼ê°œìš”, Loan, ë‹´ë³´ë¬¼ê±´, ì„ ìˆœìœ„, íšŒìƒê°œìš”, í‰ê°€, ê²½(ê³µ)ë§¤ì¼ì •, í˜„ê¸ˆíë¦„, XNPVë¹„êµ -->
            <Border Grid.Row="0" 
                    Background="White"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,0,1">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                              VerticalScrollBarVisibility="Disabled">
                    <StackPanel Orientation="Horizontal" Margin="16,0">
                        <!-- 1. ì „ì²´ -->
                        <RadioButton x:Name="TabHome"
                                     Content="ì „ì²´"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     IsChecked="True"
                                     Checked="FunctionTab_Checked"
                                     Tag="Home"/>
                        
                        <!-- 2. ì°¨ì£¼ê°œìš” -->
                        <RadioButton x:Name="TabBorrowerOverview"
                                     Content="ì°¨ì£¼ê°œìš”"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="BorrowerOverview"/>
                        
                        <!-- 3. Loan -->
                        <RadioButton x:Name="TabLoan"
                                     Content="Loan"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="Loan"/>
                        
                        <!-- 4. ë‹´ë³´ë¬¼ê±´ (ì§€ë„+ë‹´ë³´ì´ê´„ í¬í•¨) -->
                        <RadioButton x:Name="TabCollateralProperty"
                                     Content="ë‹´ë³´ë¬¼ê±´"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="CollateralProperty"/>
                        
                        <!-- 5. ì„ ìˆœìœ„ -->
                        <RadioButton x:Name="TabSeniorRights"
                                     Content="ì„ ìˆœìœ„"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="SeniorRights"/>
                        
                        <!-- 6. íšŒìƒê°œìš” (íšŒìƒì°¨ì£¼ì¸ ê²½ìš°ì—ë§Œ í‘œì‹œ) -->
                        <RadioButton x:Name="TabRestructuring"
                                     Content="íšŒìƒê°œìš”"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="Restructuring"
                                     Visibility="{Binding IsRestructuringBorrower, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        
                        <!-- 7. í‰ê°€ (ì¶”ì²œ ì‹œìŠ¤í…œ í¬í•¨) -->
                        <RadioButton x:Name="TabEvaluation"
                                     Content="í‰ê°€"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="Evaluation"/>
                        
                        <!-- 8. ê²½(ê³µ)ë§¤ì¼ì • -->
                        <RadioButton x:Name="TabAuctionSchedule"
                                     Content="ê²½(ê³µ)ë§¤ì¼ì •"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="AuctionSchedule"/>
                        
                        <!-- S-002: í˜„ê¸ˆíë¦„, XNPV ë¹„êµëŠ” ìƒë‹¨ ë©”ë‰´ë¡œ ì´ë™ (Collapsed) -->
                        <!-- 9. í˜„ê¸ˆíë¦„ - ìƒë‹¨ ë©”ë‰´ë¡œ ì´ë™ -->
                        <RadioButton x:Name="TabCashFlow"
                                     Content="í˜„ê¸ˆíë¦„"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="CashFlow"
                                     Visibility="Collapsed"/>
                        
                        <!-- 10. XNPV ë¹„êµ - ìƒë‹¨ ë©”ë‰´ë¡œ ì´ë™ -->
                        <RadioButton x:Name="TabXnpvComparison"
                                     Content="XNPV ë¹„êµ"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="XnpvComparison"
                                     Visibility="Collapsed"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- ì»¨í…ì¸  ì˜ì—­ -->
            <ContentControl Grid.Row="1" x:Name="ContentArea"/>
        </Grid>
        
        <!-- íˆ´ë°•ìŠ¤ ì‚¬ì´ë“œ íŒ¨ë„ -->
        <Border Grid.Column="2" 
                x:Name="ToolBoxPanel"
                Width="300"
                Background="{StaticResource SurfaceColor}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1,0,0,0"
                Visibility="{Binding IsToolBoxVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- íˆ´ë°•ìŠ¤ í—¤ë” -->
                <Border Grid.Row="0" 
                        Background="{StaticResource BlueGray50Brush}"
                        Padding="12,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                   Text="Tool Box" 
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                        
                        <Button Grid.Column="1"
                                Style="{StaticResource IconButton}"
                                Click="CloseToolBox_Click">
                            <materialDesign:PackIcon Kind="Close" Width="18" Height="18"/>
                        </Button>
                    </Grid>
                </Border>
                
                <!-- íˆ´ë°•ìŠ¤ ì»¨í…ì¸  -->
                <ScrollViewer Grid.Row="1" 
                              VerticalScrollBarVisibility="Auto"
                              Padding="12">
                    <StackPanel>
                        <!-- ë²•ì› ì •ë³´ -->
                        <Expander Header="ë²•ì› ì •ë³´" IsExpanded="True" Margin="0,0,0,8">
                            <StackPanel Margin="8">
                                <ComboBox ItemsSource="{Binding Courts}"
                                          SelectedItem="{Binding SelectedCourt}"
                                          DisplayMemberPath="CourtName"
                                          Margin="0,0,0,8"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,4,4">
                                        <TextBlock Text="1íšŒì°¨" FontSize="{StaticResource FontSizeSmall}" Opacity="0.6"/>
                                        <TextBlock Text="{Binding SelectedCourt.DiscountRate1, StringFormat=P0}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="0" Grid.Column="1" Margin="4,0,0,4">
                                        <TextBlock Text="2íšŒì°¨" FontSize="{StaticResource FontSizeSmall}" Opacity="0.6"/>
                                        <TextBlock Text="{Binding SelectedCourt.DiscountRate2, StringFormat=P0}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,4,4,0">
                                        <TextBlock Text="3íšŒì°¨" FontSize="{StaticResource FontSizeSmall}" Opacity="0.6"/>
                                        <TextBlock Text="{Binding SelectedCourt.DiscountRate3, StringFormat=P0}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="1" Grid.Column="1" Margin="4,4,0,0">
                                        <TextBlock Text="4íšŒì°¨" FontSize="{StaticResource FontSizeSmall}" Opacity="0.6"/>
                                        <TextBlock Text="{Binding SelectedCourt.DiscountRate4, StringFormat=P0}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Expander>
                        
                        <!-- ë¹ ë¥¸ ê³„ì‚° -->
                        <Expander Header="ë¹ ë¥¸ ê³„ì‚°" IsExpanded="False" Margin="0,0,0,8">
                            <StackPanel Margin="8">
                                <TextBlock Text="ê°ì •ê°€" FontSize="{StaticResource FontSizeSmall}" Opacity="0.6" Margin="0,0,0,4"/>
                                <TextBox x:Name="QuickCalcAppraisalValue" Margin="0,0,0,8" Padding="8,6"/>
                                
                                <TextBlock Text="ì €ê°ìœ¨" FontSize="{StaticResource FontSizeSmall}" Opacity="0.6" Margin="0,0,0,4"/>
                                <TextBox x:Name="QuickCalcDiscountRate" Text="20%" Margin="0,0,0,8" Padding="8,6"/>
                                
                                <Button Content="ê³„ì‚°" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="QuickCalculate_Click"
                                        Margin="0,0,0,8"/>
                                
                                <Border Background="{StaticResource BackgroundColor}" 
                                        CornerRadius="4" 
                                        Padding="8">
                                    <StackPanel>
                                        <TextBlock Text="ì˜ˆìƒ ë‚™ì°°ê°€" FontSize="{StaticResource FontSizeSmall}" Opacity="0.6"/>
                                        <TextBlock x:Name="QuickCalcResult" 
                                                   Text="-" 
                                                   FontWeight="Bold" 
                                                   FontSize="{StaticResource FontSizeH3}"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Expander>
                        
                        <!-- ìƒê¶Œ ë¶„ì„ (Phase 7.1) -->
                        <Expander Header="ðŸ“Š ìƒê¶Œ ë¶„ì„" IsExpanded="True" Margin="0,0,0,8">
                            <StackPanel Margin="8">
                                <TextBlock Text="ì„ íƒí•œ ë¬¼ê±´ ì£¼ë³€ì˜ ìƒê¶Œ ì •ë³´ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤."
                                           FontSize="{StaticResource FontSizeSmall}"
                                           Foreground="{StaticResource TextMutedBrush}"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,8"/>
                                <Button Style="{StaticResource PrimaryButton}"
                                        Click="OpenCommercialMap_Click"
                                        Padding="12,8"
                                        HorizontalContentAlignment="Center">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="MapSearch" 
                                                                 Width="16" Height="16" 
                                                                 VerticalAlignment="Center"
                                                                 Margin="0,0,8,0"/>
                                        <TextBlock Text="ìƒê¶Œ ì§€ë„ ì—´ê¸°" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <TextBlock Text="â€» ìƒê°€/ì•„íŒŒíŠ¸í˜•ê³µìž¥ ë¬¼ê±´ì— ìœ ìš©í•©ë‹ˆë‹¤."
                                           FontSize="{StaticResource FontSizeTiny}"
                                           Foreground="{StaticResource TextTertiaryBrush}"
                                           Margin="0,8,0,0"/>
                            </StackPanel>
                        </Expander>
                        
                        <!-- ì°¸ì¡° ë§í¬ -->
                        <Expander Header="ì°¸ì¡° ë§í¬" IsExpanded="False" Margin="0,0,0,8">
                            <StackPanel Margin="8">
                                <Button Content="ëŒ€ë²•ì› ê²½ë§¤ì •ë³´" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="OpenCourtAuction_Click"
                                        Margin="0,0,0,4"
                                        HorizontalContentAlignment="Left"/>
                                <Button Content="ì˜¨ë¹„ë“œ ê³µë§¤" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="OpenOnbid_Click"
                                        Margin="0,0,0,4"
                                        HorizontalContentAlignment="Left"/>
                                <Button Content="KB ë¶€ë™ì‚°" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="OpenKBLand_Click"
                                        Margin="0,0,0,4"
                                        HorizontalContentAlignment="Left"/>
                                <Button Content="êµ­í† êµí†µë¶€ ì‹¤ê±°ëž˜ê°€" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="OpenRealTransaction_Click"
                                        HorizontalContentAlignment="Left"/>
                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
        
        <!-- íˆ´ë°•ìŠ¤ ì—´ê¸° ë²„íŠ¼ (ìˆ¨ê²¨ì ¸ ìžˆì„ ë•Œ) -->
        <Button Grid.Column="2"
                Style="{StaticResource IconButton}"
                VerticalAlignment="Top"
                Margin="4,8"
                Click="OpenToolBox_Click"
                Visibility="{Binding IsToolBoxVisible, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
            <materialDesign:PackIcon Kind="Toolbox" Width="20" Height="20"/>
        </Button>
        
        </Grid>
        
        <!-- ì „ì²´ í™”ë©´ ë¡œë”© ì˜¤ë²„ë ˆì´ -->
        <Border Grid.RowSpan="2" 
                Background="{StaticResource OverlayBrush}" 
                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200"/>
                <TextBlock Text="ë¡œë”© ì¤‘..." Foreground="White" Margin="0,16,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>

