<UserControl x:Class="NPLogic.Views.NonCoreView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:NPLogic.Views"
             xmlns:vm="clr-namespace:NPLogic.ViewModels"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1400"
             d:DataContext="{d:DesignInstance Type=vm:NonCoreViewModel}"
             Loaded="NonCoreView_Loaded"
             Focusable="True"
             PreviewKeyDown="NonCoreView_PreviewKeyDown">
    
    <Grid>
        <Grid.ColumnDefinitions>
            <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
            <ColumnDefinition Width="*"/>
            <!-- íˆ´ë°•ìŠ¤ ì‚¬ì´ë“œ íŒ¨ë„ -->
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- ë¬¼ê±´ ë²ˆí˜¸ íƒ­ ë°” -->
                <RowDefinition Height="Auto"/>  <!-- ê¸°ëŠ¥ íƒ­ ë°” -->
                <RowDefinition Height="*"/>     <!-- ì»¨í…ì¸  ì˜ì—­ -->
            </Grid.RowDefinitions>

            <!-- ë¬¼ê±´ ë²ˆí˜¸ íƒ­ ë°” (PDF ìŠ¤íƒ€ì¼) -->
            <Border Grid.Row="0" 
                    Background="{StaticResource BlueGray50Brush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,0,1"
                    Padding="8,4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- ë¬¼ê±´ íƒ­ ìŠ¤í¬ë¡¤ ì˜ì—­ -->
                    <ScrollViewer Grid.Column="0" 
                                  HorizontalScrollBarVisibility="Auto" 
                                  VerticalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding PropertyTabs}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border x:Name="TabBorder"
                                            Background="White"
                                            BorderBrush="{StaticResource BorderBrush}"
                                            BorderThickness="1,1,1,0"
                                            CornerRadius="4,4,0,0"
                                            Margin="2,4,2,0"
                                            Padding="8,6"
                                            Cursor="Hand"
                                            MouseLeftButtonDown="PropertyTab_Click">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- ë¬¼ê±´ ì•„ì´ì½˜ -->
                                            <materialDesign:PackIcon Grid.Column="0" 
                                                                      Kind="FileDocument" 
                                                                      Width="14" Height="14"
                                                                      VerticalAlignment="Center"
                                                                      Foreground="{StaticResource TextSecondaryBrush}"
                                                                      Margin="0,0,6,0"/>
                                            
                                            <!-- ë¬¼ê±´ ë²ˆí˜¸ -->
                                            <TextBlock Grid.Column="1" 
                                                       Text="{Binding PropertyNumber}" 
                                                       FontSize="12"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,8,0"/>
                                            
                                            <!-- ë‹«ê¸° ë²„íŠ¼ -->
                                            <Button Grid.Column="2"
                                                    Style="{StaticResource IconButton}"
                                                    Width="16" Height="16"
                                                    Padding="0"
                                                    Click="ClosePropertyTab_Click"
                                                    Tag="{Binding PropertyId}">
                                                <materialDesign:PackIcon Kind="Close" 
                                                                          Width="12" Height="12"
                                                                          Foreground="{StaticResource TextSecondaryBrush}"/>
                                            </Button>
                                        </Grid>
                                    </Border>
                                    <DataTemplate.Triggers>
                                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                            <Setter TargetName="TabBorder" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                                            <Setter TargetName="TabBorder" Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                        </DataTrigger>
                                    </DataTemplate.Triggers>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <!-- ê¸°ëŠ¥ë³„ ì¼ê´„ìž‘ì—… ë²„íŠ¼ ë° ë¡¤ì—… ë²„íŠ¼ -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="16,0,0,0">
                        <Button Content="ê¸°ëŠ¥ë³„ ì¼ê´„ìž‘ì—…"
                                Style="{StaticResource SecondaryButton}"
                                Padding="12,6"
                                FontSize="12"
                                Margin="0,0,8,0"
                                Click="BatchWorkButton_Click">
                            <Button.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="ì„ ìˆœìœ„ë§Œ ì¼ê´„ìž‘ì—…" Click="BatchSeniorRights_Click"/>
                                    <MenuItem Header="í‰ê°€ë§Œ ì¼ê´„ìž‘ì—…" Click="BatchEvaluation_Click"/>
                                    <MenuItem Header="ê²½ê³µë§¤ë§Œ ì¼ê´„ìž‘ì—…" Click="BatchAuction_Click"/>
                                    <Separator/>
                                    <MenuItem Header="ì „ì²´ ë¬¼ê±´ ì¼ê´„ìž‘ì—…" Click="BatchAll_Click"/>
                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>
                        
                        <!-- ë¡¤ì—… ë²„íŠ¼ (Phase 4.5) -->
                        <Button Style="{StaticResource PrimaryButton}"
                                Padding="12,6"
                                FontSize="12"
                                Click="RollupButton_Click"
                                ToolTip="ì „ì²´ í˜„í™© ì°½ ì—´ê¸° (Ctrl+R)">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="TableLarge" 
                                                         Width="14" Height="14" 
                                                         VerticalAlignment="Center"
                                                         Margin="0,0,6,0"/>
                                <TextBlock Text="ë¡¤ì—…" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ê¸°ëŠ¥ íƒ­ ë°” (9ê°œ íƒ­) -->
            <Border Grid.Row="1" 
                    Background="White"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,0,1">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                              VerticalScrollBarVisibility="Disabled">
                    <StackPanel Orientation="Horizontal" Margin="16,0">
                        <!-- 1. ì°¨ì£¼ ê°œìš” -->
                        <RadioButton x:Name="TabBorrowerOverview"
                                     Content="ì°¨ì£¼ ê°œìš”"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     IsChecked="True"
                                     Checked="FunctionTab_Checked"
                                     Tag="BorrowerOverview"/>
                        
                        <!-- 2. ë¡  -->
                        <RadioButton x:Name="TabLoan"
                                     Content="ë¡ "
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="Loan"/>
                        
                        <!-- 3. ë‹´ë³´ ì´ê´„ -->
                        <RadioButton x:Name="TabCollateralSummary"
                                     Content="ë‹´ë³´ ì´ê´„"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="CollateralSummary"/>
                        
                        <!-- 4. ë‹´ë³´ ë¬¼ê±´ -->
                        <RadioButton x:Name="TabCollateralProperty"
                                     Content="ë‹´ë³´ ë¬¼ê±´"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="CollateralProperty"/>
                        
                        <!-- 5. ì„ ìˆœìœ„ í‰ê°€ -->
                        <RadioButton x:Name="TabSeniorRights"
                                     Content="ì„ ìˆœìœ„ í‰ê°€"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="SeniorRights"/>
                        
                        <!-- 6. ê²½ê³µë§¤ -->
                        <RadioButton x:Name="TabAuction"
                                     Content="ê²½ê³µë§¤"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="Auction"/>
                        
                        <!-- 7. íšŒìƒ ê°œìš” -->
                        <RadioButton x:Name="TabRestructuring"
                                     Content="íšŒìƒ ê°œìš”"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="Restructuring"/>
                        
                        <!-- 8. í˜„ê¸ˆíë¦„ ì§‘ê³„ -->
                        <RadioButton x:Name="TabCashFlow"
                                     Content="í˜„ê¸ˆíë¦„ ì§‘ê³„"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="CashFlow"/>
                        
                        <!-- 9. NPB -->
                        <RadioButton x:Name="TabNPB"
                                     Content="NPB"
                                     Style="{StaticResource NonCoreTabStyle}"
                                     Checked="FunctionTab_Checked"
                                     Tag="NPB"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- ì»¨í…ì¸  ì˜ì—­ -->
            <ContentControl Grid.Row="2" x:Name="ContentArea"/>
        </Grid>
        
        <!-- íˆ´ë°•ìŠ¤ ì‚¬ì´ë“œ íŒ¨ë„ -->
        <Border Grid.Column="1" 
                x:Name="ToolBoxPanel"
                Width="300"
                Background="{StaticResource SurfaceColor}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1,0,0,0"
                Visibility="{Binding IsToolBoxVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- íˆ´ë°•ìŠ¤ í—¤ë” -->
                <Border Grid.Row="0" 
                        Background="{StaticResource BlueGray50Brush}"
                        Padding="12,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                   Text="Tool Box" 
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                        
                        <Button Grid.Column="1"
                                Style="{StaticResource IconButton}"
                                Click="CloseToolBox_Click">
                            <materialDesign:PackIcon Kind="Close" Width="18" Height="18"/>
                        </Button>
                    </Grid>
                </Border>
                
                <!-- íˆ´ë°•ìŠ¤ ì»¨í…ì¸  -->
                <ScrollViewer Grid.Row="1" 
                              VerticalScrollBarVisibility="Auto"
                              Padding="12">
                    <StackPanel>
                        <!-- ë²•ì› ì •ë³´ -->
                        <Expander Header="ë²•ì› ì •ë³´" IsExpanded="True" Margin="0,0,0,8">
                            <StackPanel Margin="8">
                                <ComboBox ItemsSource="{Binding Courts}"
                                          SelectedItem="{Binding SelectedCourt}"
                                          DisplayMemberPath="CourtName"
                                          Margin="0,0,0,8"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,4,4">
                                        <TextBlock Text="1íšŒì°¨" FontSize="11" Opacity="0.6"/>
                                        <TextBlock Text="{Binding SelectedCourt.DiscountRate1, StringFormat=P0}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="0" Grid.Column="1" Margin="4,0,0,4">
                                        <TextBlock Text="2íšŒì°¨" FontSize="11" Opacity="0.6"/>
                                        <TextBlock Text="{Binding SelectedCourt.DiscountRate2, StringFormat=P0}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,4,4,0">
                                        <TextBlock Text="3íšŒì°¨" FontSize="11" Opacity="0.6"/>
                                        <TextBlock Text="{Binding SelectedCourt.DiscountRate3, StringFormat=P0}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="1" Grid.Column="1" Margin="4,4,0,0">
                                        <TextBlock Text="4íšŒì°¨" FontSize="11" Opacity="0.6"/>
                                        <TextBlock Text="{Binding SelectedCourt.DiscountRate4, StringFormat=P0}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Expander>
                        
                        <!-- ë¹ ë¥¸ ê³„ì‚° -->
                        <Expander Header="ë¹ ë¥¸ ê³„ì‚°" IsExpanded="False" Margin="0,0,0,8">
                            <StackPanel Margin="8">
                                <TextBlock Text="ê°ì •ê°€" FontSize="11" Opacity="0.6" Margin="0,0,0,4"/>
                                <TextBox x:Name="QuickCalcAppraisalValue" Margin="0,0,0,8" Padding="8,6"/>
                                
                                <TextBlock Text="ì €ê°ìœ¨" FontSize="11" Opacity="0.6" Margin="0,0,0,4"/>
                                <TextBox x:Name="QuickCalcDiscountRate" Text="20%" Margin="0,0,0,8" Padding="8,6"/>
                                
                                <Button Content="ê³„ì‚°" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="QuickCalculate_Click"
                                        Margin="0,0,0,8"/>
                                
                                <Border Background="{StaticResource BackgroundColor}" 
                                        CornerRadius="4" 
                                        Padding="8">
                                    <StackPanel>
                                        <TextBlock Text="ì˜ˆìƒ ë‚™ì°°ê°€" FontSize="11" Opacity="0.6"/>
                                        <TextBlock x:Name="QuickCalcResult" 
                                                   Text="-" 
                                                   FontWeight="Bold" 
                                                   FontSize="16"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Expander>
                        
                        <!-- ìƒê¶Œ ë¶„ì„ (Phase 7.1) -->
                        <Expander Header="ðŸ“Š ìƒê¶Œ ë¶„ì„" IsExpanded="True" Margin="0,0,0,8">
                            <StackPanel Margin="8">
                                <TextBlock Text="ì„ íƒí•œ ë¬¼ê±´ ì£¼ë³€ì˜ ìƒê¶Œ ì •ë³´ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤."
                                           FontSize="11"
                                           Foreground="#64748B"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,8"/>
                                <Button Style="{StaticResource PrimaryButton}"
                                        Click="OpenCommercialMap_Click"
                                        Padding="12,8"
                                        HorizontalContentAlignment="Center">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="MapSearch" 
                                                                 Width="16" Height="16" 
                                                                 VerticalAlignment="Center"
                                                                 Margin="0,0,8,0"/>
                                        <TextBlock Text="ìƒê¶Œ ì§€ë„ ì—´ê¸°" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <TextBlock Text="â€» ìƒê°€/ì•„íŒŒíŠ¸í˜•ê³µìž¥ ë¬¼ê±´ì— ìœ ìš©í•©ë‹ˆë‹¤."
                                           FontSize="10"
                                           Foreground="#94A3B8"
                                           Margin="0,8,0,0"/>
                            </StackPanel>
                        </Expander>
                        
                        <!-- ì°¸ì¡° ë§í¬ -->
                        <Expander Header="ì°¸ì¡° ë§í¬" IsExpanded="False" Margin="0,0,0,8">
                            <StackPanel Margin="8">
                                <Button Content="ëŒ€ë²•ì› ê²½ë§¤ì •ë³´" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="OpenCourtAuction_Click"
                                        Margin="0,0,0,4"
                                        HorizontalContentAlignment="Left"/>
                                <Button Content="ì˜¨ë¹„ë“œ ê³µë§¤" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="OpenOnbid_Click"
                                        Margin="0,0,0,4"
                                        HorizontalContentAlignment="Left"/>
                                <Button Content="KB ë¶€ë™ì‚°" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="OpenKBLand_Click"
                                        Margin="0,0,0,4"
                                        HorizontalContentAlignment="Left"/>
                                <Button Content="êµ­í† êµí†µë¶€ ì‹¤ê±°ëž˜ê°€" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="OpenRealTransaction_Click"
                                        HorizontalContentAlignment="Left"/>
                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
        
        <!-- íˆ´ë°•ìŠ¤ ì—´ê¸° ë²„íŠ¼ (ìˆ¨ê²¨ì ¸ ìžˆì„ ë•Œ) -->
        <Button Grid.Column="1"
                Style="{StaticResource IconButton}"
                VerticalAlignment="Top"
                Margin="4,8"
                Click="OpenToolBox_Click"
                Visibility="{Binding IsToolBoxVisible, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
            <materialDesign:PackIcon Kind="Toolbox" Width="20" Height="20"/>
        </Button>
        
        <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
        <Border Grid.ColumnSpan="2" 
                Background="#80000000" 
                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200"/>
                <TextBlock Text="ë¡œë”© ì¤‘..." Foreground="White" Margin="0,16,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>

