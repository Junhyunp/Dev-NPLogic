<UserControl x:Class="NPLogic.Views.MapView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800"
             Loaded="MapView_Loaded"
             Unloaded="MapView_Unloaded">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- ìƒë‹¨ ë ˆì´ì–´ ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <Border Grid.Row="0"
                Background="{StaticResource BackgroundBrush}"
                BorderBrush="{StaticResource BlueGray200Brush}"
                BorderThickness="0,0,0,1"
                Padding="16,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- ë ˆì´ì–´ ì„ íƒ ì²´í¬ë°•ìŠ¤ -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="ë ˆì´ì–´:" 
                               VerticalAlignment="Center"
                               Foreground="#64748B"
                               FontWeight="SemiBold"
                               Margin="0,0,16,0"/>
                    
                    <CheckBox x:Name="ChkBaseMap"
                              Content="ê¸°ë³¸ì§€ë„"
                              IsChecked="True"
                              VerticalAlignment="Center"
                              Margin="0,0,16,0"
                              Checked="LayerCheckbox_Changed"
                              Unchecked="LayerCheckbox_Changed"/>
                    
                    <CheckBox x:Name="ChkSatellite"
                              Content="ìœ„ì„±ì§€ë„"
                              IsChecked="False"
                              VerticalAlignment="Center"
                              Margin="0,0,16,0"
                              Checked="LayerCheckbox_Changed"
                              Unchecked="LayerCheckbox_Changed"/>
                    
                    <CheckBox x:Name="ChkCadastral"
                              Content="ì§€ì ë„"
                              IsChecked="False"
                              VerticalAlignment="Center"
                              Margin="0,0,16,0"
                              Checked="LayerCheckbox_Changed"
                              Unchecked="LayerCheckbox_Changed"/>
                    
                    <CheckBox x:Name="ChkLandUse"
                              Content="í† ì§€ì´ìš©ê³„íš"
                              IsChecked="False"
                              VerticalAlignment="Center"
                              Margin="0,0,16,0"
                              Checked="LayerCheckbox_Changed"
                              Unchecked="LayerCheckbox_Changed"
                              ToolTip="êµ­í† ì´ìš©ì •ë³´ì„œë¹„ìŠ¤ ì—°ë™ í•„ìš”"/>
                    
                    <Border Background="{StaticResource BlueGray200Brush}" 
                            Width="1" 
                            Margin="8,4,16,4"/>
                    
                    <CheckBox x:Name="ChkRoadView"
                              Content="ë¡œë“œë·°"
                              IsChecked="False"
                              VerticalAlignment="Center"
                              Margin="0,0,0,0"
                              Checked="RoadViewCheckbox_Changed"
                              Unchecked="RoadViewCheckbox_Changed"/>
                </StackPanel>
                
                <!-- ìš°ì¸¡ ë²„íŠ¼ë“¤ -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="BtnZoomIn"
                            Content="+"
                            Width="32" Height="32"
                            FontSize="16"
                            FontWeight="Bold"
                            Click="ZoomIn_Click"
                            Style="{StaticResource SecondaryButton}"
                            Margin="0,0,4,0"/>
                    
                    <Button x:Name="BtnZoomOut"
                            Content="-"
                            Width="32" Height="32"
                            FontSize="16"
                            FontWeight="Bold"
                            Click="ZoomOut_Click"
                            Style="{StaticResource SecondaryButton}"
                            Margin="0,0,16,0"/>
                    
                    <Button x:Name="BtnRefreshMap"
                            Content="ìƒˆë¡œê³ ì¹¨"
                            Click="RefreshMap_Click"
                            Style="{StaticResource SecondaryButton}"
                            Padding="12,6"
                            Margin="0,0,8,0"/>
                    
                    <Button x:Name="BtnOpenExternal"
                            Content="ì™¸ë¶€ì—ì„œ ì—´ê¸°"
                            Click="OpenExternal_Click"
                            Style="{StaticResource PrimaryButton}"
                            Padding="12,6"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- ì§€ë„ ì˜ì—­ -->
        <Grid Grid.Row="1">
            <!-- WebView2 ì§€ë„ ì»¨íŠ¸ë¡¤ -->
            <wv2:WebView2 x:Name="MapWebView"
                          DefaultBackgroundColor="Transparent"/>
            
            <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
            <Border x:Name="LoadingOverlay"
                    Background="#F0F5F9"
                    Visibility="Visible">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <ProgressBar IsIndeterminate="True"
                                 Width="200"
                                 Height="4"
                                 Margin="0,0,0,16"/>
                    <TextBlock Text="ì§€ë„ ë¡œë”© ì¤‘..."
                               FontSize="14"
                               Foreground="#64748B"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
            
            <!-- ë¡œë“œë·° ì»¨í…Œì´ë„ˆ (ìƒë‹¨ì— ì˜¤ë²„ë ˆì´) -->
            <Border x:Name="RoadViewContainer"
                    Background="Transparent"
                    Visibility="Collapsed"
                    VerticalAlignment="Top"
                    HorizontalAlignment="Right"
                    Margin="16"
                    Width="320"
                    Height="240">
                <Border.Effect>
                    <DropShadowEffect Color="Black" Opacity="0.3" BlurRadius="10" ShadowDepth="3"/>
                </Border.Effect>
                
                <Grid>
                    <wv2:WebView2 x:Name="RoadViewWebView"/>
                    
                    <!-- ë¡œë“œë·° ë‹«ê¸° ë²„íŠ¼ -->
                    <Button Content="âœ•"
                            Width="24" Height="24"
                            FontSize="12"
                            Background="#EF4444"
                            Foreground="White"
                            BorderThickness="0"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="4"
                            Click="CloseRoadView_Click"/>
                </Grid>
            </Border>
            
            <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
            <Border x:Name="ErrorOverlay"
                    Background="#1A2744"
                    Visibility="Collapsed">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="ðŸ—ºï¸"
                               FontSize="48"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,16"/>
                    <TextBlock x:Name="ErrorMessage"
                               Text="ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
                               FontSize="16"
                               Foreground="White"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,8"/>
                    <TextBlock x:Name="ErrorDetail"
                               Text=""
                               FontSize="12"
                               Foreground="#94A3B8"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               MaxWidth="300"/>
                    <Button x:Name="RetryButton"
                            Content="ë‹¤ì‹œ ì‹œë„"
                            Margin="0,24,0,0"
                            Padding="24,10"
                            Click="RetryButton_Click"
                            Style="{StaticResource SecondaryButton}"/>
                </StackPanel>
            </Border>
            
            <!-- ì¢Œí‘œ ì •ë³´ í‘œì‹œ (ì¢Œí•˜ë‹¨) -->
            <Border Background="#E0FFFFFF"
                    CornerRadius="4"
                    Padding="8,4"
                    VerticalAlignment="Bottom"
                    HorizontalAlignment="Left"
                    Margin="16">
                <TextBlock x:Name="CoordinateInfo"
                           Text="ì¢Œí‘œ: -"
                           FontSize="11"
                           Foreground="#475569"/>
            </Border>
        </Grid>
    </Grid>
</UserControl>
