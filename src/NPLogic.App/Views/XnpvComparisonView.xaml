<UserControl x:Class="NPLogic.Views.XnpvComparisonView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:NPLogic.Views"
             xmlns:vm="clr-namespace:NPLogic.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1400"
             d:DataContext="{d:DesignInstance Type=vm:XnpvComparisonViewModel}"
             Loaded="XnpvComparisonView_Loaded">
    
    <Grid Margin="12,8,12,12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 헤더 -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel>
                <TextBlock Text="XNPV 비교 분석" Style="{StaticResource H2TextStyle}" Margin="0,0,0,8"/>
                <TextBlock Text="시나리오별 XNPV 비교 및 투자 우선순위 분석" Style="{StaticResource BodyTextStyle}" Opacity="0.7"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="Excel 내보내기" Command="{Binding ExportToExcelCommand}"
                        Style="{StaticResource SecondaryButton}" Padding="20,10" Margin="0,0,8,0"/>
                <Button Content="새로고침" Command="{Binding RefreshCommand}"
                        Style="{StaticResource PrimaryButton}" Padding="20,10"/>
            </StackPanel>
        </Grid>

        <!-- 요약 카드 -->
        <Grid Grid.Row="1" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="{StaticResource SurfaceColor}" CornerRadius="12" Padding="20">
                <StackPanel>
                    <TextBlock Text="시나리오 1안 합계" FontSize="{StaticResource FontSizeBody}" Opacity="0.7"/>
                    <TextBlock FontSize="{StaticResource FontSizeXLarge}" FontWeight="Bold" Margin="0,8,0,0" Foreground="#64B5F6">
                        <Run Text="{Binding TotalXnpv1, StringFormat=N0}"/>
                        <Run Text="원" FontSize="{StaticResource FontSizeH4}" FontWeight="Normal"/>
                    </TextBlock>
                </StackPanel>
            </Border>

            <Border Grid.Column="2" Background="{StaticResource SurfaceColor}" CornerRadius="12" Padding="20">
                <StackPanel>
                    <TextBlock Text="시나리오 2안 합계" FontSize="{StaticResource FontSizeBody}" Opacity="0.7"/>
                    <TextBlock FontSize="{StaticResource FontSizeXLarge}" FontWeight="Bold" Margin="0,8,0,0" Foreground="{StaticResource MaterialGreenBrush}">
                        <Run Text="{Binding TotalXnpv2, StringFormat=N0}"/>
                        <Run Text="원" FontSize="{StaticResource FontSizeH4}" FontWeight="Normal"/>
                    </TextBlock>
                </StackPanel>
            </Border>

            <Border Grid.Column="4" Background="#64B5F6" CornerRadius="12" Padding="20">
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="투자 추천" FontSize="{StaticResource FontSizeBody}" Foreground="White" Opacity="0.9"/>
                    <TextBlock Text="{Binding Recommendation}" FontSize="{StaticResource FontSizeH4}" FontWeight="Bold" Foreground="White" 
                               Margin="0,8,0,0" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- 비교 그리드 -->
        <Border Grid.Row="2" Background="{StaticResource SurfaceColor}" CornerRadius="12" Padding="20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="차주별 XNPV 비교" FontWeight="SemiBold" FontSize="{StaticResource FontSizeH4}" Margin="0,0,0,16"/>

                <DataGrid Grid.Row="1"
                          ItemsSource="{Binding ComparisonItems}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          HeadersVisibility="Column"
                          GridLinesVisibility="All"
                          HorizontalGridLinesBrush="{StaticResource TableBorderBrush}"
                          VerticalGridLinesBrush="{StaticResource TableBorderBrush}"
                          BorderThickness="0"
                          Background="Transparent"
                          AlternatingRowBackground="{StaticResource BackgroundColor}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="차주번호" Binding="{Binding BorrowerNumber}" Width="100"/>
                        <DataGridTextColumn Header="차주명" Binding="{Binding BorrowerName}" Width="150"/>
                        <DataGridTextColumn Header="물건수" Binding="{Binding PropertyCount}" Width="60">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="OPB" Binding="{Binding TotalOpb, StringFormat=N0}" Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="XNPV (1안)" Binding="{Binding Xnpv1, StringFormat=N0}" Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                    <Setter Property="Foreground" Value="#64B5F6"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Ratio (1안)" Binding="{Binding Ratio1, StringFormat=P1}" Width="90">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="XNPV (2안)" Binding="{Binding Xnpv2, StringFormat=N0}" Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                    <Setter Property="Foreground" Value="#81C784"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Ratio (2안)" Binding="{Binding Ratio2, StringFormat=P1}" Width="90">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="차이" Binding="{Binding Difference, StringFormat=N0}" Width="100">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Right"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="추천" Binding="{Binding BetterScenario}" Width="60">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- 로딩 오버레이 -->
        <Border Grid.RowSpan="3" Background="#80000000" CornerRadius="8"
                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Value="{Binding LoadingProgress}" Maximum="{Binding LoadingTotal}" Width="200" Height="8"/>
                <TextBlock Text="{Binding LoadingMessage}" Foreground="White" Margin="0,16,0,0" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>

