<UserControl x:Class="NPLogic.Views.RightsAnalysisTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:NPLogic.ViewModels"
             xmlns:controls="clr-namespace:NPLogic.Controls;assembly=NPLogic.UI"
             mc:Ignorable="d" 
             d:DesignHeight="1200" d:DesignWidth="1400"
             d:DataContext="{d:DesignInstance Type=vm:RightsAnalysisTabViewModel}"
             Loaded="RightsAnalysisTab_Loaded">
    
    <UserControl.Resources>
        <!-- ìœ„í—˜ë„ ìƒ‰ìƒ -->
        <SolidColorBrush x:Key="RiskHighBrush" Color="#EF4444"/>
        <SolidColorBrush x:Key="RiskMediumBrush" Color="#F59E0B"/>
        <SolidColorBrush x:Key="RiskLowBrush" Color="#10B981"/>
        
        <!-- ì„¹ì…˜ ì¹´ë“œ ìŠ¤íƒ€ì¼ -->
        <Style x:Key="SectionCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BackgroundBrush}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- ì„¹ì…˜ í—¤ë” ìŠ¤íƒ€ì¼ -->
        <Style x:Key="SectionHeaderStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BlueGray100Brush}"/>
            <Setter Property="Padding" Value="16,12"/>
        </Style>
        
        <!-- ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ -->
        <Style x:Key="AnalysisCheckBoxStyle" TargetType="CheckBox" BasedOn="{StaticResource {x:Type CheckBox}}">
            <Setter Property="Margin" Value="0,6"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
        
        <!-- í•„ë“œ ë¼ë²¨ ìŠ¤íƒ€ì¼ -->
        <Style x:Key="FieldLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>
        
        <!-- í•„ë“œ ê°’ ìŠ¤íƒ€ì¼ -->
        <Style x:Key="FieldValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="FontWeight" Value="Medium"/>
        </Style>
    </UserControl.Resources>
    
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <Grid Margin="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="24"/>
                <ColumnDefinition Width="380"/>
            </Grid.ColumnDefinitions>
            
            <!-- ========== ì¢Œì¸¡: ë©”ì¸ ì»¨í…ì¸  ========== -->
            <StackPanel Grid.Column="0">
                
                <!-- ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€ -->
                <Border Background="{StaticResource ErrorBrush}"
                        CornerRadius="4"
                        Padding="12"
                        Margin="0,0,0,16"
                        Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock Text="{Binding ErrorMessage}" 
                               Foreground="White"
                               TextWrapping="Wrap"/>
                </Border>

                <Border Background="{StaticResource SuccessBrush}"
                        CornerRadius="4"
                        Padding="12"
                        Margin="0,0,0,16"
                        Visibility="{Binding SuccessMessage, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock Text="{Binding SuccessMessage}" 
                               Foreground="White"
                               TextWrapping="Wrap"/>
                </Border>
                
                <!-- ===== 1. ê²½ë§¤ì‚¬ê±´ ì •ë³´ ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Border Style="{StaticResource SectionHeaderStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ“Š" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="ê²½ë§¤ì‚¬ê±´ ì •ë³´" Style="{StaticResource H4TextStyle}"/>
                                </StackPanel>
                                <Button Grid.Column="1" 
                                        Content="ê²½ë§¤ì‚¬ê±´ê²€ìƒ‰" 
                                        Command="{Binding OpenAuctionSearchCommand}"
                                        Style="{StaticResource SecondaryButton}"
                                        Padding="12,4"
                                        FontSize="12"/>
                            </Grid>
                        </Border>
                        
                        <Grid Margin="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Row 1: ê²½ë§¤ê°œì‹œì—¬ë¶€, ì„ í–‰/í›„í–‰ -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,16,16">
                                <TextBlock Text="ê²½ë§¤ê°œì‹œì—¬ë¶€" Style="{StaticResource FieldLabelStyle}"/>
                                <ComboBox SelectedValue="{Binding Analysis.AuctionStatus, Mode=TwoWay}"
                                          SelectedValuePath="Tag"
                                          Width="140">
                                    <ComboBoxItem Content="ê²½ë§¤ê°œì‹œ" Tag="opened"/>
                                    <ComboBoxItem Content="ê²½ë§¤ë¯¸ê°œì‹œ" Tag="not_opened"/>
                                </ComboBox>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,16,16">
                                <TextBlock Text="ì„ í–‰/í›„í–‰" Style="{StaticResource FieldLabelStyle}"/>
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox Content="ì„ í–‰" 
                                              IsChecked="{Binding Analysis.PrecedentAuction}"
                                              Style="{StaticResource AnalysisCheckBoxStyle}"
                                              Margin="0,0,16,0"/>
                                    <CheckBox Content="í›„í–‰" 
                                              IsChecked="{Binding Analysis.SubsequentAuction}"
                                              Style="{StaticResource AnalysisCheckBoxStyle}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,16,16">
                                <TextBlock Text="ê´€í• ë²•ì›" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.CourtName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="0" Grid.Column="3" Margin="0,0,0,16">
                                <TextBlock Text="ê²½ë§¤ì‚¬ê±´ë²ˆí˜¸" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.CaseNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <!-- Row 2: ê²½ë§¤ì‹ ì²­ê¸°ê´€, ê²½ë§¤ê°œì‹œì¼ìž, ë°°ë‹¹ìš”êµ¬ì¢…ê¸°ì¼, ì²­êµ¬ê¸ˆì•¡ -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,16,16">
                                <TextBlock Text="ê²½ë§¤ì‹ ì²­ê¸°ê´€" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.AuctionApplicant, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,0,16,16">
                                <TextBlock Text="ê²½ë§¤ê°œì‹œì¼ìž" Style="{StaticResource FieldLabelStyle}"/>
                                <DatePicker SelectedDate="{Binding Analysis.AuctionStartDate, Mode=TwoWay}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,0,16,16">
                                <TextBlock Text="ë°°ë‹¹ìš”êµ¬ì¢…ê¸°ì¼" Style="{StaticResource FieldLabelStyle}"/>
                                <DatePicker SelectedDate="{Binding Analysis.ClaimDeadlineDate, Mode=TwoWay}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Grid.Column="3" Margin="0,0,0,16">
                                <TextBlock Text="ì²­êµ¬ê¸ˆì•¡" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.ClaimAmount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <!-- Row 3: ìµœì´ˆë²•ì‚¬ê°€, ìµœì´ˆê²½ë§¤ê¸°ì¼, ìµœì¢…íšŒì°¨, ìµœì¢…ê²½ë§¤ê¸°ì¼ -->
                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,16,16">
                                <TextBlock Text="ìµœì´ˆë²•ì‚¬ê°€ (ê°ì •ê°€)" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.InitialAppraisalValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Grid.Column="1" Margin="0,0,16,16">
                                <TextBlock Text="ìµœì´ˆê²½ë§¤ê¸°ì¼" Style="{StaticResource FieldLabelStyle}"/>
                                <DatePicker SelectedDate="{Binding Analysis.InitialAuctionDate, Mode=TwoWay}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Grid.Column="2" Margin="0,0,16,16">
                                <TextBlock Text="ìµœì¢…ê²½ë§¤íšŒì°¨" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.FinalAuctionRound, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Grid.Column="3" Margin="0,0,0,16">
                                <TextBlock Text="ìµœì¢…ê²½ë§¤ê²°ê³¼" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.FinalAuctionResult, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <!-- Row 4: ë‚™ì°°ê¸ˆì•¡, ì°¨í›„ì˜ˆì •ì¼, ì°¨í›„ìµœì €ìž…ì°°ê°€, ë°°ë‹¹ìš”êµ¬ì¢…ê¸°ê²½ê³¼ -->
                            <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,0,16,0">
                                <TextBlock Text="ë‚™ì°°ê¸ˆì•¡" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.WinningBidAmount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="1" Margin="0,0,16,0">
                                <TextBlock Text="ì°¨í›„ì˜ˆì •ê²½ë§¤ì¼" Style="{StaticResource FieldLabelStyle}"/>
                                <DatePicker SelectedDate="{Binding Analysis.NextAuctionDate, Mode=TwoWay}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="2" Margin="0,0,16,0">
                                <TextBlock Text="ì°¨í›„ìµœì €ìž…ì°°ê°€" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.NextMinimumBid, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="3" Margin="0,0,0,0">
                                <TextBlock Text="ë°°ë‹¹ìš”êµ¬ì¢…ê¸°ì¼ ê²½ê³¼" Style="{StaticResource FieldLabelStyle}"/>
                                <CheckBox IsChecked="{Binding Analysis.ClaimDeadlinePassed}"
                                          Content="ê²½ê³¼"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
                
                <!-- ===== 2. ì „ìž…/ìž„ì°¨ í˜„í™© ì²´í¬ë¦¬ìŠ¤íŠ¸ ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Border Style="{StaticResource SectionHeaderStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ " FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="ì „ìž…/ìž„ì°¨ í˜„í™©" Style="{StaticResource H4TextStyle}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button Content="ì£¼íƒê³µì‹œê°€ê²© ì¡°íšŒ" 
                                            Command="{Binding OpenHousingPriceCommand}"
                                            Style="{StaticResource SecondaryButton}"
                                            Padding="12,4"
                                            FontSize="12"
                                            Margin="0,0,8,0"/>
                                    <Button Content="ê³µì‹œì§€ê°€ ì¡°íšŒ" 
                                            Command="{Binding OpenLandPriceCommand}"
                                            Style="{StaticResource SecondaryButton}"
                                            Padding="12,4"
                                            FontSize="12"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                        
                        <Grid Margin="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Row 1 -->
                            <CheckBox Grid.Row="0" Grid.Column="0" 
                                      Content="ë¬¼ê±´ì§€, ì†Œìœ ì£¼ ì£¼ì†Œì§€ ì¼ì¹˜" 
                                      IsChecked="{Binding Analysis.AddressMatch}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="0" Grid.Column="1" 
                                      Content="ì†Œìœ ì£¼ ì „ìž…" 
                                      IsChecked="{Binding Analysis.OwnerRegistered}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="0" Grid.Column="2" 
                                      Content="ìž„ì°¨ì¸ ì¡´ìž¬" 
                                      IsChecked="{Binding Analysis.HasTenant}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            
                            <!-- Row 2 -->
                            <CheckBox Grid.Row="1" Grid.Column="0" 
                                      Content="í˜„í™©ì¡°ì‚¬ì„œ ì œì¶œ" 
                                      IsChecked="{Binding Analysis.SurveyReportSubmitted}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="1" Grid.Column="1" 
                                      Content="ì „ìž…ì„¸ëŒ€ì—´ëžŒ ë³´ìœ " 
                                      IsChecked="{Binding Analysis.HasTenantRegistry}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="1" Grid.Column="2" 
                                      Content="ìƒê°€ìž„ëŒ€ì°¨ì—´ëžŒ ë³´ìœ " 
                                      IsChecked="{Binding Analysis.HasCommercialLease}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            
                            <!-- Row 3 -->
                            <CheckBox Grid.Row="2" Grid.Column="0" 
                                      Content="ìž„ì°¨ì¸ ë°°ë‹¹ìš”êµ¬ì‹ ì²­" 
                                      IsChecked="{Binding Analysis.TenantClaimSubmitted}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="2" Grid.Column="1" 
                                      Content="ìž„ì°¨ì¼ ê·¼ì €ë‹¹ì„¤ì •ì¼ ì´ì „" 
                                      IsChecked="{Binding Analysis.TenantDateBeforeMortgage}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="2" Grid.Column="2" 
                                      Content="ê²½ë§¤ì—´ëžŒìžë£Œ ë³´ìœ " 
                                      IsChecked="{Binding Analysis.HasAuctionDocs}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            
                            <!-- Row 4: ìž„ì°¨ì¸ ì •ë³´ -->
                            <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,12,16,0">
                                <TextBlock Text="ì „ìž…ì¸(ìž„ì°¨ì¸)" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.TenantName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="1" Margin="0,12,16,0">
                                <TextBlock Text="ì „ìž…ì¼(ìž„ì°¨ì‹œìž‘ì¼)" Style="{StaticResource FieldLabelStyle}"/>
                                <DatePicker SelectedDate="{Binding Analysis.TenantMoveInDate, Mode=TwoWay}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="2" Margin="0,12,0,0">
                                <TextBlock Text="ì£¼íƒê³µì‹œê°€ê²©" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.HousingOfficialPrice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                        </Grid>
                        
                        <!-- ì±„ë¬´ìž ìœ í˜• & ìž„ê¸ˆì±„ê¶Œ/ì¡°ì„¸ -->
                        <Border BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,1,0,0">
                            <Grid Margin="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,16,12">
                                    <TextBlock Text="ì±„ë¬´ìž ìœ í˜•" Style="{StaticResource FieldLabelStyle}"/>
                                    <ComboBox SelectedValue="{Binding Analysis.DebtorType, Mode=TwoWay}"
                                              SelectedValuePath="Tag">
                                        <ComboBoxItem Content="ê°œì¸" Tag="individual"/>
                                        <ComboBoxItem Content="ê°œì¸ì‚¬ì—…ìž" Tag="business"/>
                                        <ComboBoxItem Content="ë²•ì¸" Tag="corporation"/>
                                    </ComboBox>
                                </StackPanel>
                                
                                <CheckBox Grid.Row="0" Grid.Column="1" 
                                          Content="ìž„ê¸ˆì±„ê¶Œ ì¡´ìž¬" 
                                          IsChecked="{Binding Analysis.HasWageClaim}"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                                <CheckBox Grid.Row="0" Grid.Column="2" 
                                          Content="ìž„ê¸ˆì±„ê¶Œ ë°°ë‹¹ìš”êµ¬ì‹ ì²­" 
                                          IsChecked="{Binding Analysis.WageClaimSubmitted}"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                                
                                <CheckBox Grid.Row="1" Grid.Column="0" 
                                          Content="ìž„ê¸ˆì±„ê¶Œ ì¶”ì •ê°€ì••ë¥˜" 
                                          IsChecked="{Binding Analysis.WageClaimEstimatedSeizure}"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                                <CheckBox Grid.Row="1" Grid.Column="1" 
                                          Content="ë‹¹í•´ì„¸ êµë¶€ì²­êµ¬" 
                                          IsChecked="{Binding Analysis.HasTaxClaim}"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                                <CheckBox Grid.Row="1" Grid.Column="2" 
                                          Content="ì„ ìˆœìœ„ì¡°ì„¸ êµë¶€ì²­êµ¬" 
                                          IsChecked="{Binding Analysis.HasSeniorTaxClaim}"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>
                
                <!-- ===== 3. ì„ ìˆœìœ„ ë¶„ì„ ê·¸ë¦¬ë“œ ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Border Style="{StaticResource SectionHeaderStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ“‹" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="ì„ ìˆœìœ„ ë¶„ì„" Style="{StaticResource H4TextStyle}"/>
                                </StackPanel>
                                <Button Grid.Column="1" 
                                        Content="ðŸ’¡ íŒë‹¨ ë¡œì§ ë³´ê¸°" 
                                        Command="{Binding ShowRuleLogicCommand}"
                                        Style="{StaticResource SecondaryButton}"
                                        Padding="12,4"
                                        FontSize="12"/>
                            </Grid>
                        </Border>
                        
                        <DataGrid Margin="16"
                                  ItemsSource="{Binding SeniorRightsItems}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="All"
                          HorizontalGridLinesBrush="{StaticResource TableBorderBrush}"
                          VerticalGridLinesBrush="{StaticResource TableBorderBrush}"
                                  BorderThickness="1"
                                  BorderBrush="{StaticResource BlueGray200Brush}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ì„ ìˆœìœ„ êµ¬ë¶„" 
                                                    Binding="{Binding Category}" 
                                                    Width="150"
                                                    IsReadOnly="True"/>
                                <DataGridTextColumn Header="DD ê¸ˆì•¡" 
                                                    Binding="{Binding DdAmount, StringFormat=N0}" 
                                                    Width="120">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Right"/>
                                            <Setter Property="Padding" Value="8,0"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="í‰ê°€ìž ë°˜ì˜ê¸ˆì•¡" 
                                                    Binding="{Binding ReflectedAmount, StringFormat=N0}" 
                                                    Width="130">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Right"/>
                                            <Setter Property="Padding" Value="8,0"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="ìƒì„¸ì¶”ì • ê·¼ê±°" 
                                                    Binding="{Binding Reason}" 
                                                    Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextWrapping" Value="Wrap"/>
                                            <Setter Property="Padding" Value="8,4"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                        
                        <!-- í•©ê³„ -->
                        <Border Background="{StaticResource BlueGray50Brush}" 
                                Margin="16,0,16,16" 
                                Padding="16,12"
                                CornerRadius="4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="í•©ê³„" 
                                           FontWeight="Bold" 
                                           FontSize="14"/>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding TotalDdAmount, StringFormat=N0}" 
                                           HorizontalAlignment="Right"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           Margin="0,0,16,0"/>
                                <TextBlock Grid.Column="2" 
                                           Text="{Binding TotalReflectedAmount, StringFormat=N0}" 
                                           FontWeight="Bold"
                                           FontSize="16"
                                           Foreground="{StaticResource PrimaryBrush}"/>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>
                
                <!-- ===== ì €ìž¥/ì•¡ì…˜ ë²„íŠ¼ ===== -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                    <Button Content="ìžë™ ê³„ì‚°" 
                            Command="{Binding AutoCalculateCommand}"
                            Style="{StaticResource SecondaryButton}"
                            Padding="24,10"
                            Margin="0,0,8,0"/>
                    <Button Content="ì €ìž¥" 
                            Command="{Binding SaveCommand}"
                            Style="{StaticResource PrimaryButton}"
                            Padding="24,10"/>
                </StackPanel>
                
            </StackPanel>
            
            <!-- ========== ìš°ì¸¡: ë°°ë‹¹ ì‹œë®¬ë ˆì´ì…˜ & ìœ„í—˜ë„ ========== -->
            <StackPanel Grid.Column="2">
                
                <!-- ===== ë°°ë‹¹ ì‹œë®¬ë ˆì´ì…˜ ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Border Style="{StaticResource SectionHeaderStyle}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ’°" FontSize="16" Margin="0,0,8,0"/>
                                <TextBlock Text="ë°°ë‹¹ ì‹œë®¬ë ˆì´ì…˜" Style="{StaticResource H4TextStyle}"/>
                            </StackPanel>
                        </Border>
                        
                        <StackPanel Margin="16">
                            <!-- ì˜ˆìƒë‚™ì°°ê°€ -->
                            <Border Background="{StaticResource BlueGray50Brush}" 
                                    CornerRadius="4" 
                                    Padding="12" 
                                    Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="ì˜ˆìƒë‚™ì°°ê°€" 
                                               FontSize="12" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                    <TextBox Text="{Binding Analysis.ExpectedWinningBid, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                             FontSize="20"
                                             FontWeight="Bold"
                                             BorderThickness="0"
                                             Background="Transparent"
                                             Margin="0,4,0,0"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- ê³„ì‚° ë‹¨ê³„ -->
                            <StackPanel Margin="0,0,0,8">
                                <Grid Margin="0,4">
                                    <TextBlock Text="(-) ê²½ë§¤ìˆ˜ìˆ˜ë£Œ" Style="{StaticResource FieldLabelStyle}"/>
                                    <TextBlock Text="{Binding Analysis.AuctionFees, StringFormat=N0}" 
                                               HorizontalAlignment="Right"
                                               Style="{StaticResource FieldValueStyle}"/>
                                </Grid>
                                <Grid Margin="0,4">
                                    <TextBlock Text="= ë°°ë‹¹ê°€ëŠ¥ìž¬ì›" Style="{StaticResource FieldLabelStyle}"/>
                                    <TextBlock Text="{Binding Analysis.DistributableAmount, StringFormat=N0}" 
                                               HorizontalAlignment="Right"
                                               Style="{StaticResource FieldValueStyle}"/>
                                </Grid>
                                <Grid Margin="0,4">
                                    <TextBlock Text="(-) ì„ ìˆœìœ„ í•©ê³„" Style="{StaticResource FieldLabelStyle}"/>
                                    <TextBlock Text="{Binding TotalReflectedAmount, StringFormat=N0}" 
                                               HorizontalAlignment="Right"
                                               Style="{StaticResource FieldValueStyle}"
                                               Foreground="{StaticResource ErrorBrush}"/>
                                </Grid>
                            </StackPanel>
                            
                            <Border BorderBrush="{StaticResource BlueGray200Brush}" 
                                    BorderThickness="0,1,0,0" 
                                    Padding="0,12,0,0"
                                    Margin="0,8,0,0">
                                <StackPanel>
                                    <Grid Margin="0,4">
                                        <TextBlock Text="= ì„ ìˆœìœ„ ê³µì œ í›„" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Analysis.AmountAfterSenior, StringFormat=N0}" 
                                                   HorizontalAlignment="Right"
                                                   FontWeight="Bold"
                                                   FontSize="16"/>
                                    </Grid>
                                    
                                    <Grid Margin="0,8">
                                        <TextBlock Text="Loan Cap" Style="{StaticResource FieldLabelStyle}"/>
                                        <TextBox Text="{Binding Analysis.LoanCap, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                                 HorizontalAlignment="Right"
                                                 Width="120"
                                                 TextAlignment="Right"/>
                                    </Grid>
                                    
                                    <Border Background="{StaticResource SuccessLightBrush}" 
                                            CornerRadius="4" 
                                            Padding="12" 
                                            Margin="0,8,0,0">
                                        <StackPanel>
                                            <TextBlock Text="Cap ë°˜ì˜ ë°°ë‹¹ì•¡" 
                                                       FontSize="12" 
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                            <TextBlock Text="{Binding Analysis.CapAppliedDividend, StringFormat=N0}" 
                                                       FontSize="24"
                                                       FontWeight="Bold"
                                                       Foreground="{StaticResource SuccessBrush}"
                                                       Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Border>
                            
                            <!-- íšŒìˆ˜ìœ¨ -->
                            <Border Background="{StaticResource PrimaryLightBrush}" 
                                    CornerRadius="4" 
                                    Padding="12" 
                                    Margin="0,12,0,0">
                                <Grid>
                                    <TextBlock Text="ì˜ˆìƒ íšŒìˆ˜ìœ¨" 
                                               FontSize="14" 
                                               FontWeight="SemiBold"/>
                                    <TextBlock HorizontalAlignment="Right">
                                        <Run Text="{Binding Analysis.RecoveryRate, StringFormat=N1}" 
                                             FontSize="28"
                                             FontWeight="Bold"
                                             Foreground="{StaticResource PrimaryBrush}"/>
                                        <Run Text="%" 
                                             FontSize="16"
                                             Foreground="{StaticResource PrimaryBrush}"/>
                                    </TextBlock>
                                </Grid>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- ===== ìœ„í—˜ë„ í‰ê°€ ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Border Style="{StaticResource SectionHeaderStyle}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="âš ï¸" FontSize="16" Margin="0,0,8,0"/>
                                <TextBlock Text="ìœ„í—˜ë„ í‰ê°€" Style="{StaticResource H4TextStyle}"/>
                            </StackPanel>
                        </Border>
                        
                        <StackPanel Margin="16">
                            <!-- ìœ„í—˜ë„ ë ˆë²¨ -->
                            <Border x:Name="RiskLevelBorder"
                                    CornerRadius="8" 
                                    Padding="16" 
                                    Margin="0,0,0,16">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="{StaticResource BlueGray100Brush}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="high">
                                                <Setter Property="Background" Value="#FEE2E2"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="medium">
                                                <Setter Property="Background" Value="#FEF3C7"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="low">
                                                <Setter Property="Background" Value="#D1FAE5"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <StackPanel HorizontalAlignment="Center">
                                    <TextBlock x:Name="RiskIcon" 
                                               FontSize="32" 
                                               HorizontalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="â“"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="high">
                                                        <Setter Property="Text" Value="ðŸ”´"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="medium">
                                                        <Setter Property="Text" Value="ðŸŸ¡"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="low">
                                                        <Setter Property="Text" Value="ðŸŸ¢"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBlock FontSize="18" 
                                               FontWeight="Bold" 
                                               HorizontalAlignment="Center"
                                               Margin="0,8,0,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="ë¯¸í‰ê°€"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="high">
                                                        <Setter Property="Text" Value="ìœ„í—˜ë„ ë†’ìŒ"/>
                                                        <Setter Property="Foreground" Value="{StaticResource ErrorBrush}"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="medium">
                                                        <Setter Property="Text" Value="ìœ„í—˜ë„ ì¤‘ê°„"/>
                                                        <Setter Property="Foreground" Value="{StaticResource WarningBrush}"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="low">
                                                        <Setter Property="Text" Value="ìœ„í—˜ë„ ë‚®ìŒ"/>
                                                        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                            
                            <!-- ìœ„í—˜ë„ ì„ íƒ -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="ìœ„í—˜ë„ ìˆ˜ë™ ì„¤ì •" Style="{StaticResource FieldLabelStyle}"/>
                                <ComboBox SelectedValue="{Binding Analysis.RiskLevel, Mode=TwoWay}"
                                          SelectedValuePath="Tag">
                                    <ComboBoxItem Content="ðŸ”´ ë†’ìŒ (High)" Tag="high"/>
                                    <ComboBoxItem Content="ðŸŸ¡ ì¤‘ê°„ (Medium)" Tag="medium"/>
                                    <ComboBoxItem Content="ðŸŸ¢ ë‚®ìŒ (Low)" Tag="low"/>
                                </ComboBox>
                            </StackPanel>
                            
                            <!-- ìœ„í—˜ë„ íŒë‹¨ ê·¼ê±° -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="ìœ„í—˜ë„ íŒë‹¨ ê·¼ê±°" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.RiskReason, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="60"
                                         VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>
                            
                            <!-- ê¶Œìž¥ ì˜ê²¬ -->
                            <StackPanel>
                                <TextBlock Text="ê¶Œìž¥ ì˜ê²¬" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.Recommendations, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="80"
                                         VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- ===== ë¶„ì„ ì™„ë£Œ ì²´í¬ ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <Grid Margin="16">
                        <CheckBox Content="ê¶Œë¦¬ë¶„ì„ ì™„ë£Œ" 
                                  IsChecked="{Binding Analysis.IsCompleted}"
                                  FontSize="14"
                                  FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding Analysis.AnalyzedAt, StringFormat='yyyy-MM-dd HH:mm'}" 
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Center"
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Visibility="{Binding Analysis.AnalyzedAt, Converter={StaticResource NullToVisibilityConverter}}"/>
                    </Grid>
                </Border>
                
            </StackPanel>
        </Grid>
    </ScrollViewer>
</UserControl>

