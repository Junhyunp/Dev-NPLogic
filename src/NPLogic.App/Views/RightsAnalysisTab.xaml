<UserControl x:Class="NPLogic.Views.RightsAnalysisTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:NPLogic.ViewModels"
             xmlns:controls="clr-namespace:NPLogic.Controls;assembly=NPLogic.UI"
             mc:Ignorable="d" 
             d:DesignHeight="1200" d:DesignWidth="1400"
             d:DataContext="{d:DesignInstance Type=vm:RightsAnalysisTabViewModel}"
             Loaded="RightsAnalysisTab_Loaded">
    
    <UserControl.Resources>
        <!-- ÏúÑÌóòÎèÑ ÏÉâÏÉÅ -->
        <SolidColorBrush x:Key="RiskHighBrush" Color="#EF4444"/>
        <SolidColorBrush x:Key="RiskMediumBrush" Color="#F59E0B"/>
        <SolidColorBrush x:Key="RiskLowBrush" Color="#10B981"/>
        
        <!-- ÏÑπÏÖò Ïπ¥Îìú Ïä§ÌÉÄÏùº -->
        <Style x:Key="SectionCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BackgroundBrush}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- ÏÑπÏÖò Ìó§Îçî Ïä§ÌÉÄÏùº -->
        <Style x:Key="SectionHeaderStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BlueGray100Brush}"/>
            <Setter Property="Padding" Value="16,12"/>
        </Style>
        
        <!-- Ï≤¥ÌÅ¨Î∞ïÏä§ Ïä§ÌÉÄÏùº -->
        <Style x:Key="AnalysisCheckBoxStyle" TargetType="CheckBox" BasedOn="{StaticResource {x:Type CheckBox}}">
            <Setter Property="Margin" Value="0,6"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
        
        <!-- ÌïÑÎìú ÎùºÎ≤® Ïä§ÌÉÄÏùº -->
        <Style x:Key="FieldLabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>
        
        <!-- ÌïÑÎìú Í∞í Ïä§ÌÉÄÏùº -->
        <Style x:Key="FieldValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="FontWeight" Value="Medium"/>
        </Style>
    </UserControl.Resources>
    
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <Grid Margin="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="24"/>
                <ColumnDefinition Width="380"/>
            </Grid.ColumnDefinitions>
            
            <!-- ========== Ï¢åÏ∏°: Î©îÏù∏ Ïª®ÌÖêÏ∏† ========== -->
            <StackPanel Grid.Column="0">
                
                <!-- ÏóêÎü¨/ÏÑ±Í≥µ Î©îÏãúÏßÄ -->
                <Border Background="{StaticResource ErrorBrush}"
                        CornerRadius="4"
                        Padding="12"
                        Margin="0,0,0,16"
                        Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock Text="{Binding ErrorMessage}" 
                               Foreground="White"
                               TextWrapping="Wrap"/>
                </Border>

                <Border Background="{StaticResource SuccessBrush}"
                        CornerRadius="4"
                        Padding="12"
                        Margin="0,0,0,16"
                        Visibility="{Binding SuccessMessage, Converter={StaticResource NullToVisibilityConverter}}">
                    <TextBlock Text="{Binding SuccessMessage}" 
                               Foreground="White"
                               TextWrapping="Wrap"/>
                </Border>
                
                <!-- ===== 1. Í≤ΩÎß§ÏÇ¨Í±¥ Ï†ïÎ≥¥ ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Border Style="{StaticResource SectionHeaderStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="üìä" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="Í≤ΩÎß§ÏÇ¨Í±¥ Ï†ïÎ≥¥" Style="{StaticResource H4TextStyle}"/>
                                </StackPanel>
                                <Button Grid.Column="1" 
                                        Content="Í≤ΩÎß§ÏÇ¨Í±¥Í≤ÄÏÉâ" 
                                        Command="{Binding OpenAuctionSearchCommand}"
                                        Style="{StaticResource SecondaryButton}"
                                        Padding="12,4"
                                        FontSize="12"/>
                            </Grid>
                        </Border>
                        
                        <Grid Margin="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Row 1: Í≤ΩÎß§Í∞úÏãúÏó¨Î∂Ä, ÏÑ†Ìñâ/ÌõÑÌñâ -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,16,16">
                                <TextBlock Text="Í≤ΩÎß§Í∞úÏãúÏó¨Î∂Ä" Style="{StaticResource FieldLabelStyle}"/>
                                <ComboBox SelectedValue="{Binding Analysis.AuctionStatus, Mode=TwoWay}"
                                          SelectedValuePath="Tag"
                                          Width="140">
                                    <ComboBoxItem Content="Í≤ΩÎß§Í∞úÏãú" Tag="opened"/>
                                    <ComboBoxItem Content="Í≤ΩÎß§ÎØ∏Í∞úÏãú" Tag="not_opened"/>
                                </ComboBox>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,16,16">
                                <TextBlock Text="ÏÑ†Ìñâ/ÌõÑÌñâ" Style="{StaticResource FieldLabelStyle}"/>
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox Content="ÏÑ†Ìñâ" 
                                              IsChecked="{Binding Analysis.PrecedentAuction}"
                                              Style="{StaticResource AnalysisCheckBoxStyle}"
                                              Margin="0,0,16,0"/>
                                    <CheckBox Content="ÌõÑÌñâ" 
                                              IsChecked="{Binding Analysis.SubsequentAuction}"
                                              Style="{StaticResource AnalysisCheckBoxStyle}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,16,16">
                                <TextBlock Text="Í¥ÄÌï†Î≤ïÏõê" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.CourtName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="0" Grid.Column="3" Margin="0,0,0,16">
                                <TextBlock Text="Í≤ΩÎß§ÏÇ¨Í±¥Î≤àÌò∏" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.CaseNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <!-- Row 2: Í≤ΩÎß§Ïã†Ï≤≠Í∏∞Í¥Ä, Í≤ΩÎß§Í∞úÏãúÏùºÏûê, Î∞∞ÎãπÏöîÍµ¨Ï¢ÖÍ∏∞Ïùº, Ï≤≠Íµ¨Í∏àÏï° -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,16,16">
                                <TextBlock Text="Í≤ΩÎß§Ïã†Ï≤≠Í∏∞Í¥Ä" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.AuctionApplicant, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,0,16,16">
                                <TextBlock Text="Í≤ΩÎß§Í∞úÏãúÏùºÏûê" Style="{StaticResource FieldLabelStyle}"/>
                                <DatePicker SelectedDate="{Binding Analysis.AuctionStartDate, Mode=TwoWay}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,0,16,16">
                                <TextBlock Text="Î∞∞ÎãπÏöîÍµ¨Ï¢ÖÍ∏∞Ïùº" Style="{StaticResource FieldLabelStyle}"/>
                                <DatePicker SelectedDate="{Binding Analysis.ClaimDeadlineDate, Mode=TwoWay}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Grid.Column="3" Margin="0,0,0,16">
                                <TextBlock Text="Ï≤≠Íµ¨Í∏àÏï°" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.ClaimAmount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <!-- Row 3: ÏµúÏ¥àÎ≤ïÏÇ¨Í∞Ä, ÏµúÏ¥àÍ≤ΩÎß§Í∏∞Ïùº, ÏµúÏ¢ÖÌöåÏ∞®, ÏµúÏ¢ÖÍ≤ΩÎß§Í∏∞Ïùº -->
                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,16,16">
                                <TextBlock Text="ÏµúÏ¥àÎ≤ïÏÇ¨Í∞Ä (Í∞êÏ†ïÍ∞Ä)" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.InitialAppraisalValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Grid.Column="1" Margin="0,0,16,16">
                                <TextBlock Text="ÏµúÏ¥àÍ≤ΩÎß§Í∏∞Ïùº" Style="{StaticResource FieldLabelStyle}"/>
                                <DatePicker SelectedDate="{Binding Analysis.InitialAuctionDate, Mode=TwoWay}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Grid.Column="2" Margin="0,0,16,16">
                                <TextBlock Text="ÏµúÏ¢ÖÍ≤ΩÎß§ÌöåÏ∞®" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.FinalAuctionRound, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Grid.Column="3" Margin="0,0,0,16">
                                <TextBlock Text="ÏµúÏ¢ÖÍ≤ΩÎß§Í≤∞Í≥º" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.FinalAuctionResult, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <!-- Row 4: ÎÇôÏ∞∞Í∏àÏï°, Ï∞®ÌõÑÏòàÏ†ïÏùº, Ï∞®ÌõÑÏµúÏ†ÄÏûÖÏ∞∞Í∞Ä, Î∞∞ÎãπÏöîÍµ¨Ï¢ÖÍ∏∞Í≤ΩÍ≥º -->
                            <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,0,16,0">
                                <TextBlock Text="ÎÇôÏ∞∞Í∏àÏï°" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.WinningBidAmount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="1" Margin="0,0,16,0">
                                <TextBlock Text="Ï∞®ÌõÑÏòàÏ†ïÍ≤ΩÎß§Ïùº" Style="{StaticResource FieldLabelStyle}"/>
                                <DatePicker SelectedDate="{Binding Analysis.NextAuctionDate, Mode=TwoWay}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="2" Margin="0,0,16,0">
                                <TextBlock Text="Ï∞®ÌõÑÏµúÏ†ÄÏûÖÏ∞∞Í∞Ä" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.NextMinimumBid, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="3" Margin="0,0,0,0">
                                <TextBlock Text="Î∞∞ÎãπÏöîÍµ¨Ï¢ÖÍ∏∞Ïùº Í≤ΩÍ≥º" Style="{StaticResource FieldLabelStyle}"/>
                                <CheckBox IsChecked="{Binding Analysis.ClaimDeadlinePassed}"
                                          Content="Í≤ΩÍ≥º"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
                
                <!-- ===== 2. Ï†ÑÏûÖ/ÏûÑÏ∞® ÌòÑÌô© Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Border Style="{StaticResource SectionHeaderStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="üè†" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="Ï†ÑÏûÖ/ÏûÑÏ∞® ÌòÑÌô©" Style="{StaticResource H4TextStyle}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button Content="Ï£ºÌÉùÍ≥µÏãúÍ∞ÄÍ≤© Ï°∞Ìöå" 
                                            Command="{Binding OpenHousingPriceCommand}"
                                            Style="{StaticResource SecondaryButton}"
                                            Padding="12,4"
                                            FontSize="12"
                                            Margin="0,0,8,0"/>
                                    <Button Content="Í≥µÏãúÏßÄÍ∞Ä Ï°∞Ìöå" 
                                            Command="{Binding OpenLandPriceCommand}"
                                            Style="{StaticResource SecondaryButton}"
                                            Padding="12,4"
                                            FontSize="12"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                        
                        <Grid Margin="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Row 1 -->
                            <CheckBox Grid.Row="0" Grid.Column="0" 
                                      Content="Î¨ºÍ±¥ÏßÄ, ÏÜåÏú†Ï£º Ï£ºÏÜåÏßÄ ÏùºÏπò" 
                                      IsChecked="{Binding Analysis.AddressMatch}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="0" Grid.Column="1" 
                                      Content="ÏÜåÏú†Ï£º Ï†ÑÏûÖ" 
                                      IsChecked="{Binding Analysis.OwnerRegistered}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="0" Grid.Column="2" 
                                      Content="ÏûÑÏ∞®Ïù∏ Ï°¥Ïû¨" 
                                      IsChecked="{Binding Analysis.HasTenant}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            
                            <!-- Row 2 -->
                            <CheckBox Grid.Row="1" Grid.Column="0" 
                                      Content="ÌòÑÌô©Ï°∞ÏÇ¨ÏÑú Ï†úÏ∂ú" 
                                      IsChecked="{Binding Analysis.SurveyReportSubmitted}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="1" Grid.Column="1" 
                                      Content="Ï†ÑÏûÖÏÑ∏ÎåÄÏó¥Îûå Î≥¥Ïú†" 
                                      IsChecked="{Binding Analysis.HasTenantRegistry}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="1" Grid.Column="2" 
                                      Content="ÏÉÅÍ∞ÄÏûÑÎåÄÏ∞®Ïó¥Îûå Î≥¥Ïú†" 
                                      IsChecked="{Binding Analysis.HasCommercialLease}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            
                            <!-- Row 3 -->
                            <CheckBox Grid.Row="2" Grid.Column="0" 
                                      Content="ÏûÑÏ∞®Ïù∏ Î∞∞ÎãπÏöîÍµ¨Ïã†Ï≤≠" 
                                      IsChecked="{Binding Analysis.TenantClaimSubmitted}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="2" Grid.Column="1" 
                                      Content="ÏûÑÏ∞®Ïùº Í∑ºÏ†ÄÎãπÏÑ§Ï†ïÏùº Ïù¥Ï†Ñ" 
                                      IsChecked="{Binding Analysis.TenantDateBeforeMortgage}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            <CheckBox Grid.Row="2" Grid.Column="2" 
                                      Content="Í≤ΩÎß§Ïó¥ÎûåÏûêÎ£å Î≥¥Ïú†" 
                                      IsChecked="{Binding Analysis.HasAuctionDocs}"
                                      Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            
                            <!-- Row 4: ÏûÑÏ∞®Ïù∏ Ï†ïÎ≥¥ -->
                            <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,12,16,0">
                                <TextBlock Text="Ï†ÑÏûÖÏù∏(ÏûÑÏ∞®Ïù∏)" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.TenantName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="1" Margin="0,12,16,0">
                                <TextBlock Text="Ï†ÑÏûÖÏùº(ÏûÑÏ∞®ÏãúÏûëÏùº)" Style="{StaticResource FieldLabelStyle}"/>
                                <DatePicker SelectedDate="{Binding Analysis.TenantMoveInDate, Mode=TwoWay}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="3" Grid.Column="2" Margin="0,12,0,0">
                                <TextBlock Text="Ï£ºÌÉùÍ≥µÏãúÍ∞ÄÍ≤©" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.HousingOfficialPrice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                         Style="{StaticResource {x:Type TextBox}}"/>
                            </StackPanel>
                        </Grid>
                        
                        <!-- Ï±ÑÎ¨¥Ïûê Ïú†Ìòï & ÏûÑÍ∏àÏ±ÑÍ∂å/Ï°∞ÏÑ∏ -->
                        <Border BorderBrush="{StaticResource BlueGray200Brush}" BorderThickness="0,1,0,0">
                            <Grid Margin="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,16,12">
                                    <TextBlock Text="Ï±ÑÎ¨¥Ïûê Ïú†Ìòï" Style="{StaticResource FieldLabelStyle}"/>
                                    <ComboBox SelectedValue="{Binding Analysis.DebtorType, Mode=TwoWay}"
                                              SelectedValuePath="Tag">
                                        <ComboBoxItem Content="Í∞úÏù∏" Tag="individual"/>
                                        <ComboBoxItem Content="Í∞úÏù∏ÏÇ¨ÏóÖÏûê" Tag="business"/>
                                        <ComboBoxItem Content="Î≤ïÏù∏" Tag="corporation"/>
                                    </ComboBox>
                                </StackPanel>
                                
                                <CheckBox Grid.Row="0" Grid.Column="1" 
                                          Content="ÏûÑÍ∏àÏ±ÑÍ∂å Ï°¥Ïû¨" 
                                          IsChecked="{Binding Analysis.HasWageClaim}"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                                <CheckBox Grid.Row="0" Grid.Column="2" 
                                          Content="ÏûÑÍ∏àÏ±ÑÍ∂å Î∞∞ÎãπÏöîÍµ¨Ïã†Ï≤≠" 
                                          IsChecked="{Binding Analysis.WageClaimSubmitted}"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                                
                                <CheckBox Grid.Row="1" Grid.Column="0" 
                                          Content="ÏûÑÍ∏àÏ±ÑÍ∂å Ï∂îÏ†ïÍ∞ÄÏïïÎ•ò" 
                                          IsChecked="{Binding Analysis.WageClaimEstimatedSeizure}"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                                <CheckBox Grid.Row="1" Grid.Column="1" 
                                          Content="ÎãπÌï¥ÏÑ∏ ÍµêÎ∂ÄÏ≤≠Íµ¨" 
                                          IsChecked="{Binding Analysis.HasTaxClaim}"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                                <CheckBox Grid.Row="1" Grid.Column="2" 
                                          Content="ÏÑ†ÏàúÏúÑÏ°∞ÏÑ∏ ÍµêÎ∂ÄÏ≤≠Íµ¨" 
                                          IsChecked="{Binding Analysis.HasSeniorTaxClaim}"
                                          Style="{StaticResource AnalysisCheckBoxStyle}"/>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>
                
                <!-- ===== 3. ÏÑ†ÏàúÏúÑ Î∂ÑÏÑù Í∑∏Î¶¨Îìú ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Border Style="{StaticResource SectionHeaderStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="üìã" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="ÏÑ†ÏàúÏúÑ Î∂ÑÏÑù" Style="{StaticResource H4TextStyle}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button Content="üìä Í∂åÎ¶¨Î∂ÑÏÑù ÏãúÌä∏ Î≥¥Í∏∞" 
                                            Command="{Binding OpenRightsSheetCommand}"
                                            Style="{StaticResource PrimaryButton}"
                                            Padding="12,4"
                                            FontSize="12"
                                            Margin="0,0,8,0"
                                            ToolTip="Îì±Í∏∞Î∂ÄÎì±Î≥∏ Í∞ëÍµ¨/ÏùÑÍµ¨ Îç∞Ïù¥ÌÑ∞Î•º ÌåùÏóÖ Ï∞ΩÏúºÎ°ú ÌôïÏù∏Ìï©ÎãàÎã§"/>
                                    <Button Content="üí° ÌåêÎã® Î°úÏßÅ Î≥¥Í∏∞" 
                                            Command="{Binding ShowRuleLogicCommand}"
                                            Style="{StaticResource SecondaryButton}"
                                            Padding="12,4"
                                            FontSize="12"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                        
                        <DataGrid Margin="16"
                                  ItemsSource="{Binding SeniorRightsItems}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="All"
                          HorizontalGridLinesBrush="{StaticResource TableBorderBrush}"
                          VerticalGridLinesBrush="{StaticResource TableBorderBrush}"
                                  BorderThickness="1"
                                  BorderBrush="{StaticResource BlueGray200Brush}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ÏÑ†ÏàúÏúÑ Íµ¨Î∂Ñ" 
                                                    Binding="{Binding Category}" 
                                                    Width="150"
                                                    IsReadOnly="True"/>
                                <DataGridTextColumn Header="DD Í∏àÏï°" 
                                                    Binding="{Binding DdAmount, StringFormat=N0}" 
                                                    Width="120">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Right"/>
                                            <Setter Property="Padding" Value="8,0"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="ÌèâÍ∞ÄÏûê Î∞òÏòÅÍ∏àÏï°" 
                                                    Binding="{Binding ReflectedAmount, StringFormat=N0}" 
                                                    Width="130">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Right"/>
                                            <Setter Property="Padding" Value="8,0"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="ÏÉÅÏÑ∏Ï∂îÏ†ï Í∑ºÍ±∞" 
                                                    Binding="{Binding Reason}" 
                                                    Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="TextWrapping" Value="Wrap"/>
                                            <Setter Property="Padding" Value="8,4"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                        
                        <!-- Ìï©Í≥Ñ -->
                        <Border Background="{StaticResource BlueGray50Brush}" 
                                Margin="16,0,16,16" 
                                Padding="16,12"
                                CornerRadius="4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Ìï©Í≥Ñ" 
                                           FontWeight="Bold" 
                                           FontSize="{StaticResource FontSizeH4}"/>
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding TotalDdAmount, StringFormat=N0}" 
                                           HorizontalAlignment="Right"
                                           FontWeight="Bold"
                                           FontSize="{StaticResource FontSizeH4}"
                                           Margin="0,0,16,0"/>
                                <TextBlock Grid.Column="2" 
                                           Text="{Binding TotalReflectedAmount, StringFormat=N0}" 
                                           FontWeight="Bold"
                                           FontSize="16"
                                           Foreground="{StaticResource PrimaryBrush}"/>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>
                
                <!-- ===== Ï†ÄÏû•/Ïï°ÏÖò Î≤ÑÌäº ===== -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                    <Button Content="ÏûêÎèô Í≥ÑÏÇ∞" 
                            Command="{Binding AutoCalculateCommand}"
                            Style="{StaticResource SecondaryButton}"
                            Padding="24,10"
                            Margin="0,0,8,0"/>
                    <Button Content="Ï†ÄÏû•" 
                            Command="{Binding SaveCommand}"
                            Style="{StaticResource PrimaryButton}"
                            Padding="24,10"/>
                </StackPanel>
                
            </StackPanel>
            
            <!-- ========== Ïö∞Ï∏°: Î∞∞Îãπ ÏãúÎÆ¨Î†àÏù¥ÏÖò & ÏúÑÌóòÎèÑ ========== -->
            <StackPanel Grid.Column="2">
                
                <!-- ===== Î∞∞Îãπ ÏãúÎÆ¨Î†àÏù¥ÏÖò ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Border Style="{StaticResource SectionHeaderStyle}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="üí∞" FontSize="16" Margin="0,0,8,0"/>
                                <TextBlock Text="Î∞∞Îãπ ÏãúÎÆ¨Î†àÏù¥ÏÖò" Style="{StaticResource H4TextStyle}"/>
                            </StackPanel>
                        </Border>
                        
                        <StackPanel Margin="16">
                            <!-- ÏòàÏÉÅÎÇôÏ∞∞Í∞Ä -->
                            <Border Background="{StaticResource BlueGray50Brush}" 
                                    CornerRadius="4" 
                                    Padding="12" 
                                    Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="ÏòàÏÉÅÎÇôÏ∞∞Í∞Ä" 
                                               FontSize="12" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                    <TextBox Text="{Binding Analysis.ExpectedWinningBid, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                             FontSize="{StaticResource FontSizeLarge}"
                                             FontWeight="Bold"
                                             BorderThickness="0"
                                             Background="Transparent"
                                             Margin="0,4,0,0"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Í≥ÑÏÇ∞ Îã®Í≥Ñ -->
                            <StackPanel Margin="0,0,0,8">
                                <Grid Margin="0,4">
                                    <TextBlock Text="(-) Í≤ΩÎß§ÏàòÏàòÎ£å" Style="{StaticResource FieldLabelStyle}"/>
                                    <TextBlock Text="{Binding Analysis.AuctionFees, StringFormat=N0}" 
                                               HorizontalAlignment="Right"
                                               Style="{StaticResource FieldValueStyle}"/>
                                </Grid>
                                <Grid Margin="0,4">
                                    <TextBlock Text="= Î∞∞ÎãπÍ∞ÄÎä•Ïû¨Ïõê" Style="{StaticResource FieldLabelStyle}"/>
                                    <TextBlock Text="{Binding Analysis.DistributableAmount, StringFormat=N0}" 
                                               HorizontalAlignment="Right"
                                               Style="{StaticResource FieldValueStyle}"/>
                                </Grid>
                                <Grid Margin="0,4">
                                    <TextBlock Text="(-) ÏÑ†ÏàúÏúÑ Ìï©Í≥Ñ" Style="{StaticResource FieldLabelStyle}"/>
                                    <TextBlock Text="{Binding TotalReflectedAmount, StringFormat=N0}" 
                                               HorizontalAlignment="Right"
                                               Style="{StaticResource FieldValueStyle}"
                                               Foreground="{StaticResource ErrorBrush}"/>
                                </Grid>
                            </StackPanel>
                            
                            <Border BorderBrush="{StaticResource BlueGray200Brush}" 
                                    BorderThickness="0,1,0,0" 
                                    Padding="0,12,0,0"
                                    Margin="0,8,0,0">
                                <StackPanel>
                                    <Grid Margin="0,4">
                                        <TextBlock Text="= ÏÑ†ÏàúÏúÑ Í≥µÏ†ú ÌõÑ" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Analysis.AmountAfterSenior, StringFormat=N0}" 
                                                   HorizontalAlignment="Right"
                                                   FontWeight="Bold"
                                                   FontSize="16"/>
                                    </Grid>
                                    
                                    <Grid Margin="0,8">
                                        <TextBlock Text="Loan Cap" Style="{StaticResource FieldLabelStyle}"/>
                                        <TextBox Text="{Binding Analysis.LoanCap, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"
                                                 HorizontalAlignment="Right"
                                                 Width="120"
                                                 TextAlignment="Right"/>
                                    </Grid>
                                    
                                    <Border Background="{StaticResource SuccessLightBrush}" 
                                            CornerRadius="4" 
                                            Padding="12" 
                                            Margin="0,8,0,0">
                                        <StackPanel>
                                            <TextBlock Text="Cap Î∞òÏòÅ Î∞∞ÎãπÏï°" 
                                                       FontSize="12" 
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                            <TextBlock Text="{Binding Analysis.CapAppliedDividend, StringFormat=N0}" 
                                                       FontSize="{StaticResource FontSizeH1}"
                                                       FontWeight="Bold"
                                                       Foreground="{StaticResource SuccessBrush}"
                                                       Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Border>
                            
                            <!-- ÌöåÏàòÏú® -->
                            <Border Background="{StaticResource PrimaryLightBrush}" 
                                    CornerRadius="4" 
                                    Padding="12" 
                                    Margin="0,12,0,0">
                                <Grid>
                                    <TextBlock Text="ÏòàÏÉÅ ÌöåÏàòÏú®" 
                                               FontSize="{StaticResource FontSizeH4}" 
                                               FontWeight="SemiBold"/>
                                    <TextBlock HorizontalAlignment="Right">
                                        <Run Text="{Binding Analysis.RecoveryRate, StringFormat=N1}" 
                                             FontSize="28"
                                             FontWeight="Bold"
                                             Foreground="{StaticResource PrimaryBrush}"/>
                                        <Run Text="%" 
                                             FontSize="16"
                                             Foreground="{StaticResource PrimaryBrush}"/>
                                    </TextBlock>
                                </Grid>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- ===== ÏúÑÌóòÎèÑ ÌèâÍ∞Ä ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Border Style="{StaticResource SectionHeaderStyle}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="‚ö†Ô∏è" FontSize="16" Margin="0,0,8,0"/>
                                <TextBlock Text="ÏúÑÌóòÎèÑ ÌèâÍ∞Ä" Style="{StaticResource H4TextStyle}"/>
                            </StackPanel>
                        </Border>
                        
                        <StackPanel Margin="16">
                            <!-- ÏúÑÌóòÎèÑ ÌèâÍ∞Ä ÏÑ§Î™Ö -->
                            <Border Background="{StaticResource BlueGray50Brush}" 
                                    CornerRadius="4" 
                                    Padding="10" 
                                    Margin="0,0,0,12">
                                <TextBlock TextWrapping="Wrap" 
                                           FontSize="11" 
                                           Foreground="{StaticResource TextSecondaryBrush}">
                                    <Run FontWeight="SemiBold">ÏúÑÌóòÎèÑ ÌèâÍ∞ÄÎûÄ?</Run>
                                    <LineBreak/>
                                    ÏòàÏÉÅ ÌöåÏàòÏú®ÏùÑ Í∏∞Î∞òÏúºÎ°ú Ìà¨Ïûê ÏúÑÌóòÎèÑÎ•º ÏûêÎèô Î∂ÑÏÑùÌï©ÎãàÎã§.
                                    <LineBreak/>
                                    ‚Ä¢ üü¢ ÎÇÆÏùå: ÌöåÏàòÏú® 80% Ïù¥ÏÉÅ
                                    <LineBreak/>
                                    ‚Ä¢ üü° Ï§ëÍ∞Ñ: ÌöåÏàòÏú® 50~80%
                                    <LineBreak/>
                                    ‚Ä¢ üî¥ ÎÜíÏùå: ÌöåÏàòÏú® 50% ÎØ∏Îßå
                                </TextBlock>
                            </Border>
                            
                            <!-- ÏúÑÌóòÎèÑ Î†àÎ≤® -->
                            <Border x:Name="RiskLevelBorder"
                                    CornerRadius="8" 
                                    Padding="16" 
                                    Margin="0,0,0,16">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="{StaticResource BlueGray100Brush}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="high">
                                                <Setter Property="Background" Value="#FEE2E2"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="medium">
                                                <Setter Property="Background" Value="#FEF3C7"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="low">
                                                <Setter Property="Background" Value="#D1FAE5"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <StackPanel HorizontalAlignment="Center">
                                    <TextBlock x:Name="RiskIcon" 
                                               FontSize="{StaticResource FontSizeXXLarge}" 
                                               HorizontalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="‚ùì"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="high">
                                                        <Setter Property="Text" Value="üî¥"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="medium">
                                                        <Setter Property="Text" Value="üü°"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="low">
                                                        <Setter Property="Text" Value="üü¢"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBlock FontSize="18" 
                                               FontWeight="Bold" 
                                               HorizontalAlignment="Center"
                                               Margin="0,8,0,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="ÎØ∏ÌèâÍ∞Ä"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="high">
                                                        <Setter Property="Text" Value="ÏúÑÌóòÎèÑ ÎÜíÏùå"/>
                                                        <Setter Property="Foreground" Value="{StaticResource ErrorBrush}"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="medium">
                                                        <Setter Property="Text" Value="ÏúÑÌóòÎèÑ Ï§ëÍ∞Ñ"/>
                                                        <Setter Property="Foreground" Value="{StaticResource WarningBrush}"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Analysis.RiskLevel}" Value="low">
                                                        <Setter Property="Text" Value="ÏúÑÌóòÎèÑ ÎÇÆÏùå"/>
                                                        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                            
                            <!-- ÏúÑÌóòÎèÑ ÏÑ†ÌÉù -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="ÏúÑÌóòÎèÑ ÏàòÎèô ÏÑ§Ï†ï" Style="{StaticResource FieldLabelStyle}"/>
                                <ComboBox SelectedValue="{Binding Analysis.RiskLevel, Mode=TwoWay}"
                                          SelectedValuePath="Tag">
                                    <ComboBoxItem Content="üî¥ ÎÜíÏùå (High)" Tag="high"/>
                                    <ComboBoxItem Content="üü° Ï§ëÍ∞Ñ (Medium)" Tag="medium"/>
                                    <ComboBoxItem Content="üü¢ ÎÇÆÏùå (Low)" Tag="low"/>
                                </ComboBox>
                            </StackPanel>
                            
                            <!-- ÏúÑÌóòÎèÑ ÌåêÎã® Í∑ºÍ±∞ -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="ÏúÑÌóòÎèÑ ÌåêÎã® Í∑ºÍ±∞" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.RiskReason, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="60"
                                         VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>
                            
                            <!-- Í∂åÏû• ÏùòÍ≤¨ -->
                            <StackPanel>
                                <TextBlock Text="Í∂åÏû• ÏùòÍ≤¨" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding Analysis.Recommendations, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="80"
                                         VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>
                
                <!-- ===== Î∂ÑÏÑù ÏôÑÎ£å Ï≤¥ÌÅ¨ ===== -->
                <Border Style="{StaticResource SectionCardStyle}">
                    <Grid Margin="16">
                        <CheckBox Content="Í∂åÎ¶¨Î∂ÑÏÑù ÏôÑÎ£å" 
                                  IsChecked="{Binding Analysis.IsCompleted}"
                                  FontSize="{StaticResource FontSizeH4}"
                                  FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding Analysis.AnalyzedAt, StringFormat='yyyy-MM-dd HH:mm'}" 
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Center"
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Visibility="{Binding Analysis.AnalyzedAt, Converter={StaticResource NullToVisibilityConverter}}"/>
                    </Grid>
                </Border>
                
            </StackPanel>
        </Grid>
    </ScrollViewer>
</UserControl>

