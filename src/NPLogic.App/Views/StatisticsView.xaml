<UserControl x:Class="NPLogic.Views.StatisticsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:NPLogic.Views"
             xmlns:vm="clr-namespace:NPLogic.ViewModels"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             mc:Ignorable="d" 
             d:DesignHeight="900" d:DesignWidth="1200"
             d:DataContext="{d:DesignInstance Type=vm:StatisticsViewModel}"
             Loaded="StatisticsView_Loaded">
    
    <Grid Margin="32">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 헤더 영역 -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="통계 분석" 
                           Style="{StaticResource H2TextStyle}"
                           Margin="0,0,0,8"/>
                <TextBlock Text="프로젝트 통계 및 물건 현황을 분석합니다" 
                           Style="{StaticResource BodyTextStyle}"
                           Opacity="0.7"/>
            </StackPanel>

            <!-- 필터 및 버튼 -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="프로젝트:" 
                           VerticalAlignment="Center" 
                           Margin="0,0,12,0"
                           Style="{StaticResource BodyTextStyle}"/>
                <ComboBox ItemsSource="{Binding Projects}"
                          SelectedItem="{Binding SelectedProjectId}"
                          MinWidth="180"
                          Margin="0,0,16,0"/>
                <Button Content="새로고침" 
                        Command="{Binding RefreshDataCommand}"
                        Style="{StaticResource SecondaryButton}"
                        Padding="16,8"
                        Margin="0,0,8,0"/>
                <Button Content="Excel 출력" 
                        Command="{Binding ExportToExcelCommand}"
                        Style="{StaticResource PrimaryButton}"
                        Padding="16,8"/>
            </StackPanel>
        </Grid>

        <!-- 로딩 표시 -->
        <Grid Grid.Row="0" Grid.RowSpan="4" 
              Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
              Background="#80FFFFFF"
              Panel.ZIndex="100">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
                <TextBlock Text="데이터를 불러오는 중..." 
                           HorizontalAlignment="Center" 
                           Margin="0,16,0,0"
                           Style="{StaticResource BodyTextStyle}"/>
            </StackPanel>
        </Grid>

        <!-- 오류 메시지 -->
        <Border Grid.Row="1" 
                Background="#FFEBE9" 
                CornerRadius="4" 
                Padding="16,12"
                Margin="0,0,0,16"
                Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}">
            <TextBlock Text="{Binding ErrorMessage}" 
                       Foreground="#EF4444"
                       TextWrapping="Wrap"/>
        </Border>

        <!-- 주요 지표 카드 -->
        <Grid Grid.Row="2" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 총 물건 수 -->
            <Border Grid.Column="0" 
                    Background="{StaticResource BackgroundBrush}"
                    CornerRadius="8"
                    Padding="24">
                <Border.Effect>
                    <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="총 물건 수" 
                               Style="{StaticResource BodyTextStyle}"
                               Opacity="0.7"
                               Margin="0,0,0,8"/>
                    <TextBlock Text="{Binding TotalCount}" 
                               FontSize="36"
                               FontWeight="Bold"
                               Foreground="{StaticResource PrimaryBrush}"/>
                    <TextBlock Text="건" 
                               Style="{StaticResource SmallTextStyle}"
                               Opacity="0.5"
                               Margin="0,4,0,0"/>
                </StackPanel>
            </Border>

            <!-- 평균 감정가 -->
            <Border Grid.Column="2" 
                    Background="{StaticResource BackgroundBrush}"
                    CornerRadius="8"
                    Padding="24">
                <Border.Effect>
                    <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="평균 감정가" 
                               Style="{StaticResource BodyTextStyle}"
                               Opacity="0.7"
                               Margin="0,0,0,8"/>
                    <TextBlock Text="{Binding AverageAppraisalValue}" 
                               FontSize="36"
                               FontWeight="Bold"
                               Foreground="#3B82F6"/>
                    <TextBlock Text="원" 
                               Style="{StaticResource SmallTextStyle}"
                               Opacity="0.5"
                               Margin="0,4,0,0"/>
                </StackPanel>
            </Border>

            <!-- 평균 회수율 -->
            <Border Grid.Column="4" 
                    Background="{StaticResource BackgroundBrush}"
                    CornerRadius="8"
                    Padding="24">
                <Border.Effect>
                    <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="평균 회수율" 
                               Style="{StaticResource BodyTextStyle}"
                               Opacity="0.7"
                               Margin="0,0,0,8"/>
                    <TextBlock Text="{Binding AverageRecoveryRate}" 
                               FontSize="36"
                               FontWeight="Bold"
                               Foreground="#10B981"/>
                </StackPanel>
            </Border>

            <!-- 완료율 -->
            <Border Grid.Column="6" 
                    Background="{StaticResource BackgroundBrush}"
                    CornerRadius="8"
                    Padding="24">
                <Border.Effect>
                    <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="완료율" 
                               Style="{StaticResource BodyTextStyle}"
                               Opacity="0.7"
                               Margin="0,0,0,8"/>
                    <TextBlock Text="{Binding CompletionRate}" 
                               FontSize="36"
                               FontWeight="Bold"
                               Foreground="#F59E0B"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- 차트 영역 -->
        <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="350"/>
                    <RowDefinition Height="16"/>
                    <RowDefinition Height="300"/>
                    <RowDefinition Height="16"/>
                    <RowDefinition Height="300"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- 물건 유형별 분포 (파이 차트) -->
                <Border Grid.Row="0" Grid.Column="0"
                        Background="{StaticResource BackgroundBrush}"
                        CornerRadius="8"
                        Padding="20">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="물건 유형별 분포" 
                                   Style="{StaticResource H4TextStyle}"
                                   Margin="0,0,0,16"/>
                        <lvc:PieChart Grid.Row="1"
                                      Series="{Binding PropertyTypeSeries}"
                                      LegendPosition="Right"
                                      InitialRotation="-90"/>
                    </Grid>
                </Border>

                <!-- 상태별 물건 수 (막대 차트) -->
                <Border Grid.Row="0" Grid.Column="2"
                        Background="{StaticResource BackgroundBrush}"
                        CornerRadius="8"
                        Padding="20">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="상태별 물건 수" 
                                   Style="{StaticResource H4TextStyle}"
                                   Margin="0,0,0,16"/>
                        <lvc:CartesianChart Grid.Row="1"
                                            Series="{Binding StatusSeries}"
                                            XAxes="{Binding StatusXAxes}"
                                            ZoomMode="None"/>
                    </Grid>
                </Border>

                <!-- 월별 등록 추이 (선 차트) -->
                <Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3"
                        Background="{StaticResource BackgroundBrush}"
                        CornerRadius="8"
                        Padding="20">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="월별 등록 추이 (최근 6개월)" 
                                   Style="{StaticResource H4TextStyle}"
                                   Margin="0,0,0,16"/>
                        <lvc:CartesianChart Grid.Row="1"
                                            Series="{Binding MonthlyTrendSeries}"
                                            XAxes="{Binding MonthlyTrendXAxes}"
                                            ZoomMode="None"/>
                    </Grid>
                </Border>

                <!-- 지역별 물건 분포 (막대 차트) -->
                <Border Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3"
                        Background="{StaticResource BackgroundBrush}"
                        CornerRadius="8"
                        Padding="20">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="지역별 물건 분포" 
                                   Style="{StaticResource H4TextStyle}"
                                   Margin="0,0,0,16"/>
                        <lvc:CartesianChart Grid.Row="1"
                                            Series="{Binding RegionSeries}"
                                            XAxes="{Binding RegionXAxes}"
                                            ZoomMode="None"/>
                    </Grid>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>

















